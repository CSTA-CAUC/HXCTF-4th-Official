<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<title>Bendawang's Site</title>
<link href="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/font-awesome.min.css" rel="stylesheet"/>
<link href="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/screen.css" rel="stylesheet"/>
<link href="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/prism_okaidia.css" rel="stylesheet"/>
<link href="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/bendawang.css" rel="stylesheet"/>
<script src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/jquery.min.js"></script>
</head>
<body class="wrap">
<header>
<nav class="mobile-nav show-on-mobiles">
<ul>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
<div class="show-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/bendawang.png" style="display:block;width:100%;"/></a>
</h1>
</div>
<div class="grid hide-on-mobiles">
<div class="unit test2 hide-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img alt="" height="115" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/bendawang.png" width="449"/></a>
</h1>
</div>
<nav class="main-nav unit test1 hide-on-mobiles">
<ul>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
</div>
</header>
<script>
$('document').ready(function(){
    $('li[class]:eq(4)').attr('class','current');
});
</script>
<section class="docs">
<div class="grid">
<!--移动端-->
<div class="show-on-mobiles">
<div class="article-info profile-block">
<div class="article-info-block">
               55
               <span>文章</span>
</div>
<div class="article-info-block">
               5
               <span>标签</span>
</div>
</div>
<div class="profile-block social-links">
<table>
<tbody><tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i></a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i></a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i></a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody></table>
</div>
<div class="whole show-on-mobiles">
<article class="bdw_article">
<div class="Bendawang" id="Bendawang_mobile">
<b id="Bendawang_toggle_mobile" title="收起">目录[+]</b></div></article></div></div></div></section></body></html>
<div class="Bendawang_content" id="Bendawang_content_mobile"></div>

<br/>
<br/>
<h1 id="twctf2016tokyowesternsctfwebwriteup">TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp</h1>
<p style="max-width:100%;height:auto;">这个是9.3-9.5举行的一个比赛。上个链接https://score.ctf.westerns.tokyo/problems?locale=en</p>
<p style="max-width:100%;height:auto;">不过我这一段时间都在忙着做一个智障的项目，大的比赛都没时间做，也就只能赛后来补补题，发现自己还是太菜了，菜的抠脚。
还好题目还开着。不过补题花了不少时间，学了不少姿势。
现在貌似还开着的，不知道会开多久。</p>
<h2 id="web50globalpage">web 50 Global Page</h2>
<p style="max-width:100%;height:auto;">比赛的时候做的，抓包试验了几次就摸清规律了，修改请求头，GET的page参数设置为<code style="max-width:100%;height:auto;">php:/</code>，然后在<code style="max-width:100%;height:auto;">Accept-Language</code>参数设置为<code style="max-width:100%;height:auto;">/filter/convert.base64-encode/resource=**</code>，就可以使用<code style="max-width:100%;height:auto;">php://</code>配合文件包含读取任意文件了。</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906212945308" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">拿到了flag，base64解码得到flag是<code style="max-width:100%;height:auto;">TWCTF{I_found_simple_LFI}</code></p>
<h2 id="web100gettheadminpassword">web 100 Get the admin password!</h2>
<p style="max-width:100%;height:auto;">一道mdb注入，不多解释了，比较简单，这里就不对mongodb注入做太多说明了，回头有空写个博客来详细总结下好了。
直接写个脚本盲注下就可以了，截图如下：
因为忙着上厕所，所以懒得写二分了，上完回来就跑完了，所以就不贴了代码了，截图如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213002137" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">所以最后的flag就是<code style="max-width:100%;height:auto;">TWCTF{wasshoi!summer_festival!}</code></p>
<h2 id="web100poems">web 100 Poems</h2>
<h2 id="web150rottenuploader">web 150 rotten uploader</h2>
<p style="max-width:100%;height:auto;">题目提示如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213018918" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">进入之后发现可以直接通过这样子<code style="max-width:100%;height:auto;">http://rup.chal.ctf.westerns.tokyo/downloader.php?f=../index.php</code>下载到<code style="max-width:100%;height:auto;">index.php</code>和<code style="max-width:100%;height:auto;">download.php</code>的源码，但是下<code style="max-width:100%;height:auto;">file_list.php</code>下不下来，先读另外两个的源码吧，<code style="max-width:100%;height:auto;">index.php</code>如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
/**
 *
 */
include(&amp;apos;file_list.php&amp;apos;);
?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0 Level 2//EN"&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Uploader&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Simple Uploader&lt;/h1&gt;
    &lt;p&gt;There are no upload features.&lt;/p&gt;
    &lt;h3&gt;Files&lt;/h3&gt;
    &lt;table width="100%" border="1"&gt;
          &lt;tr&gt;
            &lt;th&gt;#&lt;/th&gt;
            &lt;th&gt;Filename&lt;/th&gt;
            &lt;th&gt;Size&lt;/th&gt;
            &lt;th&gt;Link&lt;/th&gt;
          &lt;/tr&gt;
              &lt;?php foreach($files as $file): ?&gt;
    &lt;?php if($file[0]) continue; // visible flag ?&gt;  
          &lt;tr&gt;
            &lt;td&gt;&lt;?= $file[1]; ?&gt;&lt;/td&gt;
            &lt;td&gt;&lt;?= $file[2]; ?&gt;&lt;/td&gt;
            &lt;td&gt;&lt;?= $file[3]; ?&gt; bytes&lt;/td&gt;
            &lt;td&gt;&lt;a href="download.php?f=&lt;?= $file[4]; ?&gt;"&gt;Download&lt;/a&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;?php endforeach;?&gt;
      &lt;/table&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p style="max-width:100%;height:auto;"><code style="max-width:100%;height:auto;">download.php</code>如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
header("Content-Type: application/octet-stream");
if(stripos($_GET[&amp;apos;f&amp;apos;], &amp;apos;file_list&amp;apos;) !== FALSE) die();
readfile(&amp;apos;uploads/&amp;apos; . $_GET[&amp;apos;f&amp;apos;]); // safe_dir is enabled.
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">阅读之后发现<code style="max-width:100%;height:auto;">index.php</code>里面没啥信息，只是包含了下<code style="max-width:100%;height:auto;">file_list.php</code>，而<code style="max-width:100%;height:auto;">download.php</code>直接把这个过滤了，所以目的就是如何绕过过滤。
这里也是经过别人提示学到了一个新的姿势，这里通过wireshark抓包可以分析出服务器的操作系统是windows，之前我的博客也有说怎么判断操作系统，这里我是根据TTL=128得到服务器操作系统是windows的，</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213042387" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">而windows是有长文件名和段文件名的区别。
给个链接http://blog.csdn.net/oathevil/article/details/5717341
所以最后payload就是</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213108840" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;"><code style="max-width:100%;height:auto;">file_list.php</code>源码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
$files = [
  [FALSE, 1, &amp;apos;test.cpp&amp;apos;, 1135, &amp;apos;test.cpp&amp;apos;],
  [FALSE, 2, &amp;apos;test.c&amp;apos;, 74, &amp;apos;test.c&amp;apos;],
  [TRUE, 3, &amp;apos;    &amp;apos;, 35, &amp;apos;flag_c82e41f5bb7c8d4b947c9586444578ade88fe0d7&amp;apos;],
  [FALSE, 4, &amp;apos;test.rb&amp;apos;, 1446, &amp;apos;test.rb&amp;apos;],
];
</code></pre>
<p style="max-width:100%;height:auto;">这样就得到提示了，直接又去获取<code style="max-width:100%;height:auto;">flag_c82e41f5bb7c8d4b947c9586444578ade88fe0d7</code>源码即可拿到flag，flag是<code style="max-width:100%;height:auto;">TWCTF{Hotto_Smile}</code></p>
<h2 id="web200zipcracker">web 200 ZIP cracker</h2>
<p style="max-width:100%;height:auto;">这里首页存在备份文件，如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;"> &lt;?php
if(!empty($_FILES[&amp;apos;zip&amp;apos;][&amp;apos;tmp_name&amp;apos;]) and !empty($_FILES[&amp;apos;dict&amp;apos;][&amp;apos;tmp_name&amp;apos;])) {
    if(max($_FILES[&amp;apos;zip&amp;apos;][&amp;apos;size&amp;apos;], $_FILES[&amp;apos;dict&amp;apos;][&amp;apos;size&amp;apos;]) &lt;= 1024*1024) {
        // Do you remember 430387 ?
        $zip = $_FILES[&amp;apos;zip&amp;apos;][&amp;apos;tmp_name&amp;apos;];
        $dict = $_FILES[&amp;apos;dict&amp;apos;][&amp;apos;tmp_name&amp;apos;];

        $option = "-D -p $dict";
        if(isset($_POST[&amp;apos;unzip&amp;apos;])) {
            $option = "-u ".$option;
        }

        $cmd = "timeout 3 ./fcrackzip-1.0/fcrackzip $option $zip";
        $res = shell_exec($cmd);
    }
    else {
         $res = &amp;apos;file is too large.&amp;apos;;
    }
}
else {
 $res = &amp;apos;file is missing&amp;apos;;
}
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=utf-8&gt;
&lt;title&gt;ZipCracker - Crack Your Zip Online&lt;/title&gt;
&lt;link rel="stylesheet" href=""http://cdn.foundation5.zurb.com/foundation.css"&gt;
&lt;link rel="stylesheet" href="/zipcracker.css"&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;div class="main"&gt;
&lt;div class="top-bar"&gt;
  &lt;div class="top-bar-title"&gt;ZipCracker&lt;/div&gt;
&lt;/div&gt;
&lt;div class="container-wrapper"&gt;
    &lt;div class="container"&gt;
        &lt;h1 class="container-head"&gt;
            Crack Your ZIP Online
        &lt;/h1&gt;
        &lt;p class="container-subhead"&gt;
            Only dictionary-based crack is available.&lt;br&gt;
            Both zip and dictionary file must not exceed 1MB.
        &lt;/p&gt;
        &lt;form action="" method="POST" enctype="multipart/form-data"&gt;
            &lt;label for="zip" class="button"&gt;ZIP file&lt;/label&gt;
            &lt;input id="zip" type="file" name="zip" class="show-for-sr"&gt;

            &lt;label for="dict" class="button"&gt;Dictionary file&lt;/label&gt;
            &lt;input id="dict" type="file" name="dict" class="show-for-sr"&gt;

            &lt;input id="unzip" type="checkbox" name="unzip"&gt;
            &lt;label for="unzip"&gt;use unzip&lt;/label&gt;

            &lt;button type="submit" class="success button"&gt;Crack&lt;/button&gt;
        &lt;/form&gt;
        &lt;p&gt;file is missing&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p style="max-width:100%;height:auto;">然后知道目录下有一个工具fcrackzip，能够访问并且下载其所有的源文件和工具，看完wp知道应该是工具里面写法有问题，这里时间也不很够就没有去看工具源码，直接给出做法，有兴趣的可以自己去看看。
首先是创建一个以<code style="max-width:100%;height:auto;">aaa";ls /#</code>为密码的zip文件，然后在把密码写进pass.txt</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213141071" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">然后上传就可以了，记住勾选<code style="max-width:100%;height:auto;">use unzip</code></p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213159587" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">看源码发现命令执行了：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213212119" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">那就可以直接<code style="max-width:100%;height:auto;">cat flag.php</code>了</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213226244" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">提交
成功拿到flag</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213242794" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web300tsuraiweb">web 300 Tsurai Web</h2>
<p style="max-width:100%;height:auto;">这道题的主要考点就是
例如用的是<code style="max-width:100%;height:auto;">__import__(&amp;apos;a&amp;apos;)</code>
而当前目录如下：</p>
<pre><code class="url language-url" style="max-width:100%;height:auto;">---
  |-a
  |--|-__init__.py
  |-a.py
</code></pre>
<p style="max-width:100%;height:auto;">它会引用文件夹a下的<code style="max-width:100%;height:auto;">__init__.py</code>
而这里题目的源码可以下下来自己跑起来，就是flask框架写得，不懂得可以看看我的博客里面有关于flask的介绍，嘿嘿
自己跑起来的时候，每创建一个用户，就会在data下创建如下</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213329996" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">漏洞点在这里</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213346105" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">就是最开始说的，它会优先引用同名文件夹的<code style="max-width:100%;height:auto;">__init__.py</code>，当时前提是得有，但是这里我们上传的所有文件都以原文件名存在该文件夹下。
所以我们就可以手动上传一个<code style="max-width:100%;height:auto;">__init__.py</code>，
本地如图：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213411997" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">跟随重定向可以看到</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213430247" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">把本地目录所有都读取出来了。</p>
<p style="max-width:100%;height:auto;">现在上题目操作，其实都是一样的，读取出</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213450154" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">目录下存在一个flag，接下来直接读取flag文件内容即可</p>
<p style="max-width:100%;height:auto;">这里我不知道咋回事报500error，所以我重新注册一个账户，上传py执行命令读取flag文件就可以了
<br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213600421" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">所以flag就是<code style="max-width:100%;height:auto;">TWCTF{TH1S_Challange_was_BORN_AT_2016-09-04_13:03_JST}</code></p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>



<!--PC端-->
<div class="unit one-fifth hide-on-mobiles" id="scroll" style="position:absolute;left:30px">
<div class="inner profile-inner">
<div class="base-info profile-block">
<img id="avatar" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/logo.jpg"/>
<h2 id="name" style="text-align:center">Bendawang</h2>
<span id="location" style="font-size:18px">
<i class="fa fa-map-marker"></i>SiChuan, China</span>
<a href="/about" id="follow">联系我</a></div>
<div class="article-info profile-block">
<div class="article-info-block">
        55
          <span>文章</span></div>
<div class="article-info-block">
        5
          <span>标签</span></div>
</div>
<div class="profile-block social-links hide-on-mobiles">
<table>
<tbody>
<tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i>
</a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i>
</a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i>
</a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="unit three-quarters hide-on-mobiles">
<article class="bdw_article">
<h1 id="twctf2016tokyowesternsctfwebwriteup">TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp</h1>
<p style="max-width:100%;height:auto;">这个是9.3-9.5举行的一个比赛。上个链接https://score.ctf.westerns.tokyo/problems?locale=en</p>
<p style="max-width:100%;height:auto;">不过我这一段时间都在忙着做一个智障的项目，大的比赛都没时间做，也就只能赛后来补补题，发现自己还是太菜了，菜的抠脚。
还好题目还开着。不过补题花了不少时间，学了不少姿势。
现在貌似还开着的，不知道会开多久。</p>
<h2 id="web50globalpage">web 50 Global Page</h2>
<p style="max-width:100%;height:auto;">比赛的时候做的，抓包试验了几次就摸清规律了，修改请求头，GET的page参数设置为<code style="max-width:100%;height:auto;">php:/</code>，然后在<code style="max-width:100%;height:auto;">Accept-Language</code>参数设置为<code style="max-width:100%;height:auto;">/filter/convert.base64-encode/resource=**</code>，就可以使用<code style="max-width:100%;height:auto;">php://</code>配合文件包含读取任意文件了。</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906212945308" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">拿到了flag，base64解码得到flag是<code style="max-width:100%;height:auto;">TWCTF{I_found_simple_LFI}</code></p>
<h2 id="web100gettheadminpassword">web 100 Get the admin password!</h2>
<p style="max-width:100%;height:auto;">一道mdb注入，不多解释了，比较简单，这里就不对mongodb注入做太多说明了，回头有空写个博客来详细总结下好了。
直接写个脚本盲注下就可以了，截图如下：
因为忙着上厕所，所以懒得写二分了，上完回来就跑完了，所以就不贴了代码了，截图如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213002137" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">所以最后的flag就是<code style="max-width:100%;height:auto;">TWCTF{wasshoi!summer_festival!}</code></p>
<h2 id="web100poems">web 100 Poems</h2>
<h2 id="web150rottenuploader">web 150 rotten uploader</h2>
<p style="max-width:100%;height:auto;">题目提示如下：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213018918" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">进入之后发现可以直接通过这样子<code style="max-width:100%;height:auto;">http://rup.chal.ctf.westerns.tokyo/downloader.php?f=../index.php</code>下载到<code style="max-width:100%;height:auto;">index.php</code>和<code style="max-width:100%;height:auto;">download.php</code>的源码，但是下<code style="max-width:100%;height:auto;">file_list.php</code>下不下来，先读另外两个的源码吧，<code style="max-width:100%;height:auto;">index.php</code>如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
/**
 *
 */
include(&amp;apos;file_list.php&amp;apos;);
?&gt;
&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0 Level 2//EN"&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Uploader&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Simple Uploader&lt;/h1&gt;
    &lt;p&gt;There are no upload features.&lt;/p&gt;
    &lt;h3&gt;Files&lt;/h3&gt;
    &lt;table width="100%" border="1"&gt;
          &lt;tr&gt;
            &lt;th&gt;#&lt;/th&gt;
            &lt;th&gt;Filename&lt;/th&gt;
            &lt;th&gt;Size&lt;/th&gt;
            &lt;th&gt;Link&lt;/th&gt;
          &lt;/tr&gt;
              &lt;?php foreach($files as $file): ?&gt;
    &lt;?php if($file[0]) continue; // visible flag ?&gt;  
          &lt;tr&gt;
            &lt;td&gt;&lt;?= $file[1]; ?&gt;&lt;/td&gt;
            &lt;td&gt;&lt;?= $file[2]; ?&gt;&lt;/td&gt;
            &lt;td&gt;&lt;?= $file[3]; ?&gt; bytes&lt;/td&gt;
            &lt;td&gt;&lt;a href="download.php?f=&lt;?= $file[4]; ?&gt;"&gt;Download&lt;/a&gt;&lt;/td&gt;
          &lt;/tr&gt;
          &lt;?php endforeach;?&gt;
      &lt;/table&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p style="max-width:100%;height:auto;"><code style="max-width:100%;height:auto;">download.php</code>如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
header("Content-Type: application/octet-stream");
if(stripos($_GET[&amp;apos;f&amp;apos;], &amp;apos;file_list&amp;apos;) !== FALSE) die();
readfile(&amp;apos;uploads/&amp;apos; . $_GET[&amp;apos;f&amp;apos;]); // safe_dir is enabled.
?&gt;
</code></pre>
<p style="max-width:100%;height:auto;">阅读之后发现<code style="max-width:100%;height:auto;">index.php</code>里面没啥信息，只是包含了下<code style="max-width:100%;height:auto;">file_list.php</code>，而<code style="max-width:100%;height:auto;">download.php</code>直接把这个过滤了，所以目的就是如何绕过过滤。
这里也是经过别人提示学到了一个新的姿势，这里通过wireshark抓包可以分析出服务器的操作系统是windows，之前我的博客也有说怎么判断操作系统，这里我是根据TTL=128得到服务器操作系统是windows的，</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213042387" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">而windows是有长文件名和段文件名的区别。
给个链接http://blog.csdn.net/oathevil/article/details/5717341
所以最后payload就是</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213108840" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;"><code style="max-width:100%;height:auto;">file_list.php</code>源码如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;">&lt;?php
$files = [
  [FALSE, 1, &amp;apos;test.cpp&amp;apos;, 1135, &amp;apos;test.cpp&amp;apos;],
  [FALSE, 2, &amp;apos;test.c&amp;apos;, 74, &amp;apos;test.c&amp;apos;],
  [TRUE, 3, &amp;apos;    &amp;apos;, 35, &amp;apos;flag_c82e41f5bb7c8d4b947c9586444578ade88fe0d7&amp;apos;],
  [FALSE, 4, &amp;apos;test.rb&amp;apos;, 1446, &amp;apos;test.rb&amp;apos;],
];
</code></pre>
<p style="max-width:100%;height:auto;">这样就得到提示了，直接又去获取<code style="max-width:100%;height:auto;">flag_c82e41f5bb7c8d4b947c9586444578ade88fe0d7</code>源码即可拿到flag，flag是<code style="max-width:100%;height:auto;">TWCTF{Hotto_Smile}</code></p>
<h2 id="web200zipcracker">web 200 ZIP cracker</h2>
<p style="max-width:100%;height:auto;">这里首页存在备份文件，如下：</p>
<pre><code class="php language-php" style="max-width:100%;height:auto;"> &lt;?php
if(!empty($_FILES[&amp;apos;zip&amp;apos;][&amp;apos;tmp_name&amp;apos;]) and !empty($_FILES[&amp;apos;dict&amp;apos;][&amp;apos;tmp_name&amp;apos;])) {
    if(max($_FILES[&amp;apos;zip&amp;apos;][&amp;apos;size&amp;apos;], $_FILES[&amp;apos;dict&amp;apos;][&amp;apos;size&amp;apos;]) &lt;= 1024*1024) {
        // Do you remember 430387 ?
        $zip = $_FILES[&amp;apos;zip&amp;apos;][&amp;apos;tmp_name&amp;apos;];
        $dict = $_FILES[&amp;apos;dict&amp;apos;][&amp;apos;tmp_name&amp;apos;];

        $option = "-D -p $dict";
        if(isset($_POST[&amp;apos;unzip&amp;apos;])) {
            $option = "-u ".$option;
        }

        $cmd = "timeout 3 ./fcrackzip-1.0/fcrackzip $option $zip";
        $res = shell_exec($cmd);
    }
    else {
         $res = &amp;apos;file is too large.&amp;apos;;
    }
}
else {
 $res = &amp;apos;file is missing&amp;apos;;
}
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=utf-8&gt;
&lt;title&gt;ZipCracker - Crack Your Zip Online&lt;/title&gt;
&lt;link rel="stylesheet" href=""http://cdn.foundation5.zurb.com/foundation.css"&gt;
&lt;link rel="stylesheet" href="/zipcracker.css"&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;div class="main"&gt;
&lt;div class="top-bar"&gt;
  &lt;div class="top-bar-title"&gt;ZipCracker&lt;/div&gt;
&lt;/div&gt;
&lt;div class="container-wrapper"&gt;
    &lt;div class="container"&gt;
        &lt;h1 class="container-head"&gt;
            Crack Your ZIP Online
        &lt;/h1&gt;
        &lt;p class="container-subhead"&gt;
            Only dictionary-based crack is available.&lt;br&gt;
            Both zip and dictionary file must not exceed 1MB.
        &lt;/p&gt;
        &lt;form action="" method="POST" enctype="multipart/form-data"&gt;
            &lt;label for="zip" class="button"&gt;ZIP file&lt;/label&gt;
            &lt;input id="zip" type="file" name="zip" class="show-for-sr"&gt;

            &lt;label for="dict" class="button"&gt;Dictionary file&lt;/label&gt;
            &lt;input id="dict" type="file" name="dict" class="show-for-sr"&gt;

            &lt;input id="unzip" type="checkbox" name="unzip"&gt;
            &lt;label for="unzip"&gt;use unzip&lt;/label&gt;

            &lt;button type="submit" class="success button"&gt;Crack&lt;/button&gt;
        &lt;/form&gt;
        &lt;p&gt;file is missing&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p style="max-width:100%;height:auto;">然后知道目录下有一个工具fcrackzip，能够访问并且下载其所有的源文件和工具，看完wp知道应该是工具里面写法有问题，这里时间也不很够就没有去看工具源码，直接给出做法，有兴趣的可以自己去看看。
首先是创建一个以<code style="max-width:100%;height:auto;">aaa";ls /#</code>为密码的zip文件，然后在把密码写进pass.txt</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213141071" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">然后上传就可以了，记住勾选<code style="max-width:100%;height:auto;">use unzip</code></p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213159587" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">看源码发现命令执行了：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213212119" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">那就可以直接<code style="max-width:100%;height:auto;">cat flag.php</code>了</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213226244" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">提交
成功拿到flag</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213242794" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web300tsuraiweb">web 300 Tsurai Web</h2>
<p style="max-width:100%;height:auto;">这道题的主要考点就是
例如用的是<code style="max-width:100%;height:auto;">__import__(&amp;apos;a&amp;apos;)</code>
而当前目录如下：</p>
<pre><code class="url language-url" style="max-width:100%;height:auto;">---
  |-a
  |--|-__init__.py
  |-a.py
</code></pre>
<p style="max-width:100%;height:auto;">它会引用文件夹a下的<code style="max-width:100%;height:auto;">__init__.py</code>
而这里题目的源码可以下下来自己跑起来，就是flask框架写得，不懂得可以看看我的博客里面有关于flask的介绍，嘿嘿
自己跑起来的时候，每创建一个用户，就会在data下创建如下</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213329996" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">漏洞点在这里</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213346105" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">就是最开始说的，它会优先引用同名文件夹的<code style="max-width:100%;height:auto;">__init__.py</code>，当时前提是得有，但是这里我们上传的所有文件都以原文件名存在该文件夹下。
所以我们就可以手动上传一个<code style="max-width:100%;height:auto;">__init__.py</code>，
本地如图：</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213411997" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">跟随重定向可以看到</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213430247" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">把本地目录所有都读取出来了。</p>
<p style="max-width:100%;height:auto;">现在上题目操作，其实都是一样的，读取出</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213450154" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">目录下存在一个flag，接下来直接读取flag文件内容即可</p>
<p style="max-width:100%;height:auto;">这里我不知道咋回事报500error，所以我重新注册一个账户，上传py执行命令读取flag文件就可以了
<br/><img alt="这里写图片描述" data-action="zoom" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/20160906213600421" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">所以flag就是<code style="max-width:100%;height:auto;">TWCTF{TH1S_Challange_was_BORN_AT_2016-09-04_13:03_JST}</code></p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>
</article>
</div>
<div class="unit one-fifth hide-on-mobiles godness">
<aside>
<div class="Bendawang" id="Bendawang" style="position:absolute;">
<b id="Bendawang_toggle" style="cursor:pointer;" title="收起">目录[+]</b></div></aside></div>
<div class="Bendawang_content" id="Bendawang_content"></div>

<img class="yukino" id="yukino" src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/41.png" style="position:absolute;"/>




<footer>
<div class="show-on-mobiles">
<div style="display:inline-block">
<div style="vertical-align:middle;">
            Copyright©
            <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder"><a href="http://bendawang.site/" style="font-size:16px">Bendawang</a></span>
</div>
</div>
<div style="vertical-align:middle;">
<span>Designed By</span>
<a href="http://blog.csdn.net/qq_19876131"><img src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/bendawang2.png"/></a>
</div>
</div>
<div class="grid hide-on-mobiles">
<div class="unit one-third center-on-mobiles">
<div class="copyright">
          Copyright©
          <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder">   <a href="http://bendawang.site/">Bendawang</a></span>
</div>
</div>
<div class="unit two-thirds align-right center-on-mobiles">
<p>Designed By
          <a href="http://blog.csdn.net/qq_19876131">
<img src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/bendawang2.png"/>
</a>
</p>
</div>
</div>
</footer>
<script src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/prism.js"></script>
<script src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/zooming.js"></script>
<script src="./TWCTF-2016-(Tokyo Westerns CTF )-WEB-WriteUp/Bendawang.js"></script>


