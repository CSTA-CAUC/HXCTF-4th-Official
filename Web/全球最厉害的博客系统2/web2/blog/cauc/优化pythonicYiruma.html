<!DOCTYPE doctype html>

<html class="theme-next mist use-motion" lang="">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
<meta content="no-transform" http-equiv="Cache-Control"/>
<meta content="no-siteapp" http-equiv="Cache-Control"/>
<link href="./优化pythonicYiruma/jquery.fancybox.cssv=2.1.5" rel="stylesheet" type="text/css"/>
<link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css"/>
<link href="./优化pythonicYiruma/font-awesome.min.cssv=4.6.2" rel="stylesheet" type="text/css">
<link href="./优化pythonicYiruma/main.cssv=5.1.1" rel="stylesheet" type="text/css"/>
<meta content="Hexo, NexT" name="keywords"/>
<link href="/favicon.ico?v=5.1.1" rel="shortcut icon" type="image/x-icon"/>
<meta content="使用python已经有很长一段时间了，在比赛中python语言的简洁易懂性给了我很大的帮助。当对一项技能使用的熟练度到达一定程度的时候，就该重新入门了。本文章将长期保持更新，收集记录各种python黑魔法，努力使自己的代码变得更加pythonic！" name="description"/>
<meta name="keywords"/>
<meta content="article" property="og:type"/>
<meta content="优化 pythonic" property="og:title"/>
<meta content="https://someonesometimes.github.io/2017/05/28/优化-pythonic/index.html" property="og:url"/>
<meta content="Yiruma" property="og:site_name"/>
<meta content="使用python已经有很长一段时间了，在比赛中python语言的简洁易懂性给了我很大的帮助。当对一项技能使用的熟练度到达一定程度的时候，就该重新入门了。本文章将长期保持更新，收集记录各种python黑魔法，努力使自己的代码变得更加pythonic！" property="og:description"/>
<meta content="2017-06-01T12:12:56.582Z" property="og:updated_time"/>
<meta content="summary" name="twitter:card"/>
<meta content="优化 pythonic" name="twitter:title"/>
<meta content="使用python已经有很长一段时间了，在比赛中python语言的简洁易懂性给了我很大的帮助。当对一项技能使用的熟练度到达一定程度的时候，就该重新入门了。本文章将长期保持更新，收集记录各种python黑魔法，努力使自己的代码变得更加pythonic！" name="twitter:description"/>
<script id="hexo.configurations" type="text/javascript">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<link href="./优化pythonicYiruma/优化-pythonic" rel="canonical"/>
<title>优化 pythonic | Yiruma</title>
</link></head>
<body itemscope="" itemtype="http://schema.org/WebPage" lang="">
<div class="container sidebar-position-left page-post-detail ">
<div class="headband"></div>
<header class="header" id="header" itemscope="" itemtype="http://schema.org/WPHeader">
<div class="header-inner"><div class="site-brand-wrapper">
<div class="site-meta ">
<div class="custom-logo-site-title">
<a class="brand" href="/" rel="start">
<span class="logo-line-before"><i></i></span>
<span class="site-title">Yiruma</span>
<span class="logo-line-after"><i></i></span>
</a>
</div>
<p class="site-subtitle"></p>
</div>
<div class="site-nav-toggle">
<button>
<span class="btn-bar"></span>
<span class="btn-bar"></span>
<span class="btn-bar"></span>
</button>
</div>
</div>
<nav class="site-nav">
<ul class="menu" id="menu">
<li class="menu-item menu-item-archives">
<a href="/archives" rel="section">
<i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>
            
            Archives
          </a>
</li>
<li class="menu-item menu-item-about">
<a href="/about" rel="section">
<i class="menu-item-icon fa fa-fw fa-user"></i> <br/>
            
            About
          </a>
</li>
<li class="menu-item menu-item-link">
<a href="/links" rel="section">
<i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br/>
            
            menu.link
          </a>
</li>
</ul>
</nav>
</div>
</header>
<main class="main" id="main">
<div class="main-inner">
<div class="content-wrap">
<div class="content" id="content">
<div class="posts-expand" id="posts">
<article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
<link href="./优化pythonicYiruma/优化-pythonic" itemprop="mainEntityOfPage"/>
<span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<meta content="Yiruma" itemprop="name"/>
<meta content="" itemprop="description"/>
<meta content="/images/avatar.gif" itemprop="image"/>
</span>
<span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="Yiruma" itemprop="name"/>
</span>
<header class="post-header">
<h1 class="post-title" itemprop="name headline">优化 pythonic</h1>
<div class="post-meta">
<span class="post-time">
<span class="post-meta-item-icon">
<i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">Posted on</span>
<time datetime="2017-05-28T13:12:11+08:00" itemprop="dateCreated datePublished" title="Post created">
                2017-05-28
              </time>
</span>
</div>
</header>
<div class="post-body" itemprop="articleBody">
<p>使用python已经有很长一段时间了，在比赛中python语言的简洁易懂性给了我很大的帮助。当对一项技能使用的熟练度到达一定程度的时候，就该重新入门了。本文章将长期保持更新，收集记录各种python黑魔法，努力使自己的代码变得更加pythonic！<br/><a id="more"></a></p>
<p><strong>变量交换</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a,b = b,a</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>对可变字符串不建议再使用temp = “(“+str(i)+”,”+str(j)+”)”的写法，给两种替换：</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">temp = "({x},{y})".format(x=str(i), y=str(j))</div><div class="line">temp = "(%(x),%(y))" % {&amp;apos;x&amp;apos;:str(i), &amp;apos;y&amp;apos;:str(j)}</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>类似于C里面的三元操作符：</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">X if X&lt;Y else Y</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>直接生成的列表（不是那种定义后一直要修改的）</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fr = open("F://xie.txt")</div><div class="line">list = [i for i in fr.readlines()]</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>python装饰器</strong><br/>作用就是为函数外加一层代码，可以用于日志记录，函数运行时间记录，对于不合适的函数进行代码补充等等场景<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">def runTime(tag = True):</div><div class="line">	if tag == True:</div><div class="line">		def _deco(func):</div><div class="line">			def wrapper(*args, **kwargs):</div><div class="line">				startTime = time.time()</div><div class="line">				retu = func(*args, **kwargs)</div><div class="line">				endTime = time.time()</div><div class="line">				print ("RunTime is {time}".format(time=endTime-startTime))</div><div class="line">				return retu</div><div class="line">			return wrapper</div><div class="line">	else:</div><div class="line">		def _deco(func):</div><div class="line">			return func</div><div class="line">	return _deco	</div><div class="line"></div><div class="line">@runTime(True)</div><div class="line">def myFunc(path):</div><div class="line">	fr = open(path)</div><div class="line">	list = [i for i in fr.readlines]</div><div class="line"></div><div class="line">myFunc("F://xie.txt")</div></pre></td></tr></table></figure></p>
<p><strong>@runTime(True)相当于：myFunc = runTime(True)(myFunc(path))</strong></p>
<p><strong>调用逻辑为：</strong></p>
<ol>
<li>runTime(True) 返回_deco 因此等价于 _deco函数</li>
<li>_deco(myFunc(path))返回wrapper 因此等价于 wrapper函数</li>
<li>所以myFunc 等价于 执行逻辑之后的wrapper(path)函数</li>
</ol>
<p><strong>装饰器书写需要把握的重点是：</strong></p>
<ul>
<li>装饰器的本质是函数转换，经过@之后的那个函数其实最后都是变为装饰代码后的wrapper函数</li>
<li>基本的函数转换方式就是在每层函数中定义个子函数，然后逻辑执行后return 子函数</li>
</ul>
<hr/>
<p><strong>python函数中的可变参数：</strong><br/>其实实现原理很简单，def xie(<em>args, **kwargs)中的</em>args就相当于一个list， **kwargs就相当于一个dict，只是python为方便使用做出了进一步定义<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">def xie(farg, *args)</div><div class="line">xie(1, &amp;apos;two&amp;apos;, 3) ==&gt; xie(1, [&amp;apos;two&amp;apos;,3])</div><div class="line"></div><div class="line">def xie(farg, **kwargs)</div><div class="line">xie(1, url=&amp;apos;/xss&amp;apos;, method=&amp;apos;get&amp;apos;) ==&gt; xie(1, {"url":&amp;apos;/xss&amp;apos;, &amp;apos;method&amp;apos;:&amp;apos;get&amp;apos;})</div><div class="line"></div><div class="line">def xie(arg1, arg2, arg3)</div><div class="line">args = [2, 3]</div><div class="line">xie(1, *args) ==&gt; xie(1, 2, 3)</div><div class="line"></div><div class="line">def xie(arg1, arg2, arg3)</div><div class="line">kwargs = {&amp;apos;arg1&amp;apos;:1, &amp;apos;arg2&amp;apos;:2, &amp;apos;arg3&amp;apos;:3}</div><div class="line">xie(**kwargs) ==&gt; xie(1, 2, 3)</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>迭代器中使用计数模式</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">fr = open("F://xie.txt", &amp;apos;r&amp;apos;)</div><div class="line">for index, i in enumerate(fr.readlines(), 1):</div><div class="line">	print ("{index}:{i}".format(index=index, i=i))</div></pre></td></tr></table></figure></p>
<p>将迭代列表用enumerate对象封装，每次迭代值返回两个————index, data。<br/>同时enumerate()的第二个参数用于指定index的起始值，默认为0</p>
<hr/>
<p><strong>对于对象的迭代器遍历如果只是为了循环检测是否存在某种情况，可以这样写：</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[row[1]==0 and row[2]!=&amp;apos;Yes&amp;apos; for row in rows]</div></pre></td></tr></table></figure></p>
<p>之后使用any()  all() 函数做检测<br/>any([1,0,0])列表中存在1即返回真      all([1,1,1])列表中全为真则返回真<br/>因此具体可以这样写<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">any([row[1]==0 and row[2]!=&amp;apos;Yes&amp;apos; for row in rows])</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>之前对dict的操作认识太浅显，重新整理下dict操作</strong><br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">获取字典中的值，get()函数支持默认参数方法，在没有键值的时候使用默认参数</div><div class="line">dict.get(&amp;apos;xie&amp;apos;, &amp;apos;fei&amp;apos;)</div><div class="line"></div><div class="line">检测键是否存在,存在会返回对应的值，不存在会返回None</div><div class="line">dict.get(&amp;apos;xie&amp;apos;)</div><div class="line">另一种方法是在dict.keys()列表中寻找</div><div class="line"></div><div class="line">返回dict中的所有键：</div><div class="line">dict.keys()</div><div class="line"></div><div class="line">返回dict中所有值：</div><div class="line">dict.values()</div><div class="line"></div><div class="line">更新字典，也就是添加没有的键值对，为键对应的值改变的进行更新。类似于加运算吧</div><div class="line">dict.update(dict2)</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>使用defaultdict类型来进行遍历的结果记录</strong><br/>在对遍历结果统计时经常使用dict类型来记录，但dict在这种情况下有个问题就是，如果是第一次引用一个键，dict[‘xie’] += 1就会出现问题，需要先dict[‘xie’] = 0,再dict[‘xie’] += 1，而defaultdict会在dict[]遇到新的键时为其分配指定的值<br/><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from collections import defaultdict</div><div class="line"></div><div class="line">list = [1,2,3,4,5,6,3,4,2,1,8,6,5]</div><div class="line">dict = defaultdict(int)</div><div class="line">for i in list:</div><div class="line">	dict[i]+=1</div></pre></td></tr></table></figure></p>
<hr/>
<p><strong>更加健壮的python程序需要进行参数检查：</strong></p>
<p>要检查的数据有：</p>
<ol>
<li>用户输出的数据</li>
<li>从文件中解析出来的数据，如从网页中解析出来的数据，从txt中获取的数据</li>
</ol>
<p>需要在以下几个地方做参数检查：</p>
<ol>
<li>最初遇到这种参数时就做出了检查</li>
<li>必须保证安全性关键的子函数，如果def download(url)</li>
<li>检测函数中，经常会做切片分析检测，要防止越界</li>
</ol>
</div>
<div>
</div>
<div>
</div>
<div>
</div>
<footer class="post-footer">
<div class="post-nav">
<div class="post-nav-next post-nav-item">
<a href="/2017/05/31/mysql数据库编码问题的原因与解决方法/" rel="next" title="mysql数据库编码问题的原因与解决方法">
<i class="fa fa-chevron-left"></i> mysql数据库编码问题的原因与解决方法
              </a>
</div>
<span class="post-nav-divider"></span>
<div class="post-nav-prev post-nav-item">
<a href="/2017/05/11/PHP文件包含的利用思路/" rel="prev" title="PHP文件包含的利用思路">
                PHP文件包含的利用思路 <i class="fa fa-chevron-right"></i>
</a>
</div>
</div>
</footer>
</article>
<div class="post-spread">
</div>
</div>
</div>
<div class="comments" id="comments">
</div>
</div>
<div class="sidebar-toggle">
<div class="sidebar-toggle-line-wrap">
<span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
</div>
</div>
<aside class="sidebar" id="sidebar">
<div class="sidebar-inner">
<section class="site-overview sidebar-panel sidebar-panel-active">
<div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<img alt="Yiruma" class="site-author-image" itemprop="image" src="./优化pythonicYiruma/avatar.gif"/>
<p class="site-author-name" itemprop="name">Yiruma</p>
<p class="site-description motion-element" itemprop="description"></p>
</div>
<nav class="site-state motion-element">
<div class="site-state-item site-state-posts">
<a href="/archives">
<span class="site-state-item-count">13</span>
<span class="site-state-item-name">posts</span>
</a>
</div>
<div class="site-state-item site-state-tags">
<span class="site-state-item-count">1</span>
<span class="site-state-item-name">tags</span>
</div>
</nav>
<div class="links-of-author motion-element">
</div>
</section>
</div>
</aside>
</div>
</main>
<footer class="footer" id="footer">
<div class="footer-inner">
<div class="copyright">
  
  © 
  <span itemprop="copyrightYear">2017</span>
<span class="with-love">
<i class="fa fa-heart"></i>
</span>
<span class="author" itemprop="copyrightHolder">Yiruma</span>
</div>
<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>
<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
</div>
</footer>
<div class="back-to-top">
<i class="fa fa-arrow-up"></i>
</div>
</div>
<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script src="./优化pythonicYiruma/index.jsv=2.1.3" type="text/javascript"></script>
<script src="./优化pythonicYiruma/fastclick.min.jsv=1.0.6" type="text/javascript"></script>
<script src="./优化pythonicYiruma/jquery.lazyload.jsv=1.9.7" type="text/javascript"></script>
<script src="./优化pythonicYiruma/velocity.min.jsv=1.2.1" type="text/javascript"></script>
<script src="./优化pythonicYiruma/velocity.ui.min.jsv=1.2.1" type="text/javascript"></script>
<script src="./优化pythonicYiruma/jquery.fancybox.pack.jsv=2.1.5" type="text/javascript"></script>
<script src="./优化pythonicYiruma/utils.jsv=5.1.1" type="text/javascript"></script>
<script src="./优化pythonicYiruma/motion.jsv=5.1.1" type="text/javascript"></script>
<script src="./优化pythonicYiruma/scrollspy.jsv=5.1.1" type="text/javascript"></script>
<script src="./优化pythonicYiruma/post-details.jsv=5.1.1" type="text/javascript"></script>
<script src="./优化pythonicYiruma/bootstrap.jsv=5.1.1" type="text/javascript"></script>
</body>
</html>
