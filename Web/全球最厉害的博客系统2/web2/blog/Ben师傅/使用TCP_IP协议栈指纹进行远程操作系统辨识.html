<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<title>Bendawang's Site</title>
<link href="./使用TCP_IP协议栈指纹进行远程操作系统辨识/font-awesome.min.css" rel="stylesheet"/>
<link href="./使用TCP_IP协议栈指纹进行远程操作系统辨识/screen.css" rel="stylesheet"/>
<link href="./使用TCP_IP协议栈指纹进行远程操作系统辨识/prism_okaidia.css" rel="stylesheet"/>
<link href="./使用TCP_IP协议栈指纹进行远程操作系统辨识/bendawang.css" rel="stylesheet"/>
<script src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/jquery.min.js"></script>
</head>
<body class="wrap">
<header>
<nav class="mobile-nav show-on-mobiles">
<ul>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
<div class="show-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/bendawang.png" style="display:block;width:100%;"/></a>
</h1>
</div>
<div class="grid hide-on-mobiles">
<div class="unit test2 hide-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img alt="" height="115" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/bendawang.png" width="449"/></a>
</h1>
</div>
<nav class="main-nav unit test1 hide-on-mobiles">
<ul>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
</div>
</header>
<script>
$('document').ready(function(){
    $('li[class]:eq(4)').attr('class','current');
});
</script>
<section class="docs">
<div class="grid">
<!--移动端-->
<div class="show-on-mobiles">
<div class="article-info profile-block">
<div class="article-info-block">
               55
               <span>文章</span>
</div>
<div class="article-info-block">
               5
               <span>标签</span>
</div>
</div>
<div class="profile-block social-links">
<table>
<tbody><tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i></a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i></a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i></a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody></table>
</div>
<div class="whole show-on-mobiles">
<article class="bdw_article">
<div class="Bendawang" id="Bendawang_mobile">
<b id="Bendawang_toggle_mobile" title="收起">目录[+]</b></div></article></div></div></div></section></body></html>
<div class="Bendawang_content" id="Bendawang_content_mobile"></div>

<br/>
<br/>
<h1 id="tcpip">使用TCP/IP协议栈指纹进行远程操作系统辨识</h1>
<p style="max-width:100%;height:auto;">（ ps：主要参照fyoder的《使用TCP/IP协议栈指纹进行远程操作系统辨识》一文）</p>
<h2 id="1">1、什么是协议栈指纹</h2>
<p style="max-width:100%;height:auto;">协议栈指纹就是各个厂家，如微软和RedHat等在编写自己的TCP/IP协议栈时，却做出了不同的解释。这些解释因具有独一无二的特性，故被称为“指纹”。(来自百度知道)</p>
<h2 id="2">2、协议栈指纹有什么用</h2>
<p style="max-width:100%;height:auto;">协议栈指纹识别是一项强大的技术，能够以很高的概率迅速确定操作系统的版本。因为由于各个厂家在编写自己的TCP/IP协议栈存在差别，而我们通过这些细微的差别，可以准确定位操作系统的版本。</p>
<h2 id="3">3、协议栈指纹识别技术</h2>
<h3 id="31">3.1经典技术</h3>
<h4 id="311telnet">3.1.1 TELNET 服务</h4>
<p style="max-width:100%;height:auto;">我简单做了测试，以win7系统开启telnet服务器，然后用kali 1.0和win10去连接，服务器ip为192.168.80.130。</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/20160310103940248" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">然后下面是kali和win10分别返回的截图</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/20160310103950181" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/20160310103958463" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">由此既可以判断出系统是windows系统，但是具体是什么版本的windows系统目前看来是无法判断的。</p>
<h4 id="312ftp">3.1.2 FTP 服务</h4>
<p style="max-width:100%;height:auto;">同样，原理合上述差不多，此处就不做赘述。</p>
<h3 id="32">3.2 现有指纹技术</h3>
<ul>
<li>1、FIN 探测器
这里我们发送一个 FIN 包（或任何其他不带 ACK 或 SYN 标记的数据包）给一个打开的端口并等待回应。按照 RFC，正确的行为是不响应 ，但例如 MS Windows、BSDI、CISCO、HP/UX、MVS 和 IRIX 等都会发回一个 RESET从而暴露OS版本特征。</li>
<li>2、BOGUS 标记探测器
发送一个含有未定义的TCP标记(64或者128)的TCP头的SYN包，那么一些操作系统的回应将包含这个未定义的标记，而其它一些系统收到SYN+BOGUS包将关闭连接，利用这些特性可以识别一些操作系统。</li>
<li>3、ISN采样探测
这个方法是找出当响应一个连接请求时由 TCP 实现所选择的初始化序列数的式样，这样可以区分一些操作系统。 例如传统的 64K 、随机增量或真“随机”。Windows(和一些其他系统)则使用一个“时间相关”模型，每过一段时间 ISN 就被加上一个小的固定数， 不用说， 这几乎和老的 64K 实现一样容易攻破。甚至还可以通过计算其随机
数的变化量、 最大公约数以及序列数的其他函数之间的差异之类的方法再进一步地进行分组。</li>
<li>4、ICMP 消息引用
RFC 规定 ICMP 错误消息可以引用一部分引起错误的源数据包。对于一个端口不可达消息，几乎所有实现都只送回 IP 头和其后的 8 个字节。所以可以在对方没有开放端口的情况下就能探测到对方的OS</li>
<li>5、TCP 选项
即TCP报文的选项域：　每个选项的开始是1字节的kind字段，说明选项的类型。</li>
</ul>
<pre><code class="url language-url" style="max-width:100%;height:auto;">Kind=0:选项表结束（1字节）
Kind=1:无操作（1字节）
Kind=2：最大报文段长度（4字节）
Kind=3:窗口扩大因子（4字节）
Kind=8:时间戳（10字节）
</code></pre>
<p style="max-width:100%;height:auto;">TCP报文的选项通常是可选的 ，所以并非所有实现都支持；如果某个实现发送了设置选项的请求，目标将通过在回复中进行设置来表示响应；只需在一个数据包中进行设置，一次就能测试
所有选项。而不同的操作系统支持的选项集不同，故可以通过选项的取值来分辨出它们</p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>



<!--PC端-->
<div class="unit one-fifth hide-on-mobiles" id="scroll" style="position:absolute;left:30px">
<div class="inner profile-inner">
<div class="base-info profile-block">
<img id="avatar" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/logo.jpg"/>
<h2 id="name" style="text-align:center">Bendawang</h2>
<span id="location" style="font-size:18px">
<i class="fa fa-map-marker"></i>SiChuan, China</span>
<a href="/about" id="follow">联系我</a></div>
<div class="article-info profile-block">
<div class="article-info-block">
        55
          <span>文章</span></div>
<div class="article-info-block">
        5
          <span>标签</span></div>
</div>
<div class="profile-block social-links hide-on-mobiles">
<table>
<tbody>
<tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i>
</a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i>
</a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i>
</a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="unit three-quarters hide-on-mobiles">
<article class="bdw_article">
<h1 id="tcpip">使用TCP/IP协议栈指纹进行远程操作系统辨识</h1>
<p style="max-width:100%;height:auto;">（ ps：主要参照fyoder的《使用TCP/IP协议栈指纹进行远程操作系统辨识》一文）</p>
<h2 id="1">1、什么是协议栈指纹</h2>
<p style="max-width:100%;height:auto;">协议栈指纹就是各个厂家，如微软和RedHat等在编写自己的TCP/IP协议栈时，却做出了不同的解释。这些解释因具有独一无二的特性，故被称为“指纹”。(来自百度知道)</p>
<h2 id="2">2、协议栈指纹有什么用</h2>
<p style="max-width:100%;height:auto;">协议栈指纹识别是一项强大的技术，能够以很高的概率迅速确定操作系统的版本。因为由于各个厂家在编写自己的TCP/IP协议栈存在差别，而我们通过这些细微的差别，可以准确定位操作系统的版本。</p>
<h2 id="3">3、协议栈指纹识别技术</h2>
<h3 id="31">3.1经典技术</h3>
<h4 id="311telnet">3.1.1 TELNET 服务</h4>
<p style="max-width:100%;height:auto;">我简单做了测试，以win7系统开启telnet服务器，然后用kali 1.0和win10去连接，服务器ip为192.168.80.130。</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/20160310103940248" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">然后下面是kali和win10分别返回的截图</p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/20160310103950181" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;"><br/><img alt="这里写图片描述" data-action="zoom" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/20160310103958463" style="max-width:100%;height:auto;"/><br/></p>
<p style="max-width:100%;height:auto;">由此既可以判断出系统是windows系统，但是具体是什么版本的windows系统目前看来是无法判断的。</p>
<h4 id="312ftp">3.1.2 FTP 服务</h4>
<p style="max-width:100%;height:auto;">同样，原理合上述差不多，此处就不做赘述。</p>
<h3 id="32">3.2 现有指纹技术</h3>
<ul>
<li>1、FIN 探测器
这里我们发送一个 FIN 包（或任何其他不带 ACK 或 SYN 标记的数据包）给一个打开的端口并等待回应。按照 RFC，正确的行为是不响应 ，但例如 MS Windows、BSDI、CISCO、HP/UX、MVS 和 IRIX 等都会发回一个 RESET从而暴露OS版本特征。</li>
<li>2、BOGUS 标记探测器
发送一个含有未定义的TCP标记(64或者128)的TCP头的SYN包，那么一些操作系统的回应将包含这个未定义的标记，而其它一些系统收到SYN+BOGUS包将关闭连接，利用这些特性可以识别一些操作系统。</li>
<li>3、ISN采样探测
这个方法是找出当响应一个连接请求时由 TCP 实现所选择的初始化序列数的式样，这样可以区分一些操作系统。 例如传统的 64K 、随机增量或真“随机”。Windows(和一些其他系统)则使用一个“时间相关”模型，每过一段时间 ISN 就被加上一个小的固定数， 不用说， 这几乎和老的 64K 实现一样容易攻破。甚至还可以通过计算其随机
数的变化量、 最大公约数以及序列数的其他函数之间的差异之类的方法再进一步地进行分组。</li>
<li>4、ICMP 消息引用
RFC 规定 ICMP 错误消息可以引用一部分引起错误的源数据包。对于一个端口不可达消息，几乎所有实现都只送回 IP 头和其后的 8 个字节。所以可以在对方没有开放端口的情况下就能探测到对方的OS</li>
<li>5、TCP 选项
即TCP报文的选项域：　每个选项的开始是1字节的kind字段，说明选项的类型。</li>
</ul>
<pre><code class="url language-url" style="max-width:100%;height:auto;">Kind=0:选项表结束（1字节）
Kind=1:无操作（1字节）
Kind=2：最大报文段长度（4字节）
Kind=3:窗口扩大因子（4字节）
Kind=8:时间戳（10字节）
</code></pre>
<p style="max-width:100%;height:auto;">TCP报文的选项通常是可选的 ，所以并非所有实现都支持；如果某个实现发送了设置选项的请求，目标将通过在回复中进行设置来表示响应；只需在一个数据包中进行设置，一次就能测试
所有选项。而不同的操作系统支持的选项集不同，故可以通过选项的取值来分辨出它们</p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>
</article>
</div>
<div class="unit one-fifth hide-on-mobiles godness">
<aside>
<div class="Bendawang" id="Bendawang" style="position:absolute;">
<b id="Bendawang_toggle" style="cursor:pointer;" title="收起">目录[+]</b></div></aside></div>
<div class="Bendawang_content" id="Bendawang_content"></div>

<img class="yukino" id="yukino" src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/41.png" style="position:absolute;"/>




<footer>
<div class="show-on-mobiles">
<div style="display:inline-block">
<div style="vertical-align:middle;">
            Copyright©
            <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder"><a href="http://bendawang.site/" style="font-size:16px">Bendawang</a></span>
</div>
</div>
<div style="vertical-align:middle;">
<span>Designed By</span>
<a href="http://blog.csdn.net/qq_19876131"><img src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/bendawang2.png"/></a>
</div>
</div>
<div class="grid hide-on-mobiles">
<div class="unit one-third center-on-mobiles">
<div class="copyright">
          Copyright©
          <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder">   <a href="http://bendawang.site/">Bendawang</a></span>
</div>
</div>
<div class="unit two-thirds align-right center-on-mobiles">
<p>Designed By
          <a href="http://blog.csdn.net/qq_19876131">
<img src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/bendawang2.png"/>
</a>
</p>
</div>
</div>
</footer>
<script src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/prism.js"></script>
<script src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/zooming.js"></script>
<script src="./使用TCP_IP协议栈指纹进行远程操作系统辨识/Bendawang.js"></script>


