<!DOCTYPE html>

<html lang="zh-Hans">
<head>
<!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->
<meta charset="utf-8"/>
<meta content="IE=edge, chrome=1" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<meta content="telephone=no" name="format-detection">
<meta content="LoRexxar" name="author"/>
<meta content="sqlmap是web狗永远也绕不过去的神器，为了能自由的使用sqlmap，阅读源码还是有必要的…" name="description"/>
<meta content="article" property="og:type"/>
<meta content="sqlmap 源码分析（二）初始化" property="og:title"/>
<meta content="http://lorexxar.cn/2016/08/11/sqlmap-source2/index.html" property="og:url"/>
<meta content="LoRexxar's Blog" property="og:site_name"/>
<meta content="sqlmap是web狗永远也绕不过去的神器，为了能自由的使用sqlmap，阅读源码还是有必要的…" property="og:description"/>
<meta content="2016-08-16T05:58:38.000Z" property="og:updated_time"/>
<meta content="summary" name="twitter:card"/>
<meta content="sqlmap 源码分析（二）初始化" name="twitter:title"/>
<meta content="sqlmap是web狗永远也绕不过去的神器，为了能自由的使用sqlmap，阅读源码还是有必要的…" name="twitter:description"/>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/apple-touch-icon.png" rel="apple-touch-icon"/>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/atom.xml" rel="alternate" title="LoRexxar's Blog" type="application/atom+xml"/>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/699-14040QPP9.jpg" rel="shortcut icon"/>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/jquery.fancybox.min.css" rel="stylesheet"/>
<script src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/pace.min.js"></script>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/pace-theme-minimal.css" rel="stylesheet"/>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/style.css" rel="stylesheet"/>
<link href="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/font-awesome.min.css" rel="stylesheet"/>
<title>sqlmap 源码分析（二）初始化 | LoRexxar's Blog</title>
<script src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/jquery.min.js"></script>
<script src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/clipboard.min.js"></script>
<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>
<script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>
<script> yiliaConfig.rootUrl = "\/";</script>
<script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?736cd32ff67d23a009e16622fd600527";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</meta></meta></head>
<body>
<div id="container">
<div class="left-col">
<div class="overlay"></div>
<div class="intrude-less">
<header class="inner" id="header">
<a class="profilepic" href="/">
<img class="animated zoomIn" src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/699-14040QPP9.jpg"/>
</a>
<hgroup>
<h1 class="header-author"><a href="/">LoRexxar</a></h1>
</hgroup>
<p class="header-subtitle">带着对技术的敬畏之心成长，不安于一隅...</p>
<form id="search-form">
<input autocomplete="off" autocorrect="off" class="search form-control" id="local-search-input" name="q" placeholder="search..." searchonload="false" type="text"/>
<i class="fa fa-times" onclick="resetSearch()"></i>
</form>
<div id="local-search-result"></div>
<p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p>
<div class="switch-btn" id="switch-btn">
<div class="icon">
<div class="icon-ctn">
<div class="icon-wrap icon-house" data-idx="0">
<div class="birdhouse"></div>
<div class="birdhouse_holes"></div>
</div>
<div class="icon-wrap icon-ribbon hide" data-idx="1">
<div class="ribbon"></div>
</div>
<div class="icon-wrap icon-link hide" data-idx="2">
<div class="loopback_l"></div>
<div class="loopback_r"></div>
</div>
<div class="icon-wrap icon-me hide" data-idx="3">
<div class="user"></div>
<div class="shoulder"></div>
</div>
</div>
</div>
<div class="tips-box hide">
<div class="tips-arrow"></div>
<ul class="tips-inner">
<li>菜单</li>
<li>标签</li>
<li>友情链接</li>
<li>关于我</li>
</ul>
</div>
</div>
<div class="switch-area" id="switch-area">
<div class="switch-wrap">
<section class="switch-part switch-part1">
<nav class="header-menu">
<ul>
<li><a href="/">主页</a></li>
<li><a href="/archives/">所有文章</a></li>
<li><a href="/tags/">标签云</a></li>
<li><a href="/about/">关于我</a></li>
</ul>
</nav>
<nav class="header-nav">
<ul class="social">
<a class="fa Email" href="/lorexxar@gmail.com" title="Email"></a>
<a class="fa 新浪微博" href="/强行被换号的LoRexxar" title="新浪微博"></a>
<a class="fa GitHub" href="https://github.com/LoRexxar" title="GitHub"></a>
<a class="fa RSS" href="/atom.xml" title="RSS"></a>
<a class="fa 知乎" href="https://www.zhihu.com/people/romor-rexxar" title="知乎"></a>
</ul>
</nav>
</section>
<section class="switch-part switch-part2">
<div class="widget tagcloud" id="js-tagcloud">
<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/0day/">0day</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blogs/">Blogs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CBC/">CBC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Essay/">Essay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Essry/">Essry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IPC通道入侵/">IPC通道入侵</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LD-PRELOAD/">LD_PRELOAD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LFI/">LFI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RSA/">RSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reprint/">Reprint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shadow-Brokers/">Shadow Brokers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/access/">access</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book-notes/">book_notes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bookshelf/">bookshelf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloudeye/">cloudeye</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmd/">cmd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crontab/">crontab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crypto/">crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csp/">csp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csrf/">csrf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/">curl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cve/">cve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dns/">dns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eassy/">eassy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastcgi/">fastcgi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fcgi/">fcgi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/file-put-contents/">file_put_contents</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game/">game</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gopher/">gopher</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hctf/">hctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/injection/">injection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lcx端口转发/">lcx端口转发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lfi/">lfi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/misc/">misc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/msf/">msf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opcache/">opcache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdflatex/">pdflatex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php-opcache/">php opcache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phpmailer/">phpmailer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php伪协议/">php伪协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/">pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwnhub/">pwnhub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabins/">rabins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sangebaimao/">sangebaimao</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqli/">sqli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/">sqlmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh-sock5/">ssh_sock5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssrf/">ssrf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/titan-souls/">titan_souls</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tqdm/">tqdm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenv/">virtualenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weblogic/">weblogic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/">wget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win-server信息收集/">win server信息收集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/伪协议/">伪协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/参数污染/">参数污染</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/格式化字符串/">格式化字符串</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/模板注入/">模板注入</a></li></ul>
</div>
</section>
<section class="switch-part switch-part3">
<div id="js-friends">
<a class="main-nav-link switch-friends-link" href="https://coding.net/u/LoRexxar">Coding</a>
<a class="main-nav-link switch-friends-link" href="https://github.com/LoRexxar">GitHub</a>
<a class="main-nav-link switch-friends-link" href="http://hduisa.cn">HDUISA</a>
<a class="main-nav-link switch-friends-link" href="https://wiki.hduisa.cn">HDUISA_wiki</a>
<a class="main-nav-link switch-friends-link" href="https://lightless.me/">lightless</a>
<a class="main-nav-link switch-friends-link" href="http://lazysheep.cc">Hcamael</a>
<a class="main-nav-link switch-friends-link" href="http://aklis.info/">Aklis</a>
<a class="main-nav-link switch-friends-link" href="http://libc.pw/">zh_explorer</a>
<a class="main-nav-link switch-friends-link" href="http://edwardl.xyz/">Edward_L</a>
<a class="main-nav-link switch-friends-link" href="http://evilddog.space/">evilddog</a>
<a class="main-nav-link switch-friends-link" href="http://www.venenof.com/">Veneno</a>
<a class="main-nav-link switch-friends-link" href="http://www.nohackair.net/">Airbasic</a>
<a class="main-nav-link switch-friends-link" href="https://loli.be/">Mashiro</a>
<a class="main-nav-link switch-friends-link" href="http://www.codersec.net/">bsmali4</a>
<a class="main-nav-link switch-friends-link" href="/www.bertramc.cn">berTrAM</a>
</div>
</section>
<section class="switch-part switch-part4">
<div id="js-aboutme">带着对技术的敬畏之心成长，不安于一隅...</div>
</section>
</div>
</div>
</header>
</div>
</div>
<div class="mid-col">
<nav id="mobile-nav">
<div class="overlay">
<div class="slider-trigger"></div>
<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">LoRexxar</a></h1>
</div>
<div class="intrude-less">
<header class="inner" id="header">
<a class="profilepic" href="/">
<img class="animated zoomIn" src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/699-14040QPP9.jpg"/>
</a>
<hgroup>
<h1 class="header-author"><a href="/" title="回到主页">LoRexxar</a></h1>
</hgroup>
<p class="header-subtitle">带着对技术的敬畏之心成长，不安于一隅...</p>
<nav class="header-menu">
<ul>
<li><a href="/">主页</a></li>
<li><a href="/archives/">所有文章</a></li>
<li><a href="/tags/">标签云</a></li>
<li><a href="/about/">关于我</a></li>
<div class="clearfix"></div>
</ul>
</nav>
<nav class="header-nav">
<ul class="social">
<a class="fa Email" href="/lorexxar@gmail.com" target="_blank" title="Email"></a>
<a class="fa 新浪微博" href="/强行被换号的LoRexxar" target="_blank" title="新浪微博"></a>
<a class="fa GitHub" href="https://github.com/LoRexxar" target="_blank" title="GitHub"></a>
<a class="fa RSS" href="/atom.xml" target="_blank" title="RSS"></a>
<a class="fa 知乎" href="https://www.zhihu.com/people/romor-rexxar" target="_blank" title="知乎"></a>
</ul>
</nav>
</header>
</div>
<link about="关于我" class="menu-list" friends="友情链接" tags="标签">
</link></nav>
<div class="body-wrap"><article class="article article-type-post" id="post-sqlmap-source2" itemprop="blogPost" itemscope="">
<div class="article-meta">
<a class="article-date" href="/2016/08/11/sqlmap-source2/">
<time datetime="2016-08-11T07:19:19.000Z" itemprop="datePublished">2016-08-11</time>
</a>
</div>
<div class="article-inner">
<input class="isFancy" type="hidden"/>
<header class="article-header">
<h1 class="article-title" itemprop="name">
      sqlmap 源码分析（二）初始化
    </h1>
</header>
<div class="article-info article-info-post">
<div class="article-category tagcloud">
<a class="article-category-link" href="/categories/Blogs/">Blogs</a>
</div>
<div class="article-tag tagcloud">
<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlmap/">sqlmap</a></li></ul>
</div>
<div class="clearfix"></div>
</div>
<div class="article-entry" itemprop="articleBody">
<p>sqlmap是web狗永远也绕不过去的神器，为了能自由的使用sqlmap，阅读源码还是有必要的…</p>
<a id="more"></a>
<h1 id="初始化"><a class="headerlink" href="#初始化" title="初始化"></a>初始化</h1><p>参数解析完后，开始初始化<br/><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">init</span><span class="params">(cmdLineOptions)</span></span></div></pre></td></tr></table></figure></p>
<p>这一部分主要是根据之前的参数，设置属性和很多基于命令行和配置文件的选项</p>
<h2 id="初始化一些必要的配置属性"><a class="headerlink" href="#初始化一些必要的配置属性" title="初始化一些必要的配置属性"></a>初始化一些必要的配置属性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">debugMsg = "initializing the configuration"</div><div class="line">    logger.debug(debugMsg)</div><div class="line"></div><div class="line">    conf.boundaries       = []</div><div class="line">    conf.cj               = None</div><div class="line">    conf.dbmsConnector    = None</div><div class="line">    conf.dbmsHandler      = None</div><div class="line">    conf.dumpPath         = None</div><div class="line">    conf.httpHeaders      = []</div><div class="line">    conf.hostname         = None</div><div class="line">    conf.loggedToOut      = None</div><div class="line">    conf.multipleTargets  = False</div><div class="line">    conf.outputPath       = None</div><div class="line">    conf.paramDict        = {}</div><div class="line">    conf.parameters       = {}</div><div class="line">    conf.path             = None</div><div class="line">    conf.port             = None</div><div class="line">    conf.redirectHandled  = False</div><div class="line">    conf.scheme           = None</div><div class="line">    conf.sessionFP        = None</div><div class="line">    conf.start            = True</div><div class="line">    conf.tests            = []</div><div class="line">    conf.trafficFP        = None</div><div class="line">    conf.wFileType        = None</div></pre></td></tr></table></figure>
<p>后面也相同<br/><code>__setKnowledgeBaseAttributes()</code></p>
<p>初始化了一些有关知识库配置的参数</p>
<p>然后是配置文件的初始化<br/><code>__mergeOptions(inputOptions, overrideOptions)</code></p>
<h1 id="新手引导"><a class="headerlink" href="#新手引导" title="新手引导"></a>新手引导</h1><p>在分析参数的时候有一个叫做wizard的参数，是关于新手引导的，如果开启就会进入引导页面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__useWizardInterface</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Presents simple wizard interface for beginner users</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> conf.wizard:</div><div class="line">        <span class="keyword">return</span></div><div class="line"></div><div class="line">    logger.info(<span class="string">"starting wizard interface"</span>)</div><div class="line"></div><div class="line">    <span class="keyword">while</span> <span class="keyword">not</span> conf.url:</div><div class="line">        message = <span class="string">"Please enter full target URL (-u): "</span></div><div class="line">        conf.url = readInput(message, default=<span class="keyword">None</span>)</div><div class="line"></div><div class="line">    message = <span class="string">"POST data (--data) [Enter for None]: "</span></div><div class="line">    conf.data = readInput(message, default=<span class="keyword">None</span>)</div><div class="line"></div><div class="line">    choice = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span> choice <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> choice <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">""</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>):</div><div class="line">        message = <span class="string">"Injection difficulty (--level/--risk). Please choose:\n"</span></div><div class="line">        message += <span class="string">"[1] Normal (default)\n[2] Medium\n[3] Hard"</span></div><div class="line">        choice = readInput(message, default=<span class="string">'1'</span>)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> choice == <span class="string">'2'</span>:</div><div class="line">            conf.risk = <span class="number">2</span></div><div class="line">            conf.level = <span class="number">3</span></div><div class="line">        <span class="keyword">elif</span> choice == <span class="string">'3'</span>:</div><div class="line">            conf.risk = <span class="number">3</span></div><div class="line">            conf.level = <span class="number">5</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            conf.risk = <span class="number">1</span></div><div class="line">            conf.level = <span class="number">1</span></div><div class="line"></div><div class="line">    choice = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span> choice <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> choice <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">""</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>):</div><div class="line">        message = <span class="string">"Enumeration (--banner/--current-user/etc). Please choose:\n"</span></div><div class="line">        message += <span class="string">"[1] Basic (default)\n[2] Smart\n[3] All"</span></div><div class="line">        choice = readInput(message, default=<span class="string">'1'</span>)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> choice == <span class="string">'2'</span>:</div><div class="line">            map(<span class="keyword">lambda</span> x: conf.__setitem__(x, <span class="keyword">True</span>), [<span class="string">'getBanner'</span>, <span class="string">'getCurrentUser'</span>, <span class="string">'getCurrentDb'</span>, <span class="string">'isDba'</span>, <span class="string">'getUsers'</span>, <span class="string">'getDbs'</span>, <span class="string">'getTables'</span>, <span class="string">'excludeSysDbs'</span>])</div><div class="line">        <span class="keyword">elif</span> choice == <span class="string">'3'</span>:</div><div class="line">            map(<span class="keyword">lambda</span> x: conf.__setitem__(x, <span class="keyword">True</span>), [<span class="string">'getBanner'</span>, <span class="string">'getCurrentUser'</span>, <span class="string">'getCurrentDb'</span>, <span class="string">'isDba'</span>, <span class="string">'getUsers'</span>, <span class="string">'getPasswordHashes'</span>, <span class="string">'getPrivileges'</span>, <span class="string">'getRoles'</span>, <span class="string">'dumpAll'</span>])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            map(<span class="keyword">lambda</span> x: conf.__setitem__(x, <span class="keyword">True</span>), [<span class="string">'getBanner'</span>, <span class="string">'getCurrentUser'</span>, <span class="string">'getCurrentDb'</span>, <span class="string">'isDba'</span>])</div><div class="line"></div><div class="line">    conf.batch = <span class="keyword">True</span></div><div class="line">    conf.threads = <span class="number">4</span></div><div class="line"></div><div class="line">    logger.debug(<span class="string">"muting sqlmap.. it will do the magic for you"</span>)</div><div class="line">    conf.verbose = <span class="number">0</span></div><div class="line"></div><div class="line">    dataToStdout(<span class="string">"\nsqlmap is running, please wait..\n\n"</span>)</div></pre></td></tr></table></figure>
<p>从输入目标url<br/>–&gt;post数据<br/>–&gt;选择注入级别<br/>–&gt;注入目标的选择<br/>–&gt;配置完毕</p>
<h1 id="设置输出log级别"><a class="headerlink" href="#设置输出log级别" title="设置输出log级别"></a>设置输出log级别</h1><p><code>__setVerbosity():</code></p>
<p>这里主要是设置了一些输出的log级别，在logger的基本设置上，sqlmap还拓展到了8级<br/><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">def __setVerbosity():</div><div class="line">    <span class="string">""</span><span class="comment">"</span></div><div class="line">    This <span class="function"><span class="keyword">function</span> <span class="title">set</span> <span class="title">the</span> <span class="title">verbosity</span> <span class="title">of</span> <span class="title">sqlmap</span> <span class="title">output</span> <span class="title">messages</span>.</span></div><div class="line">    <span class="string">""</span><span class="comment">"</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.<span class="keyword">verbose</span> <span class="keyword">is</span> None:</div><div class="line">        <span class="keyword">conf</span>.<span class="keyword">verbose</span> = <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="keyword">conf</span>.<span class="keyword">verbose</span> = <span class="keyword">int</span>(<span class="keyword">conf</span>.<span class="keyword">verbose</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.<span class="keyword">verbose</span> == <span class="number">0</span>:</div><div class="line">        logger.setLevel(logging.ERROR)</div><div class="line">    elif <span class="keyword">conf</span>.<span class="keyword">verbose</span> == <span class="number">1</span>:</div><div class="line">        logger.setLevel(logging.INFO)</div><div class="line">    elif <span class="keyword">conf</span>.<span class="keyword">verbose</span> &gt; <span class="number">2</span> <span class="built_in">and</span> <span class="keyword">conf</span>.et<span class="variable">a:</span></div><div class="line">        <span class="keyword">conf</span>.<span class="keyword">verbose</span> = <span class="number">2</span></div><div class="line">        logger.setLevel(logging.DEBUG)</div><div class="line">    elif <span class="keyword">conf</span>.<span class="keyword">verbose</span> == <span class="number">2</span>:</div><div class="line">        logger.setLevel(logging.DEBUG)</div><div class="line">    elif <span class="keyword">conf</span>.<span class="keyword">verbose</span> == <span class="number">3</span>:</div><div class="line">        logger.setLevel(<span class="number">9</span>)</div><div class="line">    elif <span class="keyword">conf</span>.<span class="keyword">verbose</span> == <span class="number">4</span>:</div><div class="line">        logger.setLevel(<span class="number">8</span>)</div><div class="line">    elif <span class="keyword">conf</span>.<span class="keyword">verbose</span> &gt;= <span class="number">5</span>:</div><div class="line">        logger.setLevel(<span class="number">7</span>)</div></pre></td></tr></table></figure></p>
<h1 id="保存命令行的配置到ini文件"><a class="headerlink" href="#保存命令行的配置到ini文件" title="保存命令行的配置到ini文件"></a>保存命令行的配置到ini文件</h1><p>当然，和前面的新手引导类似，这是需要额外参数才会进行的配置</p>
<p><code>__saveCmdline</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__saveCmdline</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Saves the command line options on a sqlmap configuration INI file</div><div class="line">    Format.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> conf.saveCmdline:</div><div class="line">        <span class="keyword">return</span></div><div class="line"></div><div class="line">    debugMsg = <span class="string">"saving command line options on a sqlmap configuration INI file"</span></div><div class="line">    logger.debug(debugMsg)</div><div class="line"></div><div class="line">    config = UnicodeRawConfigParser()</div><div class="line">    userOpts = {}</div><div class="line"></div><div class="line">    <span class="keyword">for</span> family <span class="keyword">in</span> optDict.keys():</div><div class="line">        userOpts[family] = []</div><div class="line"></div><div class="line">    <span class="keyword">for</span> option, value <span class="keyword">in</span> conf.items():</div><div class="line">        <span class="keyword">for</span> family, optionData <span class="keyword">in</span> optDict.items():</div><div class="line">            <span class="keyword">if</span> option <span class="keyword">in</span> optionData:</div><div class="line">                userOpts[family].append((option, value, optionData[option]))</div><div class="line"></div><div class="line">    <span class="keyword">for</span> family, optionData <span class="keyword">in</span> userOpts.items():</div><div class="line">        config.add_section(family)</div><div class="line"></div><div class="line">        optionData.sort()</div><div class="line"></div><div class="line">        <span class="keyword">for</span> option, value, datatype <span class="keyword">in</span> optionData:</div><div class="line">            <span class="keyword">if</span> isinstance(datatype, (list, tuple, set)):</div><div class="line">                datatype = datatype[<span class="number">0</span>]</div><div class="line"></div><div class="line">            <span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">                <span class="keyword">if</span> datatype == <span class="string">"boolean"</span>:</div><div class="line">                    value = <span class="string">"False"</span></div><div class="line">                <span class="keyword">elif</span> datatype <span class="keyword">in</span> ( <span class="string">"integer"</span>, <span class="string">"float"</span> ):</div><div class="line">                    <span class="keyword">if</span> option <span class="keyword">in</span> ( <span class="string">"threads"</span>, <span class="string">"verbose"</span> ):</div><div class="line">                        value = <span class="string">"1"</span></div><div class="line">                    <span class="keyword">elif</span> option == <span class="string">"timeout"</span>:</div><div class="line">                        value = <span class="string">"10"</span></div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        value = <span class="string">"0"</span></div><div class="line">                <span class="keyword">elif</span> datatype == <span class="string">"string"</span>:</div><div class="line">                    value = <span class="string">""</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> isinstance(value, basestring):</div><div class="line">                value = value.replace(<span class="string">"\n"</span>, <span class="string">"\n "</span>)</div><div class="line"></div><div class="line">            config.set(family, option, value)</div><div class="line"></div><div class="line">    confFP = openFile(paths.SQLMAP_CONFIG, <span class="string">"wb"</span>)</div><div class="line">    config.write(confFP)</div><div class="line"></div><div class="line">    infoMsg = <span class="string">"saved command line options on '%s' configuration file"</span> % paths.SQLMAP_CONFIG</div><div class="line">    logger.info(infoMsg)</div></pre></td></tr></table></figure>
<p>这里设置了默认的线程数，log日志级别、延时等等…并将其储存到了设定好的sqlmap_config目录中。</p>
<h1 id="处理从文件获取的http请求"><a class="headerlink" href="#处理从文件获取的http请求" title="处理从文件获取的http请求"></a>处理从文件获取的http请求</h1><p><code>__setRequestFromFile():</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__setRequestFromFile</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    This function checks if the way to make a HTTP request is through supplied</div><div class="line">    textual file, parses it and saves the information into the knowledge base.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> conf.requestFile:</div><div class="line">        <span class="keyword">return</span></div><div class="line"></div><div class="line">    addedTargetUrls = set()</div><div class="line"></div><div class="line">    conf.requestFile = os.path.expanduser(conf.requestFile)</div><div class="line"></div><div class="line">    infoMsg = <span class="string">"parsing HTTP request from '%s'"</span> % conf.requestFile</div><div class="line">    logger.info(infoMsg)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(conf.requestFile):</div><div class="line">        errMsg  = <span class="string">"the specified HTTP request file "</span></div><div class="line">        errMsg += <span class="string">"does not exist"</span></div><div class="line">        <span class="keyword">raise</span> sqlmapFilePathException, errMsg</div><div class="line"></div><div class="line">    __feedTargetsDict(conf.requestFile, addedTargetUrls)</div></pre></td></tr></table></figure>
<p>这里读取了conf.requestFile的内容初始化完成，然后开始处理文件内容</p>
<p><code>__feedTargetsDict(conf.requestFile, addedTargetUrls)</code></p>
<p>读取文件<br/><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">fp = openFile(reqFile, <span class="string">"rb"</span>)</div><div class="line"></div><div class="line">    <span class="built_in">content</span> = fp.<span class="built_in">read</span>()</div><div class="line">    <span class="built_in">content</span> = <span class="built_in">content</span>.replace(<span class="string">"\r"</span>, <span class="string">""</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> conf.scope:</div><div class="line">        logger.info(<span class="string">"using regular expression '%s' for filtering targets"</span> <span class="symbol">%</span> conf.scope)</div></pre></td></tr></table></figure></p>
<p>开始解包<br/><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">__parseBurpLog(<span class="name">content</span>)</div><div class="line">__parseWebScarabLog(<span class="name">content</span>)</div></pre></td></tr></table></figure></p>
<p>先是一些基本的处理和判断</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">url    = extractRegexResult(<span class="string">r"URL: (?P&lt;result&gt;.+?)\n"</span>, request, re.I)</div><div class="line">method = extractRegexResult(<span class="string">r"METHOD: (?P&lt;result&gt;.+?)\n"</span>, request, re.I)</div><div class="line">cookie = extractRegexResult(<span class="string">r"COOKIE: (?P&lt;result&gt;.+?)\n"</span>, request, re.I)</div><div class="line">getPostReq = <span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> method <span class="keyword">or</span> <span class="keyword">not</span> url:</div><div class="line">    logger.debug(<span class="string">"Invalid log data"</span>)</div><div class="line">    <span class="keyword">continue</span></div></pre></td></tr></table></figure>
<p>然后指明分析log文件是不支持post请求的<br/><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if method.upper() == <span class="string">"<span class="keyword">POST</span>"</span>:</div><div class="line">   warnMsg = <span class="string">"<span class="keyword">POST</span> requests from WebScarab logs aren't supported "</span></div><div class="line">   warnMsg += <span class="string">"as their body content is stored in separate files. "</span></div><div class="line">   warnMsg += <span class="string">"Nevertheless you can use -r to load them individually."</span></div><div class="line">   logger.warning(warnMsg)</div><div class="line">   continue</div></pre></td></tr></table></figure></p>
<p>开始解包<br/><code>__parseWebScarabLog(content)</code></p>
<p>分割出数据传输方式以及端口号<br/><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if scheme is None:</div><div class="line">   schemePort = re.search("<span class="symbol">\d</span><span class="symbol">\d</span>[<span class="symbol">\:</span>|<span class="symbol">\.</span>]<span class="symbol">\d</span><span class="symbol">\d</span>[<span class="symbol">\:</span>|<span class="symbol">\.</span>]<span class="symbol">\d</span><span class="symbol">\d</span><span class="symbol">\s</span>+(http[<span class="symbol">\w</span>]*)<span class="symbol">\:</span><span class="symbol">\/</span><span class="symbol">\/</span>.*?<span class="symbol">\:</span>([<span class="symbol">\d</span>]+)", request, re.I)</div><div class="line"></div><div class="line">   if schemePort:</div><div class="line">       scheme = schemePort.group(1)</div><div class="line">       port   = schemePort.group(2)</div></pre></td></tr></table></figure></p>
<p>跳过一些无用的行，re.search如果搜索不到就会返回None<br/><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not re.search (<span class="string">"^[\n]*(GET|POST).*?\sHTTP\/"</span>, request, re.I):</div><div class="line">    <span class="keyword">continue</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> re.search(<span class="string">"^[\n]*(GET|POST).*?\.(gif|jpg|png)\sHTTP\/"</span>, request, re.I):</div><div class="line">    <span class="keyword">continue</span></div></pre></td></tr></table></figure></p>
<p>根据请求方式的不同，用多重方式获取<br/><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">line</span>) == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">line</span> == <span class="string">"\n"</span>:</div><div class="line">    <span class="keyword">if</span> method == HTTPMETHOD.POST <span class="keyword">and</span> data is None:</div><div class="line">        data = <span class="string">""</span></div><div class="line">        <span class="built_in">params</span> = True</div><div class="line"></div><div class="line">elif (<span class="built_in">line</span>.startswith(<span class="string">"GET "</span>) <span class="keyword">or</span> <span class="built_in">line</span>.startswith(<span class="string">"POST "</span>)) <span class="keyword">and</span> <span class="string">" HTTP/"</span> <span class="keyword">in</span> <span class="built_in">line</span>:</div><div class="line">    <span class="keyword">if</span> <span class="built_in">line</span>.startswith(<span class="string">"GET "</span>):</div><div class="line">        index = <span class="number">4</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        index = <span class="number">5</span></div><div class="line"></div><div class="line">    url = <span class="built_in">line</span>[index:<span class="built_in">line</span>.index(<span class="string">" HTTP/"</span>)]</div><div class="line">    method = <span class="built_in">line</span>[:index<span class="number">-1</span>]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="string">"?"</span> <span class="keyword">in</span> <span class="built_in">line</span> <span class="keyword">and</span> <span class="string">"="</span> <span class="keyword">in</span> <span class="built_in">line</span>:</div><div class="line">        <span class="built_in">params</span> = True</div><div class="line"></div><div class="line">    getPostReq = True</div><div class="line"> <span class="comment"># POST parameters</span></div><div class="line">elif data is <span class="keyword">not</span> None <span class="keyword">and</span> <span class="built_in">params</span>:</div><div class="line">    data += <span class="built_in">line</span></div><div class="line"></div><div class="line"><span class="comment"># GET parameters</span></div><div class="line">elif <span class="string">"?"</span> <span class="keyword">in</span> <span class="built_in">line</span> <span class="keyword">and</span> <span class="string">"="</span> <span class="keyword">in</span> <span class="built_in">line</span> <span class="keyword">and</span> <span class="string">": "</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">line</span>:</div><div class="line">    <span class="built_in">params</span> = True</div></pre></td></tr></table></figure></p>
<p>然后处理请求头</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># Headers</span></div><div class="line">elif <span class="string">": "</span> <span class="keyword">in</span> <span class="built_in">line</span>:</div><div class="line">    key, <span class="built_in">value</span> = <span class="built_in">line</span>.<span class="built_in">split</span>(<span class="string">": "</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">    <span class="comment"># Cookie and Host headers</span></div><div class="line">    <span class="keyword">if</span> key.<span class="built_in">lower</span>() == <span class="string">"cookie"</span>:</div><div class="line">        cookie = <span class="built_in">value</span></div><div class="line">    elif key.<span class="built_in">lower</span>() == <span class="string">"host"</span>:</div><div class="line">        <span class="keyword">if</span> <span class="string">'://'</span> <span class="keyword">in</span> <span class="built_in">value</span>:</div><div class="line">            scheme, <span class="built_in">value</span> = <span class="built_in">value</span>.<span class="built_in">split</span>(<span class="string">'://'</span>)[:<span class="number">2</span>]</div><div class="line">        splitValue = <span class="built_in">value</span>.<span class="built_in">split</span>(<span class="string">":"</span>)</div><div class="line">        host = splitValue[<span class="number">0</span>]</div><div class="line"></div><div class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(splitValue) &gt; <span class="number">1</span>:</div><div class="line">            port = filterStringValue(splitValue[<span class="number">1</span>], <span class="string">'[0-9]'</span>)</div><div class="line"></div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> scheme <span class="keyword">and</span> port == <span class="string">"443"</span>:</div><div class="line">                scheme = <span class="string">"https"</span></div><div class="line"></div><div class="line">    <span class="comment"># Avoid to add a static content length header to</span></div><div class="line">    <span class="comment"># conf.httpHeaders and consider the following lines as</span></div><div class="line">    <span class="comment"># POSTed data</span></div><div class="line">    <span class="keyword">if</span> key == <span class="string">"Content-Length"</span>:</div><div class="line">        <span class="built_in">params</span> = True</div><div class="line"></div><div class="line">    <span class="comment"># Avoid proxy and connection type related headers</span></div><div class="line">    elif key <span class="keyword">not</span> <span class="keyword">in</span> ( <span class="string">"Proxy-Connection"</span>, <span class="string">"Connection"</span> ):</div><div class="line">        conf.httpHeaders.append((str(key), str(<span class="built_in">value</span>)))</div></pre></td></tr></table></figure>
<h1 id="一些基本的参数错误处理"><a class="headerlink" href="#一些基本的参数错误处理" title="一些基本的参数错误处理"></a>一些基本的参数错误处理</h1><p><code>__basicOptionValidation()</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">conf</span>.limitStart <span class="keyword">is</span> not None <span class="built_in">and</span> not (isinstance(<span class="keyword">conf</span>.limitStart, <span class="keyword">int</span>) <span class="built_in">and</span> <span class="keyword">conf</span>.limitStart &gt; <span class="number">0</span>):</div><div class="line">        errMsg = <span class="string">"value for --start (limitStart) option must be an integer value greater than zero (&gt;0)"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.limitStop <span class="keyword">is</span> not None <span class="built_in">and</span> not (isinstance(<span class="keyword">conf</span>.limitStop, <span class="keyword">int</span>) <span class="built_in">and</span> <span class="keyword">conf</span>.limitStop &gt; <span class="number">0</span>):</div><div class="line">        errMsg = <span class="string">"value for --stop (limitStop) option must be an integer value greater than zero (&gt;0)"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.limitStart <span class="keyword">is</span> not None <span class="built_in">and</span> isinstance(<span class="keyword">conf</span>.limitStart, <span class="keyword">int</span>) <span class="built_in">and</span> <span class="keyword">conf</span>.limitStart &gt; <span class="number">0</span> <span class="built_in">and</span> \</div><div class="line">       <span class="keyword">conf</span>.limitStop <span class="keyword">is</span> not None <span class="built_in">and</span> isinstance(<span class="keyword">conf</span>.limitStop, <span class="keyword">int</span>) <span class="built_in">and</span> <span class="keyword">conf</span>.limitStop &lt;= <span class="keyword">conf</span>.limitStar<span class="variable">t:</span></div><div class="line">        errMsg = <span class="string">"value for --start (limitStart) option must be smaller than value for --stop (limitStop) option"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.firstChar <span class="keyword">is</span> not None <span class="built_in">and</span> isinstance(<span class="keyword">conf</span>.firstChar, <span class="keyword">int</span>) <span class="built_in">and</span> <span class="keyword">conf</span>.firstChar &gt; <span class="number">0</span> <span class="built_in">and</span> \</div><div class="line">       <span class="keyword">conf</span>.lastChar <span class="keyword">is</span> not None <span class="built_in">and</span> isinstance(<span class="keyword">conf</span>.lastChar, <span class="keyword">int</span>) <span class="built_in">and</span> <span class="keyword">conf</span>.lastChar &lt; <span class="keyword">conf</span>.firstChar:</div><div class="line">        errMsg = <span class="string">"value for --first (firstChar) option must be smaller than or equal to value for --last (lastChar) option"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.cpuThrottle <span class="keyword">is</span> not None <span class="built_in">and</span> isinstance(<span class="keyword">conf</span>.cpuThrottle, <span class="keyword">int</span>) <span class="built_in">and</span> (<span class="keyword">conf</span>.cpuThrottle &gt; <span class="number">100</span> <span class="built_in">or</span> <span class="keyword">conf</span>.cpuThrottle &lt; <span class="number">0</span>):</div><div class="line">        errMsg = <span class="string">"value for --cpu-throttle (cpuThrottle) option must be in range [0,100]"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.textOnly <span class="built_in">and</span> <span class="keyword">conf</span>.nullConnection:</div><div class="line">        errMsg = <span class="string">"switch --text-only is incompatible with switch --null-connection"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.data <span class="built_in">and</span> <span class="keyword">conf</span>.nullConnection:</div><div class="line">        errMsg = <span class="string">"switch --data is incompatible with switch --null-connection"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.predictOutput <span class="built_in">and</span> <span class="keyword">conf</span>.threads &gt; <span class="number">1</span>:</div><div class="line">        errMsg = <span class="string">"switch --predict-output is incompatible with switch --threads"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.threads &gt; MAX_NUMBER_OF_THREADS:</div><div class="line">        errMsg = <span class="string">"maximum number of used threads is %d avoiding possible connection issues"</span> % MAX_NUMBER_OF_THREADS</div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.forms <span class="built_in">and</span> not <span class="keyword">conf</span>.ur<span class="variable">l:</span></div><div class="line">        errMsg = <span class="string">"switch --forms requires usage of -u (--url) switch"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.proxy <span class="built_in">and</span> <span class="keyword">conf</span>.ignoreProxy:</div><div class="line">        errMsg = <span class="string">"switch --proxy is incompatible with switch --ignore-proxy"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.forms <span class="built_in">and</span> (<span class="keyword">conf</span>.<span class="keyword">list</span> <span class="built_in">or</span> <span class="keyword">conf</span>.direct <span class="built_in">or</span> <span class="keyword">conf</span>.requestFile <span class="built_in">or</span> <span class="keyword">conf</span>.googleDork):</div><div class="line">        errMsg = <span class="string">"switch --forms is compatible only with -u (--url) target switch"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.timeSec &lt; <span class="number">1</span>:</div><div class="line">        errMsg = <span class="string">"value for --time-sec option must be an integer greater than 0"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">if</span> isinstance(<span class="keyword">conf</span>.uCols, basestring) <span class="built_in">and</span> (<span class="string">"-"</span> not in <span class="keyword">conf</span>.uCols <span class="built_in">or</span> <span class="built_in">len</span>(<span class="keyword">conf</span>.uCols.<span class="keyword">split</span>(<span class="string">"-"</span>)) != <span class="number">2</span>):</div><div class="line">        errMsg = <span class="string">"value for --union-cols must be a range with hyphon (e.g. 1-10)"</span></div><div class="line">        raise sqlmapSyntaxException, errMsg</div></pre></td></tr></table></figure>
<p>一些格式错误，内容错误都包含进去了</p>
<h1 id="加载tamper的自定义函数"><a class="headerlink" href="#加载tamper的自定义函数" title="加载tamper的自定义函数"></a>加载tamper的自定义函数</h1><p><code>__setTamperingFunctions()</code></p>
<p>看了看，没什么特别的，就是简单的加载并做了一些错误处理</p>
<h1 id="解析目标url-amp-设置一些配置"><a class="headerlink" href="#解析目标url-amp-设置一些配置" title="解析目标url&amp;设置一些配置"></a>解析目标url&amp;设置一些配置</h1><p><code>parseTargetUrl()</code><br/>首先对传入的目标url解析，分别把目标、端口、路径、域名都解析出来</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not conf<span class="selector-class">.url</span>:</div><div class="line">        return</div><div class="line"></div><div class="line">    <span class="keyword">if</span> not re.search(<span class="string">"^http[s]*://"</span>, conf.url):</div><div class="line">        <span class="keyword">if</span> <span class="string">":443/"</span> <span class="keyword">in</span> conf<span class="selector-class">.url</span>:</div><div class="line">            conf<span class="selector-class">.url</span> = <span class="string">"https://"</span> + conf<span class="selector-class">.url</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            conf<span class="selector-class">.url</span> = <span class="string">"http://"</span> + conf<span class="selector-class">.url</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> URI_INJECTION_MARK_CHAR <span class="keyword">in</span> conf<span class="selector-class">.url</span>:</div><div class="line">        conf<span class="selector-class">.url</span> = conf<span class="selector-class">.url</span><span class="selector-class">.replace</span>(<span class="string">'?'</span>, URI_QUESTION_MARKER)</div><div class="line"></div><div class="line">    __urlSplit = urlparse.urlsplit(conf.url)</div><div class="line">    __hostnamePort = __urlSplit[<span class="number">1</span>].split(<span class="string">":"</span>)</div><div class="line"></div><div class="line">    conf<span class="selector-class">.scheme</span> = __urlSplit[<span class="number">0</span>].strip()</div><div class="line">    conf<span class="selector-class">.path</span> = __urlSplit[<span class="number">2</span>].strip()</div><div class="line">    conf<span class="selector-class">.hostname</span> = __hostnamePort[<span class="number">0</span>].strip()</div></pre></td></tr></table></figure>
<p>对于不自带端口的url，专门分析并设置端口号</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> len(__hostnamePort) == <span class="number">2</span>:</div><div class="line">        try:</div><div class="line">            conf<span class="selector-class">.port</span> = int(__hostnamePort[<span class="number">1</span>])</div><div class="line">        except:</div><div class="line">            errMsg = <span class="string">"invalid target url"</span></div><div class="line">            raise sqlmapSyntaxException, errMsg</div><div class="line">    elif conf<span class="selector-class">.scheme</span> == <span class="string">"https"</span>:</div><div class="line">        conf<span class="selector-class">.port</span> = <span class="number">443</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        conf<span class="selector-class">.port</span> = <span class="number">80</span></div></pre></td></tr></table></figure>
<p>连接成conf.url<br/><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">conf</span>.url = <span class="string">"%s://%s:%d%s"</span> % (<span class="keyword">conf</span>.scheme, <span class="keyword">conf</span>.<span class="built_in">hostname</span>, <span class="keyword">conf</span>.port, <span class="keyword">conf</span>.path)</div><div class="line"><span class="keyword">conf</span>.url = <span class="keyword">conf</span>.url.replace(URI_QUESTION_MARKER, <span class="string">'?'</span>)</div></pre></td></tr></table></figure></p>
<h1 id="解析目标数据库"><a class="headerlink" href="#解析目标数据库" title="解析目标数据库"></a>解析目标数据库</h1><p>这里解析目标数据库并设置了一些配置<br/><code>parseTargetDirect()</code></p>
<p>这里处理的是直连数据库的解析函数，也就是前面提到的<code>-d</code></p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> conf.<span class="built_in">direct</span>:</div><div class="line">        <span class="built_in">return</span></div></pre></td></tr></table></figure>
<p>配置相应的参数</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> dbms in SUPPORTED_DBMS:</div><div class="line">    details = re.<span class="built_in">search</span>(<span class="string">"^(?P&lt;dbms&gt;%s)://(?P&lt;credentials&gt;(?P&lt;user&gt;.+?)\:(?P&lt;pass&gt;.*?)\@)?(?P&lt;remote&gt;(?P&lt;hostname&gt;.+?)\:(?P&lt;port&gt;[\d]+)\/)?(?P&lt;db&gt;[\w\d\ \:\.\_\-\/\\\\]+?)$"</span> % dbms, <span class="keyword">conf</span>.direct, re.I)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> detail<span class="variable">s:</span></div><div class="line">        <span class="keyword">conf</span>.dbms = details.group(<span class="string">'dbms'</span>)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> details.group(<span class="string">'credentials'</span>):</div><div class="line">            <span class="keyword">conf</span>.dbmsUser = details.group(<span class="string">'user'</span>)</div><div class="line">            <span class="keyword">conf</span>.dbmsPass = details.group(<span class="string">'pass'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">conf</span>.dbmsUser = unicode()</div><div class="line">            <span class="keyword">conf</span>.dbmsPass = unicode()</div><div class="line"></div><div class="line">        <span class="keyword">if</span> not <span class="keyword">conf</span>.dbmsPas<span class="variable">s:</span></div><div class="line">            <span class="keyword">conf</span>.dbmsPass = None</div><div class="line"></div><div class="line">        <span class="keyword">if</span> details.group(<span class="string">'remote'</span>):</div><div class="line">            remote = True</div><div class="line">            <span class="keyword">conf</span>.<span class="built_in">hostname</span> = details.group(<span class="string">'hostname'</span>)</div><div class="line">            <span class="keyword">conf</span>.port = <span class="keyword">int</span>(details.group(<span class="string">'port'</span>))</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">conf</span>.<span class="built_in">hostname</span> = <span class="string">"localhost"</span></div><div class="line">            <span class="keyword">conf</span>.port = <span class="number">0</span></div><div class="line"></div><div class="line">        <span class="keyword">conf</span>.dbmsDb = details.group(<span class="string">'db'</span>)</div><div class="line"></div><div class="line">        <span class="keyword">conf</span>.parameters[None] = <span class="string">"direct connection"</span></div><div class="line"></div><div class="line">        <span class="keyword">break</span></div></pre></td></tr></table></figure>
<p>处理并加载相应的模块</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> dbmsName <span class="built_in">in</span> (DBMS.MSSQL, DBMS.SYBASE):</div><div class="line">    <span class="keyword">import</span> _mssql</div><div class="line">    <span class="keyword">import</span> pymssql</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="built_in">not</span> hasattr(pymssql, <span class="string">"__version__"</span>) <span class="built_in">or</span> pymssql.__version__ &lt; <span class="string">"1.0.2"</span>:</div><div class="line">        errMsg = <span class="string">"pymssql library on your system must be "</span></div><div class="line">        errMsg += <span class="string">"version 1.0.2 to work, get it from "</span></div><div class="line">        errMsg += <span class="string">"http://sourceforge.net/projects/pymssql/files/pymssql/1.0.2/"</span></div><div class="line">        raise sqlmapMissingDependence, errMsg</div><div class="line"></div><div class="line">elif dbmsName == DBMS.MYSQL:</div><div class="line">    <span class="keyword">import</span> MySQLdb</div><div class="line">elif dbmsName == DBMS.PGSQL:</div><div class="line">    <span class="keyword">import</span> psycopg2</div><div class="line">elif dbmsName == DBMS.ORACLE:</div><div class="line">    <span class="keyword">import</span> cx_Oracle</div><div class="line">elif dbmsName == DBMS.SQLITE:</div><div class="line">    <span class="keyword">import</span> sqlite3</div><div class="line">elif dbmsName == DBMS.ACCESS:</div><div class="line">    <span class="keyword">import</span> pyodbc</div><div class="line">elif dbmsName == DBMS.FIREBIRD:</div><div class="line">    <span class="keyword">import</span> kinterbasdb</div></pre></td></tr></table></figure>
<h1 id="开始一些注入有关的配置"><a class="headerlink" href="#开始一些注入有关的配置" title="开始一些注入有关的配置"></a>开始一些注入有关的配置</h1><h2 id="设置延时"><a class="headerlink" href="#设置延时" title="设置延时"></a>设置延时</h2><p><code>_setHTTPTimeout()</code></p>
<p>除了默认设置30.0以外还判断不能小于3.0<br/><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">conf</span>.timeou<span class="variable">t:</span></div><div class="line">    debugMsg = <span class="string">"setting the HTTP timeout"</span></div><div class="line">    logger.<span class="keyword">debug</span>(debugMsg)</div><div class="line"></div><div class="line">    <span class="keyword">conf</span>.timeout = float(<span class="keyword">conf</span>.timeout)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.timeout &lt; <span class="number">3.0</span>:</div><div class="line">        warnMsg = <span class="string">"the minimum HTTP timeout is 3 seconds, sqlmap "</span></div><div class="line">        warnMsg += <span class="string">"will going to reset it"</span></div><div class="line">        logger.warn(warnMsg)</div><div class="line"></div><div class="line">        <span class="keyword">conf</span>.timeout = <span class="number">3.0</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">conf</span>.timeout = <span class="number">30.0</span></div><div class="line"></div><div class="line">socket.setdefaulttimeout(<span class="keyword">conf</span>.timeout)</div></pre></td></tr></table></figure></p>
<h2 id="设置请求头header"><a class="headerlink" href="#设置请求头header" title="设置请求头header"></a>设置请求头header</h2><p><code>_setHTTPExtraHeaders()</code></p>
<p>如果设置了头，那么就把header中的内容以列表的形式分割并赋值给conf.httpHeaders,<br/>如果没设置，那就默认头输入到conf.httpHeaders</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">conf</span>.header<span class="variable">s:</span></div><div class="line">    debugMsg = <span class="string">"setting extra HTTP headers"</span></div><div class="line">    logger.<span class="keyword">debug</span>(debugMsg)</div><div class="line"></div><div class="line">    <span class="keyword">conf</span>.headers = <span class="keyword">conf</span>.headers.<span class="keyword">split</span>(<span class="string">"\n"</span>) <span class="keyword">if</span> <span class="string">"\n"</span> in <span class="keyword">conf</span>.headers <span class="keyword">else</span> <span class="keyword">conf</span>.headers.<span class="keyword">split</span>(<span class="string">"\\n"</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> headerValue in <span class="keyword">conf</span>.header<span class="variable">s:</span></div><div class="line">        <span class="keyword">if</span> not headerValue.strip():</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> headerValue.<span class="built_in">count</span>(<span class="string">':'</span>) &gt;= <span class="number">1</span>:</div><div class="line">            header, value = (_.lstrip() <span class="keyword">for</span> _ in headerValue.<span class="keyword">split</span>(<span class="string">":"</span>, <span class="number">1</span>))</div><div class="line"></div><div class="line">            <span class="keyword">if</span> header <span class="built_in">and</span> value:</div><div class="line">                <span class="keyword">conf</span>.httpHeaders.<span class="keyword">append</span>((header, value))</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            errMsg = <span class="string">"invalid header value: %s. Valid header format is 'name:value'"</span> % repr(headerValue).lstrip(<span class="string">'u'</span>)</div><div class="line">            raise SqlmapSyntaxException(errMsg)</div><div class="line"></div><div class="line">elif not <span class="keyword">conf</span>.requestFile <span class="built_in">and</span> <span class="built_in">len</span>(<span class="keyword">conf</span>.httpHeaders <span class="built_in">or</span> []) &lt; <span class="number">2</span>:</div><div class="line">    <span class="keyword">conf</span>.httpHeaders.<span class="keyword">append</span>((HTTP_HEADER.ACCEPT_LANGUAGE, <span class="string">"en-us,en;q=0.5"</span>))</div><div class="line">    <span class="keyword">if</span> not <span class="keyword">conf</span>.charse<span class="variable">t:</span></div><div class="line">        <span class="keyword">conf</span>.httpHeaders.<span class="keyword">append</span>((HTTP_HEADER.ACCEPT_CHARSET, <span class="string">"ISO-8859-15,utf-8;q=0.7,*;q=0.7"</span>))</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">conf</span>.httpHeaders.<span class="keyword">append</span>((HTTP_HEADER.ACCEPT_CHARSET, <span class="string">"%s;q=0.7,*;q=0.1"</span> % <span class="keyword">conf</span>.charset))</div><div class="line"></div><div class="line">    # Invalidating any caching mechanism in between</div><div class="line">    # Reference: http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</div><div class="line">    <span class="keyword">conf</span>.httpHeaders.<span class="keyword">append</span>((HTTP_HEADER.CACHE_CONTROL, <span class="string">"no-cache,no-store"</span>))</div><div class="line">    <span class="keyword">conf</span>.httpHeaders.<span class="keyword">append</span>((HTTP_HEADER.PRAGMA, <span class="string">"no-cache"</span>))</div></pre></td></tr></table></figure>
<h2 id="设置cookie"><a class="headerlink" href="#设置cookie" title="设置cookie"></a>设置cookie</h2><p><code>_setHTTPCookies()</code></p>
<p>把cookie加入到conf.httpHeaders列表中<br/><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> conf<span class="selector-class">.cookie</span>:</div><div class="line">    debugMsg = <span class="string">"setting the HTTP Cookie header"</span></div><div class="line">    logger.debug(debugMsg)</div><div class="line"></div><div class="line">    conf<span class="selector-class">.httpHeaders</span><span class="selector-class">.append</span>((HTTP_HEADER<span class="selector-class">.COOKIE</span>, conf.cookie))</div></pre></td></tr></table></figure></p>
<h2 id="设置referer"><a class="headerlink" href="#设置referer" title="设置referer"></a>设置referer</h2><p>和cookie相同，这里是吧referer加入到conf.httpHeaders列表中<br/><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> conf<span class="selector-class">.referer</span>:</div><div class="line">    debugMsg = <span class="string">"setting the HTTP Referer header"</span></div><div class="line">    logger.debug(debugMsg)</div><div class="line"></div><div class="line">    conf<span class="selector-class">.httpHeaders</span><span class="selector-class">.append</span>((HTTP_HEADER<span class="selector-class">.REFERER</span>, conf.referer))</div></pre></td></tr></table></figure></p>
<p>还有后面的一系列，也都是设置关于请求头的host和ua<br/><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_setHTTPHost()</div><div class="line">_setHTTPUserAgent()</div></pre></td></tr></table></figure></p>
<h2 id="设置http用户验证"><a class="headerlink" href="#设置http用户验证" title="设置http用户验证"></a>设置http用户验证</h2><p><code>_setHTTPAuthentication()</code></p>
<p>检查http用户验证，判断属于(Basic, Digest, NTLM or PKI)中的哪一种方法，其中前三种需要用户密码，后一种需要私钥文件</p>
<p>涉及的东西比较多，就不贴代码了</p>
<h2 id="设置http代理"><a class="headerlink" href="#设置http代理" title="设置http代理"></a>设置http代理</h2><p><code>_setHTTPHandlers()</code></p>
<p>简单看一下就是简单的判断，然后使用http/socks的代理。</p>
<p>基本的代理列表处理<br/><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">conf</span>.proxyList <span class="keyword">is</span> not None:</div><div class="line">    <span class="keyword">if</span> not <span class="keyword">conf</span>.proxyLis<span class="variable">t:</span></div><div class="line">        errMsg = <span class="string">"list of usable proxies is exhausted"</span></div><div class="line">        raise SqlmapNoneDataException(errMsg)</div><div class="line"></div><div class="line">    <span class="keyword">conf</span>.proxy = <span class="keyword">conf</span>.proxyList[<span class="number">0</span>]</div><div class="line">    <span class="keyword">conf</span>.proxyList = <span class="keyword">conf</span>.proxyList[<span class="number">1</span>:]</div><div class="line"></div><div class="line">    infoMsg = <span class="string">"loading proxy '%s' from a supplied proxy list file"</span> % <span class="keyword">conf</span>.proxy</div><div class="line">    logger.info(infoMsg)</div><div class="line"></div><div class="line">elif not <span class="keyword">conf</span>.proxy:</div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.<span class="built_in">hostname</span> in (<span class="string">"localhost"</span>, <span class="string">"127.0.0.1"</span>) <span class="built_in">or</span> <span class="keyword">conf</span>.ignoreProxy:</div><div class="line">        proxyHandler.proxies = {}</div></pre></td></tr></table></figure></p>
<p>简单的配置并设置代理…</p>
<h2 id="设置DNS缓存"><a class="headerlink" href="#设置DNS缓存" title="设置DNS缓存"></a>设置DNS缓存</h2><p>使用socket._getaddrinfo来设置请求的dns缓存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_getaddrinfo</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">    <span class="keyword">if</span> args <span class="keyword">in</span> kb.cache:</div><div class="line">        <span class="keyword">return</span> kb.cache[args]</div><div class="line"></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        kb.cache[args] = socket._getaddrinfo(*args, **kwargs)</div><div class="line">        <span class="keyword">return</span> kb.cache[args]</div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> hasattr(socket, <span class="string">"_getaddrinfo"</span>):</div><div class="line">    socket._getaddrinfo = socket.getaddrinfo</div><div class="line">    socket.getaddrinfo = _getaddrinfo</div></pre></td></tr></table></figure>
<h2 id="设置socket链接"><a class="headerlink" href="#设置socket链接" title="设置socket链接"></a>设置socket链接</h2><p><code>_setSocketPreConnect()</code></p>
<p>设置socket链接</p>
<p>简单的配置已经开始socket连接<br/><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not hasattr(socket<span class="selector-class">.socket</span>, <span class="string">"_connect"</span>):</div><div class="line">    socket._ready = {}</div><div class="line">    socket<span class="selector-class">.socket</span>._connect = socket<span class="selector-class">.socket</span><span class="selector-class">.connect</span></div><div class="line">    socket<span class="selector-class">.socket</span><span class="selector-class">.connect</span> = connect</div><div class="line"></div><div class="line">    thread = threading.Thread(target=_)</div><div class="line">    setDaemon(thread)</div><div class="line">    thread.start()</div></pre></td></tr></table></figure></p>
<h2 id="设置安全连接"><a class="headerlink" href="#设置安全连接" title="设置安全连接"></a>设置安全连接</h2><p><code>_setSafeVisit()</code></p>
<p>简单的解包，然后设置安全连接<br/><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">raw = readCachedFileContent(conf.safeReqFile)</div><div class="line">match = re.search(<span class="string">r"\A([A-Z]+) ([^ ]+) HTTP/[0-9.]+\Z"</span>, raw[:raw.find(<span class="string">'\n'</span>)])</div></pre></td></tr></table></figure></p>
<p>设置安全链接<br/><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">match</span>:</div><div class="line">    kb.safeReq.method = <span class="keyword">match</span>.group(<span class="number">1</span>)</div><div class="line">    kb.safeReq.url = <span class="keyword">match</span>.group(<span class="number">2</span>)</div><div class="line">    kb.safeReq.headers = {}</div><div class="line"></div><div class="line">    <span class="keyword">for</span> <span class="built_in">line</span> in raw[raw.<span class="keyword">find</span>(<span class="string">'\n'</span>) + <span class="number">1</span>:].<span class="keyword">split</span>(<span class="string">'\n'</span>):</div><div class="line">        <span class="built_in">line</span> = <span class="built_in">line</span>.strip()</div><div class="line">        <span class="keyword">if</span> <span class="built_in">line</span> <span class="built_in">and</span> <span class="string">':'</span> in <span class="built_in">line</span>:</div><div class="line">            key, value = <span class="built_in">line</span>.<span class="keyword">split</span>(<span class="string">':'</span>, <span class="number">1</span>)</div><div class="line">            value = value.strip()</div><div class="line">            kb.safeReq.headers[key] = value</div><div class="line">            <span class="keyword">if</span> key == HTTP_HEADER.HOST:</div><div class="line">                <span class="keyword">if</span> not value.startswith(<span class="string">"http"</span>):</div><div class="line">                    scheme = <span class="string">"http"</span></div><div class="line">                    <span class="keyword">if</span> value.endswith(<span class="string">":443"</span>):</div><div class="line">                        scheme = <span class="string">"https"</span></div><div class="line">                    value = <span class="string">"%s://%s"</span> % (scheme, value)</div><div class="line">                kb.safeReq.url = urlparse.urljoin(value, kb.safeReq.url)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">break</span></div><div class="line"></div><div class="line">    post = None</div><div class="line"></div><div class="line">    <span class="keyword">if</span> <span class="string">'\r\n\r\n'</span> in ra<span class="variable">w:</span></div><div class="line">        post = raw[raw.<span class="keyword">find</span>(<span class="string">'\r\n\r\n'</span>) + <span class="number">4</span>:]</div><div class="line">    elif <span class="string">'\n\n'</span> in ra<span class="variable">w:</span></div><div class="line">        post = raw[raw.<span class="keyword">find</span>(<span class="string">'\n\n'</span>) + <span class="number">2</span>:]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> post <span class="built_in">and</span> post.strip():</div><div class="line">        kb.safeReq.post = post</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        kb.safeReq.post = None</div></pre></td></tr></table></figure></p>
<h2 id="一些乱七八糟的东西"><a class="headerlink" href="#一些乱七八糟的东西" title="一些乱七八糟的东西"></a>一些乱七八糟的东西</h2><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">_doSearch()</div><div class="line">_setBulkMultipleTargets()</div><div class="line">_setSitemapTargets()</div><div class="line">_setCrawler()</div><div class="line">_findPageForms()</div></pre></td></tr></table></figure>
<p>根据参数的一些设置，还有tor connection的判断并设置<br/><code>_checkTor()</code></p>
<p>没有深究的必要，接着看后面的</p>
<h2 id="关于设置数据库的check"><a class="headerlink" href="#关于设置数据库的check" title="关于设置数据库的check"></a>关于设置数据库的check</h2><p><code>_setDBMS()</code></p>
<p>简单的处理以及判定</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">conf</span>.dbms = <span class="keyword">conf</span>.dbms.<span class="built_in">lower</span>()</div><div class="line">regex = re.<span class="keyword">search</span>(<span class="string">"%s ([\d\.]+)"</span> % (<span class="string">"(%s)"</span> % <span class="string">"|"</span>.join([alias <span class="keyword">for</span> alias <span class="keyword">in</span> SUPPORTED_DBMS])), <span class="keyword">conf</span>.dbms, re.I)</div><div class="line"></div><div class="line"><span class="keyword">if</span> regex:</div><div class="line">    <span class="keyword">conf</span>.dbms = regex.<span class="built_in">group</span>(1)</div><div class="line">    Backend.setVersion(regex.<span class="built_in">group</span>(2))</div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">conf</span>.dbms not <span class="keyword">in</span> SUPPORTED_DBMS:</div><div class="line">    errMsg = <span class="string">"you provided an unsupported back-end database management "</span></div><div class="line">    errMsg += <span class="string">"system. Supported DBMSes are as follows: %s. "</span> % ', '.join(sorted(_ <span class="keyword">for</span> _ <span class="keyword">in</span> DBMS_DICT))</div><div class="line">    errMsg += <span class="string">"If you do not know the back-end DBMS, do not provide "</span></div><div class="line">    errMsg += <span class="string">"it and sqlmap will fingerprint it for you."</span></div><div class="line">    raise SqlmapUnsupportedDBMSException(errMsg)</div><div class="line"></div><div class="line"><span class="keyword">for</span> dbms, aliases <span class="keyword">in</span> DBMS_ALIASES:</div><div class="line">    <span class="keyword">if</span> <span class="keyword">conf</span>.dbms <span class="keyword">in</span> aliases:</div><div class="line">        <span class="keyword">conf</span>.dbms = dbms</div><div class="line"></div><div class="line">        <span class="keyword">break</span></div></pre></td></tr></table></figure>
<h2 id="关于设置注入类型的check"><a class="headerlink" href="#关于设置注入类型的check" title="关于设置注入类型的check"></a>关于设置注入类型的check</h2><p>和前面的数据库类型check相同，用户的设置在这里经过判断</p>
<p><code>_setTechnique()</code></p>
<p>同样是简单的处理以及判定</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">validTechniques = sorted(getPublicTypeMembers(PAYLOAD.TECHNIQUE), <span class="built_in">key</span>=<span class="built_in">lambda</span> x: x[<span class="number">1</span>])</div><div class="line">validLetters = [<span class="symbol">_</span>[<span class="number">0</span>][<span class="number">0</span>].upper() <span class="keyword">for</span> <span class="symbol">_</span> <span class="keyword">in</span> validTechniques]</div><div class="line"></div><div class="line"><span class="keyword">if</span> conf.tech <span class="keyword">and</span> isinstance(conf.tech, basestring):</div><div class="line">    <span class="symbol">_</span> = []</div><div class="line"></div><div class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> conf.tech.upper():</div><div class="line">        <span class="keyword">if</span> letter <span class="keyword">not</span> <span class="keyword">in</span> validLetters:</div><div class="line">            errMsg = <span class="string">"value for --technique must be a string composed "</span></div><div class="line">            errMsg += <span class="string">"by the letters %s. Refer to the "</span> <span class="symbol">%</span> <span class="string">", "</span>.<span class="built_in">join</span>(validLetters)</div><div class="line">            errMsg += <span class="string">"user's manual for details"</span></div><div class="line">            raise SqlmapSyntaxException(errMsg)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> validTech, validInt <span class="keyword">in</span> validTechniques:</div><div class="line">            <span class="keyword">if</span> letter == validTech[<span class="number">0</span>]:</div><div class="line">                <span class="symbol">_</span>.<span class="built_in">append</span>(validInt)</div><div class="line">                <span class="built_in">break</span></div><div class="line"></div><div class="line">    conf.tech = <span class="symbol">_</span></div></pre></td></tr></table></figure>
<h2 id="设置线程数"><a class="headerlink" href="#设置线程数" title="设置线程数"></a>设置线程数</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not isinstance(conf<span class="selector-class">.threads</span>, int) or conf<span class="selector-class">.threads</span> &lt;= <span class="number">0</span>:</div><div class="line">        conf<span class="selector-class">.threads</span> = <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="检查后端数据库系统"><a class="headerlink" href="#检查后端数据库系统" title="检查后端数据库系统"></a>检查后端数据库系统</h2><p><code>_setOS()</code><br/>简单的处理和判定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">if not conf.os:</div><div class="line">        return</div><div class="line"></div><div class="line">    if conf.os.lower() not in SUPPORTED_OS:</div><div class="line">        errMsg = "you provided an unsupported back-<span class="keyword">end</span> DBMS operating <span class="string">"</span></div><div class="line">        errMsg += "system. The supported DBMS operating systems <span class="keyword">for</span> OS <span class="string">"</span></div><div class="line">        errMsg += "<span class="keyword">and</span> <span class="keyword">file</span> <span class="keyword">system</span> <span class="keyword">access</span> <span class="keyword">are</span> %s. <span class="string">" % ', '.join([o.capitalize() for o in SUPPORTED_OS])</span></div><div class="line">        errMsg += "<span class="keyword">If</span> you <span class="keyword">do</span> <span class="keyword">not</span> know the back-<span class="keyword">end</span> DBMS underlying OS, <span class="string">"</span></div><div class="line">        errMsg += "<span class="keyword">do</span> <span class="keyword">not</span> provide it <span class="keyword">and</span> sqlmap will fingerprint it <span class="keyword">for</span> <span class="string">"</span></div><div class="line">        errMsg += "you.<span class="string">"</span></div><div class="line">        raise SqlmapUnsupportedDBMSException(errMsg)</div><div class="line"></div><div class="line">    debugMsg = "forcing back-<span class="keyword">end</span> DBMS operating <span class="keyword">system</span> <span class="keyword">to</span> <span class="keyword">user</span> defined <span class="string">"</span></div><div class="line">    debugMsg += "<span class="keyword">value</span> <span class="string">'%s'</span><span class="string">" % conf.os</span></div><div class="line">    logger.debug(debugMsg)</div><div class="line"></div><div class="line">    Backend.setOs(conf.os)</div></pre></td></tr></table></figure>
<h2 id="检查写文件目录"><a class="headerlink" href="#检查写文件目录" title="检查写文件目录"></a>检查写文件目录</h2><p><code>_setWriteFile()</code></p>
<p>没什么特别的，就是基本的判定<br/><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not os.path.<span class="built_in">exists</span>(<span class="keyword">conf</span>.wFile):</div><div class="line">    errMsg = <span class="string">"the provided local file '%s' does not exist"</span> % <span class="keyword">conf</span>.wFile</div><div class="line">    raise SqlmapFilePathException(errMsg)</div><div class="line"></div><div class="line"><span class="keyword">if</span> not <span class="keyword">conf</span>.dFile:</div><div class="line">    errMsg = <span class="string">"you did not provide the back-end DBMS absolute path "</span></div><div class="line">    errMsg += <span class="string">"where you want to write the local file '%s'"</span> % <span class="keyword">conf</span>.wFile</div><div class="line">    raise SqlmapMissingMandatoryOptionException(errMsg)</div><div class="line"></div><div class="line"><span class="keyword">conf</span>.wFileType = getFileType(<span class="keyword">conf</span>.wFile)</div></pre></td></tr></table></figure></p>
<h2 id="检查Metasploit的设置"><a class="headerlink" href="#检查Metasploit的设置" title="检查Metasploit的设置"></a>检查Metasploit的设置</h2><p>本地Metasploit的一些配置，就不贴代码了</p>
<h2 id="检查设置的数据库身份验证语句"><a class="headerlink" href="#检查设置的数据库身份验证语句" title="检查设置的数据库身份验证语句"></a>检查设置的数据库身份验证语句</h2><p>没什么可说的</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> not <span class="keyword">conf</span>.dbmsCred:</div><div class="line">    <span class="keyword">return</span></div><div class="line"></div><div class="line">debugMsg = <span class="string">"setting the DBMS authentication credentials"</span></div><div class="line">logger.<span class="keyword">debug</span>(debugMsg)</div><div class="line"></div><div class="line"><span class="keyword">match</span> = re.<span class="built_in">search</span>(<span class="string">"^(.+?):(.*?)$"</span>, <span class="keyword">conf</span>.dbmsCred)</div><div class="line"></div><div class="line"><span class="keyword">if</span> not <span class="keyword">match</span>:</div><div class="line">    errMsg = <span class="string">"DBMS authentication credentials value must be in format "</span></div><div class="line">    errMsg += <span class="string">"username:password"</span></div><div class="line">    raise SqlmapSyntaxException(errMsg)</div><div class="line"></div><div class="line"><span class="keyword">conf</span>.dbmsUsername = <span class="keyword">match</span>.group(<span class="number">1</span>)</div><div class="line"><span class="keyword">conf</span>.dbmsPassword = <span class="keyword">match</span>.group(<span class="number">2</span>)</div></pre></td></tr></table></figure>
<h2 id="加载测试语句"><a class="headerlink" href="#加载测试语句" title="加载测试语句"></a>加载测试语句</h2><p>加载测试语句并解析，这里的paths.BOUNDARIES_XML为E:\sqlmap\xml\boundaries.xml<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadBoundaries</span><span class="params">()</span>:</span></div><div class="line">	<span class="keyword">try</span>:</div><div class="line">	    doc = et.parse(paths.BOUNDARIES_XML)</div><div class="line">	<span class="keyword">except</span> Exception, ex:</div><div class="line">	    errMsg = <span class="string">"something appears to be wrong with "</span></div><div class="line">	    errMsg += <span class="string">"the file '%s' ('%s'). Please make "</span> % (paths.BOUNDARIES_XML, getSafeExString(ex))</div><div class="line">	    errMsg += <span class="string">"sure that you haven't made any changes to it"</span></div><div class="line">	    <span class="keyword">raise</span> SqlmapInstallationException, errMsg</div><div class="line">	</div><div class="line">	root = doc.getroot()</div><div class="line">	parseXmlNode(root)</div></pre></td></tr></table></figure></p>
<h2 id="加载payload格式"><a class="headerlink" href="#加载payload格式" title="加载payload格式"></a>加载payload格式</h2><p>然后是加载payload格式<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadPayloads</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> payloadFile <span class="keyword">in</span> PAYLOAD_XML_FILES:</div><div class="line">        payloadFilePath = os.path.join(paths.SQLMAP_XML_PAYLOADS_PATH, payloadFile)</div><div class="line"></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            doc = et.parse(payloadFilePath)</div><div class="line">        <span class="keyword">except</span> Exception, ex:</div><div class="line">            errMsg = <span class="string">"something appears to be wrong with "</span></div><div class="line">            errMsg += <span class="string">"the file '%s' ('%s'). Please make "</span> % (payloadFilePath, getSafeExString(ex))</div><div class="line">            errMsg += <span class="string">"sure that you haven't made any changes to it"</span></div><div class="line">            <span class="keyword">raise</span> SqlmapInstallationException, errMsg</div><div class="line"></div><div class="line">        root = doc.getroot()</div><div class="line">        parseXmlNode(root)</div></pre></td></tr></table></figure></p>
<p>其中payloadFilePath为：<br/><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">E:<span class="symbol">\s</span>qlmap<span class="symbol">\x</span>ml<span class="symbol">\p</span>ayloads<span class="symbol">\b</span>oolean_blind.xml</div><div class="line">E:<span class="symbol">\s</span>qlmap<span class="symbol">\x</span>ml<span class="symbol">\p</span>ayloads<span class="symbol">\e</span>rror_based.xml</div><div class="line">E:<span class="symbol">\s</span>qlmap<span class="symbol">\x</span>ml<span class="symbol">\p</span>ayloads<span class="symbol">\i</span>nline_query.xml</div><div class="line">E:<span class="symbol">\s</span>qlmap<span class="symbol">\x</span>ml<span class="symbol">\p</span>ayloads<span class="symbol">\s</span>tacked_queries.xml</div><div class="line">E:<span class="symbol">\s</span>qlmap<span class="symbol">\x</span>ml<span class="symbol">\p</span>ayloads<span class="symbol">\t</span>ime_blind.xml</div><div class="line">E:<span class="symbol">\s</span>qlmap<span class="symbol">\x</span>ml<span class="symbol">\p</span>ayloads<span class="symbol">\u</span>nion_query.xml</div></pre></td></tr></table></figure></p>
<h2 id="更新版本"><a class="headerlink" href="#更新版本" title="更新版本"></a>更新版本</h2><p>如果检测到–update，那么进入update模式<code>update()</code></p>
<p>挺有趣的，可以看看<br/><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">success = False</div><div class="line"></div><div class="line">    <span class="keyword">if</span> not os.path.exists(os.path.join(paths.SQLMAP_ROOT_PATH, <span class="string">".git"</span>)):</div><div class="line">        errMsg = <span class="string">"not a git repository. Please checkout the 'sqlmapproject/sqlmap' repository "</span></div><div class="line">        errMsg += <span class="string">"from GitHub (e.g. 'git clone https://github.com/sqlmapproject/sqlmap.git sqlmap')"</span></div><div class="line">        logger.<span class="keyword">error</span>(errMsg)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        infoMsg = <span class="string">"updating sqlmap to the latest development version from the "</span></div><div class="line">        infoMsg += <span class="string">"GitHub repository"</span></div><div class="line">        logger.info(infoMsg)</div><div class="line"></div><div class="line">        debugMsg = <span class="string">"sqlmap will try to update itself using 'git' command"</span></div><div class="line">        logger.debug(debugMsg)</div><div class="line"></div><div class="line">        dataToStdout(<span class="string">"\r[%s] [INFO] update in progress "</span> % time.strftime(<span class="string">"%X"</span>))</div><div class="line"></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            process = execute(<span class="string">"git checkout . &amp;&amp; git pull %s HEAD"</span> % GIT_REPOSITORY, shell=True, stdout=PIPE, stderr=PIPE, cwd=paths.SQLMAP_ROOT_PATH.encode(locale.getpreferredencoding()))  # Reference: http://blog.stastnarodina.com/honza-en/spot/python-unicodeencodeerror/</div><div class="line">            pollProcess(process, True)</div><div class="line">            stdout, stderr = process.communicate()</div><div class="line">            success = not process.returncode</div><div class="line">        except (IOError, OSError), ex:</div><div class="line">            success = False</div><div class="line">            stderr = getSafeExString(ex)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> success:</div><div class="line">            <span class="keyword">import</span> lib.core.settings</div><div class="line">            _ = lib.core.settings.REVISION = getRevisionNumber()</div><div class="line">            logger.info(<span class="string">"%s the latest revision '%s'"</span> % (<span class="string">"already at"</span> <span class="keyword">if</span> <span class="string">"Already"</span> in stdout <span class="keyword">else</span> <span class="string">"updated to"</span>, _))</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">if</span> <span class="string">"Not a git repository"</span> in stderr:</div><div class="line">                errMsg = <span class="string">"not a valid git repository. Please checkout the 'sqlmapproject/sqlmap' repository "</span></div><div class="line">                errMsg += <span class="string">"from GitHub (e.g. 'git clone https://github.com/sqlmapproject/sqlmap.git sqlmap')"</span></div><div class="line">                logger.<span class="keyword">error</span>(errMsg)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                logger.<span class="keyword">error</span>(<span class="string">"update could not be completed ('%s')"</span> % re.sub(r<span class="string">"\W+"</span>, <span class="string">" "</span>, stderr).strip())</div><div class="line"></div><div class="line">    <span class="keyword">if</span> not success:</div><div class="line">        <span class="keyword">if</span> IS_WIN:</div><div class="line">            infoMsg = <span class="string">"for Windows platform it's recommended "</span></div><div class="line">            infoMsg += <span class="string">"to use a GitHub for Windows client for updating "</span></div><div class="line">            infoMsg += <span class="string">"purposes (http://windows.github.com/) or just "</span></div><div class="line">            infoMsg += <span class="string">"download the latest snapshot from "</span></div><div class="line">            infoMsg += <span class="string">"https://github.com/sqlmapproject/sqlmap/downloads"</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            infoMsg = <span class="string">"for Linux platform it's required "</span></div><div class="line">            infoMsg += <span class="string">"to install a standard 'git' package (e.g.: 'sudo apt-get install git')"</span></div><div class="line"></div><div class="line">        logger.info(infoMsg)</div></pre></td></tr></table></figure></p>
<h2 id="加载常用的查询语句"><a class="headerlink" href="#加载常用的查询语句" title="加载常用的查询语句"></a>加载常用的查询语句</h2><p>最后也是初始化的核心，加载查询语句，针对不同数据的基础数据查询<br/><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_loadQueries</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Loads queries from 'xml/queries.xml' file.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iterate</span><span class="params">(node, retVal=None)</span>:</span></div><div class="line">        <span class="class"><span class="keyword">class</span> <span class="title">DictObject</span><span class="params">(object)</span>:</span></div><div class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">                self.__dict__ = {}</div><div class="line"></div><div class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, name)</span>:</span></div><div class="line">                <span class="keyword">return</span> name <span class="keyword">in</span> self.__dict__</div><div class="line"></div><div class="line">        <span class="keyword">if</span> retVal <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            retVal = DictObject()</div><div class="line"></div><div class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> node.findall(<span class="string">"*"</span>):</div><div class="line">            instance = DictObject()</div><div class="line">            retVal.__dict__[child.tag] = instance</div><div class="line">            <span class="keyword">if</span> child.attrib:</div><div class="line">                instance.__dict__.update(child.attrib)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                iterate(child, instance)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> retVal</div><div class="line"></div><div class="line">    tree = ElementTree()</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        tree.parse(paths.QUERIES_XML)</div><div class="line">    <span class="keyword">except</span> Exception, ex:</div><div class="line">        errMsg = <span class="string">"something appears to be wrong with "</span></div><div class="line">        errMsg += <span class="string">"the file '%s' ('%s'). Please make "</span> % (paths.QUERIES_XML, getSafeExString(ex))</div><div class="line">        errMsg += <span class="string">"sure that you haven't made any changes to it"</span></div><div class="line">        <span class="keyword">raise</span> SqlmapInstallationException, errMsg</div><div class="line"></div><div class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> tree.findall(<span class="string">"*"</span>):</div><div class="line">        queries[node.attrib[<span class="string">'value'</span>]] = iterate(node)</div></pre></td></tr></table></figure></p>
<p>xml/queries.xml就是各个语句的字典</p>
<h1 id="开始"><a class="headerlink" href="#开始" title="开始"></a>开始</h1><p>基本初始化完成后，就正式进入了注入测试中<br/><code>start()</code></p>
</div>
</div>
<div class="copyright">
<p><span>本文标题:</span><a href="/2016/08/11/sqlmap-source2/">sqlmap 源码分析（二）初始化</a></p>
<p><span>文章作者:</span><a href="/" title="回到主页">LoRexxar</a></p>
<p><span>发布时间:</span>2016-08-11, 15:19:19</p>
<p><span>最后更新:</span>2016-08-16, 13:58:38</p>
<p>
<span>原始链接:</span><a class="post-url" href="/2016/08/11/sqlmap-source2/" title="sqlmap 源码分析（二）初始化">http://lorexxar.cn/2016/08/11/sqlmap-source2/</a>
<span class="copy-path" data-clipboard-text="原文: http://lorexxar.cn/2016/08/11/sqlmap-source2/　　作者: LoRexxar" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
<script> var clipboard = new Clipboard('.copy-path'); </script>
</p>
<p>
<span>许可协议:</span><i class="fa fa-creative-commons"></i> <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license" target="_blank" title="CC BY-NC-SA 4.0 International">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
</div>
<nav id="article-nav">
<div class="article-nav-title" id="article-nav-newer">
<a href="/2016/08/16/sqlmap-source3/">
                    sqlmap 源码分析（三）在注入之前
                </a>
</div>
<div class="article-nav-title" id="article-nav-older">
<a href="/2016/08/09/sqlmap-source1/">
                    sqlmap 源码分析（一）开始、参数解析
                </a>
</div>
</nav>
</article>
<div class="toc-article" id="toc">
<strong class="toc-title">文章目录</strong>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#初始化"><span class="toc-number">1.</span> <span class="toc-text">初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化一些必要的配置属性"><span class="toc-number">1.1.</span> <span class="toc-text">初始化一些必要的配置属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#新手引导"><span class="toc-number">2.</span> <span class="toc-text">新手引导</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#设置输出log级别"><span class="toc-number">3.</span> <span class="toc-text">设置输出log级别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#保存命令行的配置到ini文件"><span class="toc-number">4.</span> <span class="toc-text">保存命令行的配置到ini文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#处理从文件获取的http请求"><span class="toc-number">5.</span> <span class="toc-text">处理从文件获取的http请求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#一些基本的参数错误处理"><span class="toc-number">6.</span> <span class="toc-text">一些基本的参数错误处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#加载tamper的自定义函数"><span class="toc-number">7.</span> <span class="toc-text">加载tamper的自定义函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解析目标url-amp-设置一些配置"><span class="toc-number">8.</span> <span class="toc-text">解析目标url&amp;设置一些配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解析目标数据库"><span class="toc-number">9.</span> <span class="toc-text">解析目标数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#开始一些注入有关的配置"><span class="toc-number">10.</span> <span class="toc-text">开始一些注入有关的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#设置延时"><span class="toc-number">10.1.</span> <span class="toc-text">设置延时</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置请求头header"><span class="toc-number">10.2.</span> <span class="toc-text">设置请求头header</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置cookie"><span class="toc-number">10.3.</span> <span class="toc-text">设置cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置referer"><span class="toc-number">10.4.</span> <span class="toc-text">设置referer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置http用户验证"><span class="toc-number">10.5.</span> <span class="toc-text">设置http用户验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置http代理"><span class="toc-number">10.6.</span> <span class="toc-text">设置http代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置DNS缓存"><span class="toc-number">10.7.</span> <span class="toc-text">设置DNS缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置socket链接"><span class="toc-number">10.8.</span> <span class="toc-text">设置socket链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置安全连接"><span class="toc-number">10.9.</span> <span class="toc-text">设置安全连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一些乱七八糟的东西"><span class="toc-number">10.10.</span> <span class="toc-text">一些乱七八糟的东西</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于设置数据库的check"><span class="toc-number">10.11.</span> <span class="toc-text">关于设置数据库的check</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于设置注入类型的check"><span class="toc-number">10.12.</span> <span class="toc-text">关于设置注入类型的check</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置线程数"><span class="toc-number">10.13.</span> <span class="toc-text">设置线程数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查后端数据库系统"><span class="toc-number">10.14.</span> <span class="toc-text">检查后端数据库系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查写文件目录"><span class="toc-number">10.15.</span> <span class="toc-text">检查写文件目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查Metasploit的设置"><span class="toc-number">10.16.</span> <span class="toc-text">检查Metasploit的设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查设置的数据库身份验证语句"><span class="toc-number">10.17.</span> <span class="toc-text">检查设置的数据库身份验证语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载测试语句"><span class="toc-number">10.18.</span> <span class="toc-text">加载测试语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载payload格式"><span class="toc-number">10.19.</span> <span class="toc-text">加载payload格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新版本"><span class="toc-number">10.20.</span> <span class="toc-text">更新版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载常用的查询语句"><span class="toc-number">10.21.</span> <span class="toc-text">加载常用的查询语句</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#开始"><span class="toc-number">11.</span> <span class="toc-text">开始</span></a></li></ol>
</div>
<style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>
<input id="tocButton" title="点击按钮隐藏或者显示文章目录" type="button" value="隐藏目录"/>
<script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>
<div class="share">
<div class="bdsharebuttonbox">
<a class="fa fa-twitter bds_twi" data-cmd="twi" href="#" title="分享到推特"></a>
<a class="fa fa-weibo bds_tsina" data-cmd="tsina" href="#" title="分享到新浪微博"></a>
<a class="fa fa-qq bds_sqq" data-cmd="sqq" href="#" title="分享给 QQ 好友"></a>
<a class="fa fa-files-o bds_copy" data-cmd="copy" href="#" title="复制网址"></a>
<a class="fa fa fa-envelope-o bds_mail" data-cmd="mail" href="#" title="通过邮件分享"></a>
<a class="fa fa-weixin bds_weixin" data-cmd="weixin" href="#" title="生成文章二维码"></a>
<a class="fa fa-share-alt bds_more" data-cmd="more" href="#"></a></div></div></div></div></div></body></html>

<script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"sqlmap 源码分析（二）初始化　| LoRexxar's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>

<section class="youyan" id="comments">
<script>
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = 'http://v2.uyan.cc/code/uyan.js?uid=2127998';
            (d.head || d.body).appendChild(s);
        }
    </script>
<script> loadComment(); </script>
<div id="uyan_frame"></div>
</section>
<div class="scroll" id="post-nav-button">
<a href="/2016/08/16/sqlmap-source3/" title="上一篇: sqlmap 源码分析（三）在注入之前">
<i class="fa fa-angle-left"></i>
</a>
<a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
<a href="/2016/08/09/sqlmap-source1/" title="下一篇: sqlmap 源码分析（一）开始、参数解析">
<i class="fa fa-angle-right"></i>
</a>
</div>
<ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/16/nonce-bypass-script/">通过浏览器缓存来bypass CSP script nonce</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/12/pppctf2017/">PlaidCTF 2017 web writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/12/xss-bot2/">xss bot从入门到弃坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/09/CSP Is Dead, Long Live CSP! On the Insecurity of Whitelists and the Future of Content Security Policy/">CSP Is Dead, Long Live CSP! 翻译</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/24/pwnhub-jue/">pwnhub 绝对防御 出题思路和反思</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/21/Shadow-Brokers/">Shadow Brokers大新闻整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/21/360chunqiu2017/">360春秋杯2017 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/18/bctf2017-web/">bctf2017 web部分wp</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/27/pwnhub-xiaom/">pwnhub 之小m的复仇</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/21/0ctf2017-web/">0ctf201 web部分writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/13/njctf2017-wp/">NJCTF Web部分writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/05/pwnhub-another-php/">pwnhub_another php web部分</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/27/zctf2017-writeup/">zctf2017 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/20/pwnhub-open/">pwnhub 打开电脑</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/16/cdn-bypass-csp/">有趣的cdn bypass CSP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/26/hctf2016-something/">聊聊hctf2016</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/pwnhub-shen/">pwnhub 深入敌后</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/03/33c3-wp/">33c32016 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/28/cve-2016-10030/">phpmailer RCE漏洞分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/26/pwnhub_mi/">pwnhub_迷</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/24/xss-protect/">浅谈xss的后台守护问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/18/pwnhub-pai2/">pwnhub_拍卖行</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/18/pwnhub-pai/">pwnhub_找朋友</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/pwnhub-WTF-writeup/">pwnhub_WTF_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/07/polyglot-JPEGs-bypass-csp/">using polyglot JPEGs bypass CSP 分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/03/redis-getshell/">通过redis getshell的一些小问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/01/hctf2016-other/">hctf2016 简单部分WEB &amp;&amp; misc writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/30/hctf2016-xss/">hctf2016 guestbook&amp;secret; area writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/29/hctf2016-ATField/">HCTF2016 ATField writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/web2-giligili/">hctf2016 giligili writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/31/csp-then2/">CSP进阶-302 Bypass CSP</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/28/csp-then/">CSP进阶-link Bypass unsafe line</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/26/ctf-start/">什么是ctf呢？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/11/hitcon2016-misc/">hitcon2016 misc writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/hitcon2016/">hitcon2016 web writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/Lctf2016/">L-ctf2016 Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/14/php-wei/">php 伪协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/11/huashanbei2016/">华山杯2016_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/29/crypto-start/">crypto 简单的RSA</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/18/sqlmap-source4/">sqlmap 源码分析（四）开始注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/16/sqlmap-source3/">sqlmap 源码分析（三）在注入之前</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/sqlmap-source2/">sqlmap 源码分析（二）初始化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/09/sqlmap-source1/">sqlmap 源码分析（一）开始、参数解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/08/ccsp/">CSP Level 3浅析&amp;简单的bypass</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/07/python-virtualenv/">python virtualenv沙盒命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/xnuca-ctf-wp/">XNUCA2016 Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/21/python-tqdm/">python tqdm模块分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/18/cmd-shell/">shell上一些有趣的命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/17/sangebaimao_huobi/">sangebaimao之火币网</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/12/guosai-ctf-wp/">信息安全国赛技能赛 Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/26/cloudeye/">一个有趣的东西-cloudeye</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/17/sangebaimao-zhao/">sangebaimao之招聘又开始了，你怕了吗？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/06/alictf2016/">alictf2016_web_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/04/sangebaimao1/">sangebaimao 寻找来自星星的你一</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/27/opcache-jcfx/">在php opcache检测隐藏的后门程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/12/php-shell/">php webshell 各种函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/10/asis-bcloud/">Asis2016_Binary Cloud</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/09/sctf2016/">sctf2016_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/05/dockerfile/">dockerfile  (・ω・)ノ</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/04/docker-jc/">docker 基础操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/02/ggctf2016/">google_ctf2016_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/25/cctf2016/">CCTF2016_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/20/gif-ccsp/">gif bypass CSP?</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/11/j123jt-wp/">j123jt的聊天板大型wp</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/11/sctf-Obfusion/">sctfq1_Obfusion_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/08/input-bypasscsrf/">input属性bypass csp</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/06/hctfgame-llfx/">hctfgame_ll的流量分析题</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/phpblack/">is_numeric和trim导致的判断绕过</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/web-for-pentest-II/">web_for_pentest_II writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/22/bctf2016/">bctf2016</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/14/hctfgame_week4+5_writeup/">hctf_game_week4+5_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/14/0ctf2016/">0ctf2016 &amp;&amp; sunshinectf2016 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/07/bkp2016-writeup/">bkp2016_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/05/hexo-coding/">hexo转移到coding配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/ssctf2015-writeup/">ssctf2015_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/29/hctfgame_week3_writeup/">hctf_game_week3_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/28/ldpai/">ldpa简单注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/28/titan-souls-ez/">titan souls 普通模式通关攻略</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/18/easy_git/">简单的git教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/18/hctfgame_week2_writeup/">hctf_game_week2_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/18/hctfgame_week1_writeup/">hctf_game_week1_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/18/hctfgame_week0_writeup/">hctf_game_week0_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/21/dmsj-book/">《代码审计》一点儿笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/19/hctf2015/">hctf2015的一点儿记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/xss-link/">xss link&amp;svg;黑魔法</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/sql-error/">SQL 显错注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/17/rctf2015/">RCTF2015_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/17/isg2015/">ISG2015_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/02/hsb/">SPWC &amp; 华山杯？ writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/24/sqli_h/">关于sqli注入的特殊函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/04/XDCTF2015-writeup/">XDCTF2015-writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/28/nsctf-writeup/">Nsctf2015_Writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/02/xss-p/">xss无声挑战赛_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/11/ctf0611/">ctf近期总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/22/Hexo-blogs/">Windows Hexo博客安装配置优化（小白篇）</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/21/fucksql/">Hduisa_ctf_wee4_fucksql</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/10/webforpentester/">Web for pentester_writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/26/hduisa-ctf-writeup2/">Hduisa_ctf_writeup02</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/26/hduisa-ctf-writeup1/">Hduisa_ctf_writeup01</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/26/shinian/">（转）十年学会程序设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/22/webfirst/">0基础如何学好WEB（转）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/31/hackx/">凤凰挽歌，黑客独白（作者：我是老鹰&amp;炫凤舞）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/29/bookshelf1/">（转）学长们给我们的书目（结尾附上PDF地址）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/29/xiaobaistart/">菜鸟小白的开始...</a></li></ul>
<script>
</script>

<footer id="footer">
<div class="outer">
<div id="footer-info">
<div class="footer-left">
<i class="fa fa-copyright"></i> 
                2014-2017 LoRexxar
            </div>
<div class="footer-right">
<a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
</div>
</div>
<div class="visit">
<span id="busuanzi_container_site_pv" style="display:none">
<span id="site-visit" title="本站到访数"><i aria-hidden="true" class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span>
</span>
</span>
<span>| </span>
<span id="busuanzi_container_page_pv" style="display:none">
<span id="page-visit" title="本页阅读量"><i aria-hidden="true" class="fa fa-eye animated infinite pulse"></i><span id="busuanzi_value_page_pv"></span>
</span>
</span>
</div>
</div>
</footer>

<script data-main="/js/main.js" src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/require.min.js"></script>
<script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 7;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>
<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>
<script async="" src="./sqlmap 源码分析（二）初始化  LoRexxar's Blog/busuanzi.pure.mini.js">
</script>


